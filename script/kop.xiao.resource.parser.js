// https://raw.githubusercontent.com/KOP-XIAO/QuantumultX/master/Scripts/resource-parser.js
let[link0,content0,subinfo]=[$resource.link,$resource.content,$resource.info],version="undefined"!=typeof $environment?Number($environment.version.split("build")[1]):0,Perror=0;const subtag=void 0!==$resource.tag?$resource.tag:"";content0=-1!=content0.indexOf("DOCTYPE html")&&-1!=link0.indexOf("github.com")?ToRaw(content0):content0;var para=/^(http|https)\:\/\//.test(link0)?link0:content0.split("\n")[0],para1=para.slice(para.indexOf("#")+1).replace(/\$type/g,"node_type_para_prefix").replace(/\$emoji/g,"node_emoji_flag_prefix").replace(/\$tag/g,"node_tag_prefix").replace(/\$index/g,"node_index_prefix"),mark0=-1!=para.indexOf("#"),Pinfo=mark0&&-1!=para1.indexOf("info=")?para1.split("info=")[1].split("&")[0]:0,ntf_flow=0;const Base64=new Base64Code,escapeRegExp=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");var link1=link0.split("#")[0];const qxpng="https://raw.githubusercontent.com/crossutility/Quantumult-X/master/quantumult-x.png",subinfo_link={"open-url":"https://t.me/QuanX_API","media-url":"https://shrtm.nu/ebAr"},subinfo_link1={"open-url":link1,"media-url":"https://shrtm.nu/uo13"},rwrite_link={"open-url":link1,"media-url":"https://shrtm.nu/x3o2"},rwhost_link={"open-url":link1,"media-url":"https://shrtm.nu/0n5J"},rule_link={"open-url":link1,"media-url":"https://shrtm.nu/cpHD"},nan_link={"open-url":link1,"media-url":qxpng},bug_link={"open-url":"https://t.me/Shawn_Parser_Bot","media-url":"https://shrtm.nu/obcB"},sub_link={"open-url":link1,"media-url":"https://shrtm.nu/ebAr"},update_link={"open-url":"https://apps.apple.com/us/app/quantumult-x/id1443988620","media-url":qxpng},plink0={"open-url":link0,"media-url":qxpng};0==version&&$notify("⚠️ 请更新 Quantumult X 至最新商店版本\n","🚦 当前版本可能无法正常使用部分功能","\n👉 点击跳转商店链接更新",update_link);const ADDRes="quantumult-x:///add-resource?remote-resource=url-encoded-json";var RLink0={filter_remote:[],rewrite_remote:[],server_remote:[]};const Field={filter:"filter_remote",rewrite:"rewrite_remote",server:"server_remote"};SubFlow();var Pin0=mark0&&-1!=para1.indexOf("in=")?para1.split("in=")[1].split("&")[0].split("+").map(decodeURIComponent):null,Pout0=!mark0||-1==para.indexOf("#out=")&&-1==para.indexOf("&out=")?null:(-1!=para.indexOf("#out=")?para.split("#out="):para.split("&out="))[1].split("&")[0].split("+").map(decodeURIComponent),Psfilter=mark0&&-1!=para1.indexOf("sfilter=")?Base64.decode(para1.split("sfilter=")[1].split("&")[0]):null,Preg=mark0&&-1!=para1.indexOf("regex=")?decodeURIComponent(para1.split("regex=")[1].split("&")[0]).replace(/\，/g,","):null,Pregout=mark0&&-1!=para1.indexOf("regout=")?decodeURIComponent(para1.split("regout=")[1].split("&")[0]).replace(/\，/g,","):null,Pregdel=mark0&&-1!=para1.indexOf("delreg=")?decodeURIComponent(para1.split("delreg=")[1].split("&")[0]).replace(/\，/g,","):null,Phin0=mark0&&-1!=para1.indexOf("inhn=")?para1.split("inhn=")[1].split("&")[0].split("+").map(decodeURIComponent):null,Phout0=mark0&&-1!=para1.indexOf("outhn=")?para1.split("outhn=")[1].split("&")[0].split("+").map(decodeURIComponent):null,Preplace=mark0&&-1!=para1.indexOf("replace=")?para1.split("replace=")[1].split("&")[0]:null,Pemoji=mark0&&-1!=para1.indexOf("emoji=")?para1.split("emoji=")[1].split("&")[0]:null,Pdbg=mark0&&-1!=para1.indexOf("dbg=")?para1.split("dbg=")[1].split("&")[0]:null,Pudp0=mark0&&-1!=para1.indexOf("udp=")?para1.split("udp=")[1].split("&")[0]:0,Ptfo0=mark0&&-1!=para1.indexOf("tfo=")?para1.split("tfo=")[1].split("&")[0]:0,Prname=mark0&&/(^|\&)rename=/.test(para1)?para1.split(/(^|\&)rename\=/)[2].split("&")[0].split("+"):null,Psrename=mark0&&-1!=para1.indexOf("srename=")?Base64.decode(para1.split("srename=")[1].split("&")[0]):null,Prrname=mark0&&-1!=para1.indexOf("rrname=")?para1.split("rrname=")[1].split("&")[0].split("+"):null,Psuffix=mark0&&-1!=para1.indexOf("suffix=")?para1.split("suffix=")[1].split("&")[0]:0,Ppolicy=mark0&&-1!=para1.indexOf("policy=")?decodeURIComponent(para1.split("policy=")[1].split("&")[0]):"Shawn",Ppolicyset=mark0&&-1!=para1.indexOf("pset=")?decodeURIComponent(para1.split("pset=")[1].split("&")[0]):"",Pcert0=mark0&&-1!=para1.indexOf("cert=")?para1.split("cert=")[1].split("&")[0]:0,Psort0=mark0&&-1!=para1.indexOf("sort=")?para1.split("sort=")[1].split("&")[0]:0,PsortX=mark0&&-1!=para1.indexOf("sortx=")?para1.split("sortx=")[1].split("&")[0]:0,PTls13=mark0&&-1!=para1.indexOf("tls13=")?para1.split("tls13=")[1].split("&")[0]:0,Pntf0=mark0&&-1!=para1.indexOf("ntf=")?para1.split("ntf=")[1].split("&")[0]:2,Phide=mark0&&-1!=para1.indexOf("hide=")?para1.split("hide=")[1].split("&")[0]:1,Pb64=mark0&&-1!=para1.indexOf("b64=")?para1.split("b64=")[1].split("&")[0]:0,emojino=[" 0️⃣ "," 1⃣️ "," 2⃣️ "," 3⃣️ "," 4⃣️ "," 5⃣️ "," 6⃣️ "," 7⃣️ "," 8⃣️ "," 9⃣️ "," 🔟 "],pfi=mark0&&Pin0?"in="+Pin0.join(", ")+",  ":"",pfo=mark0&&Pout0?"out="+Pout0.join(", "):"",pfihn=mark0&&Phin0?"inhn="+Phin0.join(", ")+",  ":"",pfohn=mark0&&Phout0?"outhn="+Phout0.join(", "):"",Pcnt=mark0&&-1!=para1.indexOf("cnt=")?para1.split("cnt=")[1].split("&")[0]:0,Pcap=mark0&&-1!=para1.indexOf("cap=")?para1.split("cap=")[1].split("&")[0]:"",Pptn=mark0&&-1!=para1.indexOf("ptn=")?para1.split("ptn=")[1].split("&")[0]:"",Pnptn=mark0&&-1!=para1.indexOf("npt=")?para1.split("npt=")[1].split("&")[0]:"",Pcdn=mark0&&-1!=para1.indexOf("cdn=")?para1.split("cdn=")[1].split("&")[0]:"";let[flow,exptime,errornode,total]="";var Pdel=mark0&&-1!=para1.indexOf("del=")?para1.split("del=")[1].split("&")[0]:0,typeU=mark0&&-1!=para1.indexOf("type=")?para1.split("type=")[1].split("&")[0]:"",Pfcr=mark0&&-1!=para1.indexOf("fcr=")?para1.split("fcr=")[1].split("&")[0]:"",Pvia=mark0&&-1!=para1.indexOf("via=")?para1.split("via=")[1].split("&")[0]:"",Paead=mark0&&-1!=para1.indexOf("aead=")?para1.split("aead=")[1].split("&")[0]:"",Phost=!mark0||-1==para.indexOf("#host=")&&-1==para.indexOf("&host=")?"":(-1!=para.indexOf("#host=")?para.split("#host="):para.split("&host="))[1].split("&")[0],Pcsha256=mark0&&-1!=para1.indexOf("csha=")&&version>=646?para1.split("csha=")[1].split("&")[0]:"",Ppsha256=mark0&&-1!=para1.indexOf("psha=")&&version>=646?para1.split("psha=")[1].split("&")[0]:"",typeQ=$resource.type?$resource.type:"unsupported",PRelay=mark0&&-1!=para1.indexOf("relay=")?decodeURIComponent(para1.split("relay=")[1].split("&")[0]):"",PUOT=mark0&&-1!=para1.indexOf("uot=")&&version>=665?para1.split("uot=")[1].split("&")[0]:"",PcheckU=mark0&&-1!=para1.indexOf("checkurl=")?decodeURIComponent(para1.split("checkurl=")[1].split("&")[0]):"";typeQ=""!=PRelay?"server":typeQ;var typec="",Pflow=mark0&&-1!=para1.indexOf("flow=")?para1.split("flow=")[1].split("&")[0]:0,PProfile=mark0&&-1!=para1.indexOf("profile=")?para1.split("profile=")[1].split("&")[0]:0,Palpn=mark0&&-1!=para1.indexOf("alpn=")&&version>=712?para1.split("alpn=")[1].split("&")[0]:"",Pobfs=mark0&&-1!=para1.indexOf("obfs=")&&version>=770?para1.split("obfs=")[1].split("&")[0]:"",Psession=mark0&&-1!=para1.indexOf("tsession=")&&version>=771?para1.split("tsession=")[1].split("&")[0]:"",RegoutList=[],ADDres="quantumult-x:///add-resource?remote-resource=url-encoded-json",RLink='{\n  "server_remote": [\n    sremoteposition\n  ],\n  "filter_remote": [\n    fremoteposition\n  ],\n  "rewrite_remote": [\n    rremoteposition\n  ]\n}',ProfileInfo={server:"",filter:"",rewrite:""};function VCheck(e){return cnts=e.split("\n").filter(Boolean).map((e=>e.trim())).filter((e=>/^http/.test(e))).map((e=>'"'+e+'"')),cnts=cnts.join(",\n"),cnts}function Profile_Handle(){let e=content0;PProfile=9==(PProfile=8==(PProfile=1==PProfile?"001":PProfile)?"010":PProfile)?"011":PProfile,srm=e.split("[server_remote]")[1]&&"1"==String(PProfile)[0]?VCheck(e.split("[server_remote]")[1].split("[")[0]):"",frm=e.split("[filter_remote]")[1]&&"1"==String(PProfile)[1]?VCheck(e.split("[filter_remote]")[1].split("[")[0]):"",rrm=e.split("[rewrite_remote]")[1]&&"1"==String(PProfile)[2]?VCheck(e.split("[rewrite_remote]")[1].split("[")[0]):"",RLink=RLink.replace("sremoteposition",srm).replace("fremoteposition",frm).replace("rremoteposition",rrm),ADDres=ADDres.replace("url-encoded-json",encodeURIComponent(RLink))}var Finfo={};if(0!=Pflow){Pflow=Pflow.split(":");var Bdate=Date.parse(new Date(Pflow[0]))/1e3,Btotal=Pflow[1]?1024*Pflow[1]*1024*1024:0,Bused=Pflow[2]?1024*Pflow[2]*1024*1024:0,Bremain=0!=Btotal?Btotal-Bused:1,BJson={bytes_used:Bused,bytes_remaining:Bremain,expire_date:Bdate};Finfo=BJson}var pat=[];pat[0]=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","k","r","s","t","u","v","w","x","y","z"],pat[1]=["🅰","🅱","🅲","🅳","🅴","🅵","🅶","🅷","🅸","🅹","🅺","🅻","🅼","🅽","🅾","🅿","🅺","🆁","🆂","🆃","🆄","🆅","🆆","🆇","🆈","🆉"],pat[2]=["🄰","🄱","🄲","🄳","🄴","🄵","🄶","🄷","🄸","🄹","🄺","🄻","🄼","🄽","🄾","🄿","🄺","🅁","🅂","🅃","🅄","🅅","🅆","🅇","🅈","🅉"],pat[3]=["𝐀","𝐁","𝐂","𝐃","𝐄","𝐅","𝐆","𝐇","𝐈","𝐉","𝐊","𝐋","𝐌","𝐍","𝐎","𝐏","𝐊","𝐑","𝐒","𝐓","𝐔","𝐕","𝐖","𝐗","𝐘","𝐙"],pat[4]=["𝗮","𝗯","𝗰","𝗱","𝗲","𝗳","𝗴","𝗵","i","𝗷","𝗸","𝗹","𝗺","𝗻","𝗼","𝗽","𝗸","𝗿","𝘀","𝐭","𝘂","𝘃","𝘄","𝘅","𝘆","𝘇"],pat[5]=["𝔸","𝔹","ℂ","𝔻","𝔼","𝔽","𝔾","ℍ","𝕀","𝕁","𝕂","𝕃","𝕄","ℕ","𝕆","ℙ","𝕂","ℝ","𝕊","𝕋","𝕌","𝕍","𝕎","𝕏","𝕐","ℤ"],pat[6]=["𝕒","𝕓","𝕔","𝕕","𝕖","𝕗","𝕘","𝕙","𝕚","𝕛","𝕜","𝕝","𝕞","𝕟","𝕠","𝕡","𝕜","𝕣","𝕤","𝕥","𝕦","𝕧","𝕨","𝕩","𝕪","𝕫"],pat[7]=["ᵃ","ᵇ","ᶜ","ᵈ","ᵉ","ᶠ","ᵍ","ʰ","ⁱ","ʲ","ᵏ","ˡ","ᵐ","ⁿ","ᵒ","ᵖ","ᵒ⃒","ʳ","ˢ","ᵗ","ᵘ","ᵛ","ʷ","ˣ","ʸ","ᙆ"],pat[8]=["ᴬ","ᴮ","ᒼ","ᴰ","ᴱ","ᶠ","ᴳ","ᴴ","ᴵ","ᴶ","ᴷ","ᴸ","ᴹ","ᴺ","ᴼ","ᴾ","ᴼ̴","ᴿ","ˢ","ᵀ","ᵁ","ᵛ","ᵂ","ˣ","ʸ","ᙆ"];var patn=[];patn[0]=["0","1","2","3","4","5","6","7","8","9"],patn[1]=["⓪","①","②","③","④","⑤","⑥","⑦","⑧","⑨"],patn[2]=["⓪","❶","❷","❸","❹","❺","❻","❼","❽","❾"],patn[3]=["⓪","⓵","⓶","⓷","⓸","⓹","⓺","⓼","⓻","⓽"],patn[4]=["𝟘","𝟙","𝟚","𝟛","𝟜","𝟝","𝟞","𝟟","𝟠","𝟡"],patn[5]=["⁰","¹","²","³","⁴","⁵","⁶","⁷","⁸","⁹"],patn[6]=["₀","₁","₂","₃","₄","₅","₆","₇","₈","₉"],patn[7]=["𝟎","𝟏","𝟐","𝟑","𝟒","𝟓","𝟔","𝟳","𝟖","𝟗"],patn[8]=["𝟶","𝟷","𝟸","𝟹","𝟺","𝟻","𝟼","𝟽","𝟾","𝟿"];const getValue=(e,t)=>{try{return e()}catch(e){return t}};var type0="",flag=1;function Parser(){if("web"!=(type0=Type_Check(content0))&&"wrong-field"!=type0&&"JS-0"!=type0)try{Pdbg&&$notify(link0,type0,content0),total=ResourceParse()}catch(e){0==Perror&&$notify("❌ 解析出现错误","⚠️ 请点击通知，发送订阅链接进行反馈",e,bug_link)}else if("wrong-field"==type0){if(version>=670&&""!=typec){RLink0[Field[typec]].push($resource.link+", opt-parser=true, tag=下次添加资源🉑️长点❤️8⃣️");const e={"open-url":ADDRes.replace(/url-encoded-json/,encodeURIComponent(JSON.stringify(RLink0))),"media-url":"https://shrtm.nu/obcB"};$notify("⚠️ 请点击通知跳转尝试添加到正确类型中","❌ 检测类型 ["+typec+"] 与填入类型 ["+typeQ+"] 冲突","如果跳转添加仍旧失败，请发送链接反馈解析器 bot\n"+$resource.link,e)}else $notify("❌ 检测类型「"+typec+" 」与目标类型「"+typeQ+" 」冲突","⚠️ 请自行检查链接内容，或点击通知发送链接进行反馈",$resource.link,bug_link);total=""}else total="";$done({content:total})}if("undefined"!=typeof $resource&&0==PProfile)Parser(),$done({content:total,info:Finfo});else if(0!=PProfile){try{Profile_Handle()}catch(e){0==Perror&&$notify("❌ 解析出现错误","⚠️ 请点击通知，发送订阅链接进行反馈",e,bug_link)}openlink={"open-url":ADDres},$notify("⚠️请忽略报错提示，点击此通知跳转","添加配置中的有效远程资源👇 ["+PProfile+"]",ADDres,openlink),total=ProfileInfo[typeQ],$done({content:total})}function ParseUnknown(e){try{(e=JSON.parse(e))&&$notify("⚠️ 链接返回内容并非有效订阅⟦"+subtag+"⟧","⁉️ 请自行检查原始链接，返回内容 👇️👇️",JSON.stringify(e),bug_link)}catch(t){/error|block|invalid|support/.test(e.toLowerCase())?$notify("💢 ⟦"+subtag+"⟧ 返回内容无效","😠 请自行检查订阅，不要跑来反馈","订阅返回内容：👇 \n"+e,plink0):$notify("😭 未能识别订阅 ⟦"+subtag+"⟧ 的内容","⚠️ 将尝试直接导入 Quantumult X \n 如认为是 BUG, 请点通知跳转并 [发送链接] 反馈","订阅返回内容：👇 \n"+e,bug_link)}}function ResourceParse(){if("Subs-B64Encode"==type0)Pdbg&&$notify("original content","node-b64",content0),total=Subs2QX(Base64.decode(content0),Pudp0,Ptfo0,Pcert0,PTls13);else if("Subs"==type0)total=Subs2QX(content0,Pudp0,Ptfo0,Pcert0,PTls13);else if("QuanX"==type0||"Clash"==type0||"Surge"==type0)total=Subs2QX(isQuanX(content0).join("\n"),Pudp0,Ptfo0,Pcert0,PTls13);else if("sgmodule"==type0)flag=2,total=Rewrite_Filter(isQuanXRewrite(content0.split("\n")),Pin0,Pout0,Preg,Pregout),Preplace&&(total=ReplaceReg(total,Preplace)),total=total.filter(((e,t)=>total.indexOf(e)==t)),total=Pcdn?CDN(total):total.join("\n");else if("rewrite"==type0)flag=2,total=Rewrite_Filter(isQuanXRewrite(content0.split("\n")),Pin0,Pout0,Preg,Pregout),Preplace&&(total=ReplaceReg(total,Preplace)),total=total.filter(((e,t)=>total.indexOf(e)==t)),total=Pcdn?CDN(total):total.join("\n");else if("Rule"==type0)flag=3,total=Rule_Handle(content0.split("\n").map((e=>e.trim())).filter(Boolean),Pout0,Pin0).filter(Boolean),Preg&&0!=total.length&&(total=total.map(Regex).filter(Boolean),RegCheck(total,"分流引用","regex",Preg)),Pregout&&0!=total.length&&(total=total.map(RegexOut).filter(Boolean),RegCheck(total,"分流引用","regout",Pregout)),Preplace&&(total=ReplaceReg(total,Preplace)),Ppolicyset&&(total=policy_sets(total,Ppolicyset)),total=total.length<100?total.filter(((e,t)=>total.indexOf(e)==t)):total,total=total.join("\n");else if(""==content0.trim())$notify("‼️ 引用⟦"+subtag+"⟧ 返回內容为空","⁉️ 点通知跳转以确认链接是否失效",para.split("#")[0],nan_link),flag=0;else if("sub-http"==type0){let e=VCheck(String(Base64.decode(content0.split("sub://")[1].split("#")[0])+", opt-parser=true, tag="+(new Date).getTime()));RLink=RLink.replace("sremoteposition",e).replace("fremoteposition","").replace("rremoteposition","");let t=ADDres.replace("url-encoded-json",encodeURIComponent(RLink));openlink={"open-url":t},$notify("⚠️ 该链接为节点订阅，请点击此通知跳转添加",e,t,openlink),flag=-1,total=""}else"unknown"==type0?(ParseUnknown(content0),flag=-1):"profile"==type0?(PProfile="111",Profile_Handle(),openlink={"open-url":ADDres},$notify("⚠️ 该链接为完整配置文件，请点击此通知跳转","添加配置中的有效远程资源👇 ["+PProfile+"]",ADDres,openlink),flag=-1,total=""):"JS-0"==type0&&(total="");return 1==flag?(total=isQuanX(total.filter(Boolean).join("\n")),1==Pinfo&&0==ntf_flow&&flowcheck(total),(Pin0||Pout0)&&(total=Filter(total,Pin0,Pout0)),Preg&&(total=total.map(Regex).filter(Boolean),RegCheck(total,"节点订阅","regex",Preg)),Pregout&&(total=total.map(RegexOut).filter(Boolean),RegCheck(total,"节点订阅","regout",Pregout)),Psfilter&&(total=FilterScript(total,Psfilter)),Prrname&&(Prn=Prrname,total=total.map(Rename)),Pregdel&&(delreg=Pregdel,total=total.map(DelReg)),Psrename&&(total=RenameScript(total,Psrename)),Preplace&&(total=ReplaceReg(total,Preplace)),Prname&&(Prn=Prname,total=total.map(Rename),1==Pdbg&&$notify("rename","content",total)),Pemoji&&(total=emoji_handle(total,Pemoji)),total.length>0?(1!=Psuffix&&-1!=Psuffix||(total=1==Psuffix?total.map(type_suffix):total.map(type_prefix)),total=total.map(type_handle).map(emoji_prefix_handle).map(tag_handle),Psort0&&(total=QXSort(total,Psort0)),total=-1!=para1.indexOf("node_index_prefix")?index_handle(total):total,total=TagCheck_QX(total).join("\n"),1==PUOT&&(total=total.split("\n").map(UOT).join("\n")),1==Pcnt&&$notify("⟦"+subtag+"⟧解析后最终返回内容","节点数量："+total.split("\n").length,total),total=""==PRelay?Base64.encode(total):ServerRelay(total.split("\n"),PRelay),1==Pflow?$done({content:total,info:{bytes_used:3073741824,bytes_remaining:2147483648,expire_date:1854193966}}):$done({content:total})):(0==Perror&&$notify("❓❓ 友情提示 ➟ ⟦"+subtag+"⟧","⚠️⚠️ 解析后无有效内容","🚥🚥 请自行检查相关参数，或者点击通知跳转并发送链接反馈",bug_link),total=errornode,$done({content:errornode}))):0==flag?(total=errornode,$done({content:errornode})):-1==flag&&(total=content0,$done({content:content0})),1==Pcnt&&1!=flag&&$notify("解析后最终返回内容","总数量： "+total.split("\n").length,total),total}function SubFlow(){if(1==Pinfo&&subinfo){var e=subinfo.replace(/ /g,"").toLowerCase(),t="总流量："+(parseFloat(e.split("total=")[1].split(",")[0])/1024**3).toFixed(2)+"GB",s="已用流量："+((parseFloat(-1!=e.indexOf("upload")?e.split("upload=")[1].split(",")[0]:"0")+parseFloat(e.split("download=")[1].split(",")[0]))/1024**3).toFixed(2)+"GB",r="剩余流量："+(parseFloat(e.split("total=")[1].split(",")[0])/1024**3-(parseFloat(-1!=e.indexOf("upload")?e.split("upload=")[1].split(",")[0]:"0")+parseFloat(e.split("download=")[1].split(",")[0]))/1024**3).toFixed(2)+"GB";if(-1!=e.indexOf("expire=")){var i=new Date(1e3*parseFloat(e.split("expire=")[1].split(",")[0])),n=i.getFullYear(),o=i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1,a=i.getDate()<10?"0"+i.getDate():i.getDate();i="过期时间："+n+"-"+o+"-"+a}else i="";ntf_flow=1,$notify("流量信息：⟦"+subtag+"⟧",i,t+"\n"+s+", "+r,subinfo_link)}}function flowcheck(e){for(var t=0;t<e.length;t++){var s=e[t],r=s.slice(s.indexOf("tag")),i=r.slice(r.indexOf("=")+1);-1!=s.indexOf("剩余流量")?flow=i:-1!=s.indexOf("期时间")&&(exptime=i)}flow=flow||"⚠️ 该订阅未返回任何流量信息",exptime=exptime||"⚠️ 该订阅未返回套餐时间信息",""!=flow&&$notify("流量信息：⟦"+subtag+"⟧",flow,exptime,subinfo_link1)}function RegCheck(e,t,s,r){if(0==e.length)$notify("‼️ "+t+"  ➟ ⟦"+subtag+"⟧","⛔️ 筛选正则："+s+"="+r,"⚠️ 筛选后剩余项为 0️⃣ , 请检查正则参数及原始链接",nan_link);else if("节点订阅"!=t&&0!=Pntf0||"节点订阅"==t&&1==Pntf0){var i=e.length<=10?emojino[e.length]:e.length;$notify("🤖 "+t+"  ➟ ⟦"+subtag+"⟧","⛔️ 筛选正则："+s+"="+r,"⚠️ 筛选后剩余以下"+i+"个匹配项 \n ⨷ "+e.join("\n ⨷ "),sub_link)}}function Type_Check(e){var t="unknown",s=["host,","-suffix,","domain,","-keyword,","ip-cidr,","ip-cidr6,","geoip,","user-agent,","ip6-cidr,","ip-asn"],r=["shadowsocks=","trojan=","vmess=","http=","socks5="],i=["=ss,","=vmess,","=trojan,","=http,","=custom,","=https,","=shadowsocks","=shadowsocksr","=sock5","=sock5-tls"],n=["dm1lc3M","c3NyOi8v","CnNzOi8","dHJvamFu","c3M6Ly","c3NkOi8v","c2hhZG93","aHR0cDovLw","aHR0cHM6L","CnRyb2phbjo","aHR0cD0","aHR0cCA","U1RBVFVT"],o=["[filter_local]","[filter_remote]","[server_local]","[server_remote]"],a="DOCTYPE html",p=e.replace(/ /g,"");const l=e=>-1!=p.toLowerCase().indexOf(e),f=e=>-1!=p.toLowerCase().indexOf(e.toLowerCase()),c=t=>-1!=e.indexOf(t),u=t=>-1!=e.indexOf(t);var d=e.split("\n");if(-1==e.indexOf(a)&&-1==e.indexOf("doctype html")||!link0.indexOf(!1))if("nodes"==typeU&&"server"==typeQ)t="unsupported"==typeQ||"server"==typeQ?"Subs":"wrong-field";else if(["proxies:"].some(f)||"clash"==typeU)t="unsupported"==typeQ||"server"==typeQ?"Clash":"wrong-field",typec="server",content0=Clash2QX(e);else if((!["[Script]","[Rule]","[URL Rewrite]","[Map Local]","\nhttp-r","script-path"].some(c)&&-1==para1.indexOf("dst=rewrite")||-1!=para1.indexOf("dst=filter")||-1!=e.indexOf("[Proxy]"))&&"module"!=typeU||"nodes"==typeU||"rule"==typeU||"filter"==typeQ)if(!/(^hostname|\nhostname)\s*\=/.test(p)&&![" url 302"," url 307"," url reject"," url script"," url req"," url res"," url echo"," url-and-header 302"," url-and-header 307"," url-and-header reject"," url-and-header script"," url-and-header req"," url-and-header res"," url-and-header echo"].some(c)||-1!=para1.indexOf("dst=filter")||-1!=p.indexOf("securehostname")||/module|nodes|rule/.test(typeU)||s.some(l)&&"filter"==typeQ||"rewrite"!=typeQ&&o.some(u))if(!(s.some(l)&&-1==e.indexOf(a)||"rule"==typeU||-1!=para1.indexOf("dst=filter"))||"nodes"==typeU||"server"==typeQ&&(r.some(f)||i.some(f)))if("domain-set"==typeU)typec="filter-domain-set",t="unsupported"==typeQ||"filter"==typeQ?"Rule":"wrong-field",content0=Domain2Rule(content0);else if("filter"==typeQ&&-1==e.indexOf("payload:"))typec="filter-list",t="unsupported"==typeQ||"filter"==typeQ?"Rule":"wrong-field",content0=content0.split("\n").map(rule_list_handle).join("\n");else if(0==p.indexOf("sub://"))typec="sub-http",t="sub-http";else if("filter"==typeQ&&-1!=e.indexOf("payload:"))typec="Clash-Provider",t="unsupported"==typeQ||"filter"==typeQ?"Rule":"wrong-field";else if(d.length>=1&&["ss://","vmess://","ssr://","trojan://","ssd://","\nhttps://","\nhttp://","socks://","ssocks://","vless://"].some((e=>-1!=p.toLowerCase().indexOf(e.toLowerCase())))&&!/\[(Proxy|filter_local)\]/.test(e))typec="server-uri",t="unsupported"==typeQ||"server"==typeQ||"uri"==typeQ?"Subs":"wrong-field";else if(-1!=p.indexOf("tag=")&&r.some(f)&&!/\[(Proxy|filter_local)\]/.test(e)||"list"==typeU)typec="server-quanx",t="unsupported"==typeQ||"server"==typeQ||"uri"==typeQ?"Subs":"wrong-field";else if(-1!=e.indexOf("[Proxy]"))typec="server-surge",t="unsupported"==typeQ||"server"==typeQ||"uri"==typeQ?"Surge":"wrong-field",content0=Surge2QX(content0).join("\n");else if(i.some(f)&&!/\[(Proxy|filter_local)\]/.test(e)||"list"==typeU)typec="server-surge",t="unsupported"==typeQ||"server"==typeQ||"uri"==typeQ?"Subs":"wrong-field";else if(-1!=e.indexOf("[server_local]")&&r.some(f))typec="server-quanx",t="unsupported"==typeQ||"server"==typeQ||"uri"==typeQ?"Subs":"wrong-field";else if(-1!=content0.indexOf("server")&&-1!=content0.indexOf("server_port"))typec="server-sip008",t="unsupported"==typeQ||"server"==typeQ?"Subs":"wrong-field",content0=SIP2QuanX(content0);else if(n.some((e=>-1!=p.toLowerCase().indexOf(e.toLowerCase())))){if(typec="server-b64",t="unsupported"==typeQ||"server"==typeQ?"Subs-B64Encode":"wrong-field",content0.split("\n").length>=2){let e=content0.split("\n")[1];Pdbg&&$notify("local","node","\ntmp:\n"+e),n.some((t=>-1!=e.toLowerCase().indexOf(t.toLowerCase())))&&(content0=e)}}else o.every(u)?(typec="profile",t="profile"):/\.js/.test(link0)?(Perror=1,$notify("⚠️ 你导入的链接内容为 JS 脚本","🚥 脚本内未有重写规则，无法解析使用"," 请⚠️不要⚠️跑来解析器🤖️反馈 \n"+link0),t="JS-0"):"server"==typeQ&&e.length>100&&(typec="server-b64-unknown",t="unsupported"==typeQ||"server"==typeQ?"Subs-B64Encode":"wrong-field");else typec="filter",t="unsupported"==typeQ||"filter"==typeQ?"Rule":"wrong-field";else typec="rewrite",t="unsupported"==typeQ||"rewrite"==typeQ?"rewrite":"wrong-field";else typec="rewrite",t="unsupported"==typeQ||"rewrite"==typeQ?"sgmodule":"wrong-field";else $notify("‼️ 该链接返回为无效网页内容 ➟ ⟦"+subtag+"⟧","⁉️ 点通知跳转以确认链接是否失效\n"+link0,"返回内容如下⬇️：\n"+e,nan_link),t="web";return"X"==typeU&&$notify("该链接判定类型",t+" : "+typec,e),t}function TagCheck_QX(e){typefix={shadowsocks:["𝐬𝐬","𝐒𝐒","🅢🅢","🆂🆂","ⓢⓢ","🅂🅂","SS"],shadowsocksr:["𝐬𝐬𝐫","𝐒𝐒𝐑","🅢🅢🅡","🆂🆂🆁","ⓢⓢⓡ","🅂🅂🅁","SSR"],vmess:["𝐯𝐦𝐞𝐬𝐬","𝐕𝐌𝐄𝐒𝐒","🅥🅜🅔🅢🅢","🆅🅼🅴🆂🆂","ⓥⓜⓔⓢⓢ","🅅🄼🄴🅂🅂","VMESS"],trojan:["𝐭𝐫𝐨𝐣𝐚𝐧","𝐓𝐑𝐎𝐉𝐀𝐍","🅣🅡🅞🅙🅐🅝","🆃🆁🅾🅹🅰🅽","ⓣⓡⓞⓙⓐⓝ","🅃🅁🄾🄹🄰🄽","TROJAN"],http:["𝐡𝐭𝐭𝐩","𝐇𝐓𝐓𝐏","🅗🅣🅣🅟","🅷🆃🆃🅿","ⓗⓣⓣⓟ","🄷🅃🅃🄿","HTTP"],socks5:["𝐬𝐨𝗰𝗸𝐬","𝐒𝐎𝐂𝐊𝐒","🅢🅞🅒🅚🅢","🆂🅾🅲🅺🆂","ⓢⓄⒸⓀⓢ","🅂🄾🄲🄺🅂","SOCKS"],vless:["𝐯𝐥𝐞𝐬𝐬","𝐕𝐋𝐄𝐒𝐒","🅥🅛🅔🅢🅢","🆅🅻🅴🆂🆂","ⓥⓛⓔⓢⓢ","🅅🄻🄴🅂🅂","VLESS"]};for(var t=e.map((e=>e.trim())),[s,r]=[[],[]],[i,n]=[[],[]],o=0,a=0;a<t.length;a++){var p=t[a]?t[a]:"";if(typefix.shadowsocks=-1!=p.indexOf("ssr-protocol")?typefix.shadowsocksr:typefix.shadowsocks,-1!=p.replace(/ /gm,"").indexOf("tag=")){var l=p.slice(p.indexOf("tag")),f=l.slice(l.indexOf("=")+1);""==f&&(tp=typefix[p.split("=")[0].trim()][3],f=tp+" | "+p.split("=")[1].split(",")[0].split(":")[0],p=p.split("tag")[0]+"tag="+f.replace("shadowsocks","ss"),i.push(f.replace("shadowsocks","ss")));for(var c=0;-1!=r.indexOf(f);)f=0==c?f+NoReplace(c+1):f.split(" ").slice(0,f.split(" ").length-2).join(" ")+NoReplace(c+1),p=1!=Pdel?p.split("tag")[0]+"tag="+f:"",c+=1;0!=c&&n.push(f),r.push(f),Pcap&&(p=Capitalize(p,Pcap)),(Pptn||Pnptn)&&(p=Pattern(p,Pptn,Pnptn)),c=0,p&&s.push(p)}}return""!=PcheckU&&(s=s.map(Add_URL)),i.length>=1&&(o=i.length<=10?emojino[i.length]:i.length,$notify("⚠️ 引用⟦"+subtag+"⟧ 内有"+o+"个空节点名 ","✅ 已将节点“类型+IP”设为节点名"," ⨁ "+i.join("\n ⨁ "),nan_link)),n.length>=1&&(o=n.length<=10?emojino[n.length]:n.length,1!=Pdel&&0!=Pntf0?$notify("⚠️ 引用⟦"+subtag+"⟧ 内有"+o+"个名字重复的节点 ","✅ 已添加数字区分，删除请添加参数 del=1:"," ⨁ "+n.join("\n ⨁ "),nan_link):1==Pdel&&0!=Pntf0&&$notify("⚠️ 引用⟦"+subtag+"⟧ 内有"+o+"个名字重复的节点 ","❌️ 已全部删除，如需保留请去除参数 del=1:"," ⨁ "+n.join("\n ⨁ "),nan_link)),s}function Add_URL(e){return e&&(e=e+", server_check_url="+PcheckU),e}function NoReplace(e){if(e){for(var t=0;t<10;t++)e=e.toString().replace(new RegExp(patn[0][t],"gmi"),patn[5][t]);return" "+e+" "}}function PatternN(e,t,s){if(e){if(""!=t)for(var r=0;r<26;r++)e=(e=e.toLowerCase()).replace(new RegExp(pat[0][r],"gmi"),pat[t][r]);if(""!=s)for(r=0;r<10;r++)e=e.replace(new RegExp(patn[0][r],"gmi"),patn[s][r]);return e}}function Pattern(e,t,s){return""==t&&""==s||(e=e.split("tag=")[0]+"tag="+PatternN(e.split("tag=")[1],t,s)),e}function Capitalize(e,t){return 1==t?e=e.split("tag=")[0]+"tag="+e.split("tag=")[1].toUpperCase():-1==t?e=e.split("tag=")[0]+"tag="+e.split("tag=")[1].toLowerCase():0==t&&(e=e.split("tag=")[0]+"tag="+titleCase(e.split("tag=")[1])),e}function titleCase(e){for(var t=e.split(" "),s=0;s<t.length;s++)t[s]=t[s].slice(0,1).toUpperCase()+t[s].slice(1).toLowerCase();return t.join(" ")}function type_prefix(e){if(""!=e.trim())return typefix={shadowsocks:"「𝐬𝐬」",vmess:"「𝐯𝐦𝐞𝐬𝐬」",trojan:"「𝐭𝐫𝐨𝐣𝐚𝐧」",http:"「𝐡𝐭𝐭𝐩」",socks5:"「𝐬𝐨𝗰𝗸𝐬」",vless:"「𝐯𝐥𝐞𝐬𝐬」"},typefix.shadowsocks=-1!=e.indexOf("ssr-protocol")?"「𝐬𝐬𝐫」":"「𝐬𝐬」",tp=typefix[e.split("=")[0].trim()],[[e.split("tag=")[0]+"tag=",tp,e.split("tag=")[1]].join(" ")].join(" ")}function type_suffix(e){if(""!=e.trim())return typefix={shadowsocks:"「𝐬𝐬」",vmess:"「𝐯𝐦𝐞𝐬𝐬」",trojan:"「𝐭𝐫𝐨𝐣𝐚𝐧」",http:"「𝐡𝐭𝐭𝐩」",vless:"「𝐯𝐥𝐞𝐬𝐬」"},typefix.shadowsocks=-1!=e.indexOf("ssr-protocol")?"「𝐬𝐬𝐫」":"「𝐬𝐬」",tp=typefix[e.split("=")[0].trim()],[e,tp].join(" ")}function getnode_type(e,t){if(""!=e.trim()&&-1!=e.indexOf("tag="))return t=/^(0|1|2|3|4|5|6|7)$/.test(t)?t:8,typefix={shadowsocks:["𝐬𝐬","𝐒𝐒","🅢🅢","🆂🆂","ⓢⓢ","🅂🅂","𝕊𝕊","ˢˢ","SS"],shadowsocksr:["𝐬𝐬𝐫","𝐒𝐒𝐑","🅢🅢🅡","🆂🆂🆁","ⓢⓢⓡ","🅂🅂🅁","𝕊𝕊ℝ","ˢˢʳ","SSR"],vmess:["𝐯𝐦𝐞𝐬𝐬","𝐕𝐌𝐄𝐒𝐒","🅥🅜🅔🅢🅢","🆅🅼🅴🆂🆂","ⓥⓜⓔⓢⓢ","🅅🄼🄴🅂🅂","𝕍𝕞𝕖𝕤𝕤","ᵛᵐᵉˢˢ","VMESS"],trojan:["𝐭𝐫𝐨𝐣𝐚𝐧","𝐓𝐑𝐎𝐉𝐀𝐍","🅣🅡🅞🅙🅐🅝","🆃🆁🅾🅹🅰🅽","ⓣⓡⓞⓙⓐⓝ","🅃🅁🄾🄹🄰🄽","𝕋𝕣𝕠𝕛𝕒𝕟","ᵀʳᵒʲᵃⁿ","TROJAN"],http:["𝐡𝐭𝐭𝐩","𝐇𝐓𝐓𝐏","🅗🅣🅣🅟","🅷🆃🆃🅿","ⓗⓣⓣⓟ","🄷🅃🅃🄿","𝕙𝕥𝕥𝕡","ʰᵗᵗᵖ","HTTP"],socks5:["𝐬𝐨𝗰𝗸𝐬","𝐒𝐎𝐂𝐊𝐒","🅢🅞🅒🅚🅢","🆂🅾🅲🅺🆂","ⓢⓞⓒⓚⓢ","🅂🄾🄲🄺🅂","𝕤𝕠𝕔𝕜𝕤","ˢᵒᶜᵏˢ","SOCKS"],vless:["𝐯𝐥𝐞𝐬𝐬","𝐕𝐋𝐄𝐒𝐒","🅥🅛🅔🅢🅢","🆅🅻🅴🆂🆂","ⓥⓛⓔⓢⓢ","🅅🄻🄴🅂🅂","𝕍𝕝𝕖𝕤𝕤","ᵛˡᵉˢˢ","VLESS"]},typefix.shadowsocks=-1!=e.indexOf("ssr-protocol")?typefix.shadowsocksr:typefix.shadowsocks,tp=typefix[e.split("=")[0].trim()][t],tp}function type_handle(e){return-1!=e.indexOf("node_type_para_prefix")&&(e=e.replace(/node_type_para_prefix(\d{0,1})/g,getnode_type(e,e.split("node_type_para_prefix")[1][0]))),e}function index_handle(e){items=e.map((e=>e.trim())).filter(Boolean);Array.from(new Array(items.length),((e,t)=>t+1));for(var t=0;t<items.length;t++)-1!=items[t].indexOf("node_index_prefix")&&(ind=items[t].split("node_index_prefix")[1][0],ind=/^(0|1|2|3|4|5|6|7|8)$/.test(ind)?ind:0,items[t]=items[t].replace(/node_index_prefix(\d{0,1})/g,PatternN((t+1).toString(),"",ind)));return items}function emoji_prefix_handle(e){return-1!=e.indexOf("node_emoji_flag_prefix")&&(e=e.replace(/node_emoji_flag_prefix\d{0,1}/g,getnode_emoji(e,e.split("node_emoji_flag_prefix")[1][0]))),e}function getnode_emoji(e,t){if(t=/^(1|2)$/.test(t)?t:2,-1!=e.indexOf("tag="))return get_emoji(t,e.split("tag=")[1])[1]}function tag_handle(e){return-1!=e.indexOf("node_tag_prefix")&&(ptnn=/\d/.test(e.split("node_tag_prefix")[1][0])?e.split("node_tag_prefix")[1][0]:"",nptnn=/\d/.test(e.split("node_tag_prefix")[1][1])?e.split("node_tag_prefix")[1][1]:"",e=e.replace(/node_tag_prefix\d{0,2}/g,PatternN(subtag,ptnn,nptnn))),e}function URI_TAG(e,t){return e=e.split("tag=")[0]+"tag="+t}function ServerRelay(e,t){for(var s=[],r=0;r<e.length;r++)serverA=-1==e[r].indexOf("-host")?e[r].split("=")[1].split(":")[0].trim():e[r].split("-host")[1].split("=")[1].split(",")[0].trim(),type=/^[a-z]/.test(serverA)||/[a-z]$/.test(serverA)?"host":"ip",rst="ip"==type?"ip-cidr,"+serverA+"/32,"+t:"host-suffix,"+serverA+","+t,s.push(rst);return s.join("\n")}function rawtest(e){if(RegExp('.*js-file-line".*?</td>',"i").test(e))return e.replace(/(.*js-file-line\"\>)(.*?)(\<\/td\>)/g,"$2").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").trim()}function ToRaw(e){e=e.split("\n").map(rawtest).filter(Boolean).join("\n");var t=link0.replace("github.com","raw.githubusercontent.com").replace("/blob","");return e?$notify("⚠️⚠️ 将尝试解析该资源⟦"+subtag+"⟧","🚥 请正确使用 GitHub 的 raw 链接","❌ 你的链接："+link0+"\n✅ 正确链接："+t,{"open-url":t}):-1!=content0.indexOf("gridcell")&&$notify("⚠️⚠️ 解析该资源 ⟦"+subtag+"⟧ 失败","🚥 你的链接似乎是目录，而不是文件","❌ 你的链接："+link0,{"open-url":link0}),e}function CDN(e){return e=e.join("\n").replace(/https:\/\/raw.githubusercontent.com\/(.*?)\/(.*?)\/(.*)/gim,"https://fastly.jsdelivr.net/gh/$1/$2@$3")}function HOST_Handle(e,t){return-1==(t="host="+t+",").indexOf("☠️")?e=e.replace(/host\s*\=(.*?)\,/,t):(t=t.split("☠️")[0],/-host\s*\=/.test(e)?e=e.replace(/host\s*\=(.*?)\,/,t+", "):/over-tls\s*\=\s*true/.test(e)?e=e+", tls-"+t:/obfs\s*\=/.test(e)&&(e=e+", obfs-"+t)),e}function OBFS_Handle(e,t){return t="shttp"==t?"obfs=shadowsocks-http":"vhttp"==t?"obfs=vmess-http":"invalid",/obfs\s*\=\s*http/.test(e)&&"invalid"!=t&&(e=e.replace(/obfs\s*\=\s*http/,t)),e}function Session_Handle(e,t){let s=", tls-no-session-ticket=true",r=", tls-no-session-reuse=true";return 0==t?e+=s:1==t?e+=r:2==t&&(e=e+s+r),e}function SHA256_Handle(e,t,s){return-1==e.indexOf("over-tls=true")&&-1==e.indexOf("obfs=wss")||(e=e.replace(/tls-verification\s*\=\s*false(\s*)\,/,""),e=""!=t?e.replace(/tag\s*\=/,"tls-cert-sha256="+t+", tag="):e,e=""!=s?e.replace(/tag\s*\=/,"tls-pubkey-sha256="+s+", tag="):e),e}function ALPN_Handle(e,t){return cnti=e.replace(/\s/gim,""),-1==cnti.indexOf("obfs=over-tls")&&-1==cnti.indexOf("over-tls=true")||(e=e+", tls-alpn="+t),e}function Mock2QXReject(e,t){return/dict/i.test(t)?e.replace(/ /g,"").split("data=")[0]+" url reject-dict":/array/i.test(t)?e.replace(/ /g,"").split("data=")[0]+" url reject-array":/(txt|html)/i.test(t)?e.replace(/ /g,"").split("data=")[0]+" url reject-200":/(png|jpg|gif)/i.test(t)?e.replace(/ /g,"").split("data=")[0]+" url reject-img":e.replace(/ /g,"").split("data=")[0]+" url reject"}function URX2QX(e){var t=[],s="";e=e.split("\n");for(var r=["//","#",";"],i=0;i<e.length;i++){const n=t=>0==e[i].indexOf(t);if(!r.some(n))if("URL-REGEX"==e[i].slice(0,9))-1==e[i].indexOf("REJECT")&&2!=e[i].split(",").length||"*"!=e[i].replace(/ /g,"").split(",REJECT")[0].split("GEX,")[1].slice(0,1)&&(s=e[i].replace(/ /g,"").split(",REJECT")[0].split("GEX,")[1]+" url reject-200",t.push(s));else if(-1!=e[i].indexOf("data=")&&-1!=e.indexOf("[Map Local]")){let r=e[i].match(/data=.+\/(.+)"/)?e[i].match(/data=.+\/(.+)"/)[1]:null;if(!/header=".*content-type/i.test(e[i])&&/blank/i.test(r))s=Mock2QXReject(e[i],r);else if(s=e[i].replace(/ /g,"").split("data=")[0].replace(/\"/g,"")+" url echo-response text/html echo-response "+e[i].split("data=")[1].split(" ")[0].replace(/\"/g,"").replace(/ /g,""),-1!=e[i].indexOf("header=")&&-1!=e[i].indexOf("Content-Type:")){let t=e[i].split("header=")[1].split("Content-Type:")[1].split(",")[0].replace(/\"/g,"");s=s.replace(/text\/html/g,t)}t.push(s)}}return t}function SCP2QX(e){var t=[],s="",r=[" url 302"," url 307"," url reject"," url script"," url req"," url res"," url echo"," url-and-header 302"," url-and-header 307"," url-and-header reject"," url-and-header script"," url-and-header req"," url-and-header res"," url-and-header echo"];e=e.split("\n").map((e=>e.trim().replace(/\s+/g," ")));for(var i=0;i<e.length;i++)try{e[i]=e[i].replace("^http","http"),"hostname"==e[i].slice(0,8)&&(hn=e[i].replace(/\%.*\%/g,"").replace(/\:\d*/g,""),t.push(hn));const a=t=>-1!=e[i].indexOf(t),p=t=>-1!=e[i].indexOf(t);if(["//","#",";"].some((t=>0==e[i].indexOf(t)))||r.some(p))r.some(p)&&t.push(e[i]);else if(1==Pdbg&&$notify("rewrite-check","",e[i]),["type=",".js","pattern=","script-path="].every(a))ptn=e[i].replace(/\s/gi,"").split("pattern=")[1].split(/\,[a-zA-Z]/)[0],js=e[i].replace(/\s/gi,"").split("script-path=")[1].split(",")[0],type=e[i].replace(/\s/gi,"").split("type=")[1].split(",")[0].trim(),subsi=e[i].replace(/ /g,"").replace(/\=true/g,"=1"),"http-response"==type&&-1!=subsi.indexOf("requires-body=1")?type="script-response-body ":"http-response"==type&&-1==subsi.indexOf("requires-body=1")?type="script-response-header ":"http-request"==type&&-1!=subsi.indexOf("requires-body=1")?type="script-request-body ":"http-request"==type&&-1==subsi.indexOf("requires-body=1")?type="script-request-header ":type="",""!=type&&(s=ptn+" url "+type+js,t.push(s));else if(/\s30(7|2)$/.test(e[i]))s=e[i].split(" ")[0]+" url "+e[i].split(" ")[2]+" "+e[i].split(" ")[1].trim(),t.push(s);else if(/\s\-\s30(2|7)\s/.test(e[i]))s=e[i].replace(" - "," url "),t.push(s);else if("header"==e[i].split(" ")[2]){var n=e[i].split(" ")[0].split(".com")[1],o=e[i].split(" ")[1].split(".com")[1];s=e[i].split(" ")[0]+" url 302 "+e[i].split(" ")[1],t.push(s)}else if("header-replace"==e[i].split(" ")[1]){n=e[i].split("header-replace")[1].split(":")[0].trim(),o=e[i].split("header-replace")[1].trim();s=e[i].split(" ")[0]+" url request-header (.+\\r\\n)"+n+":.+(\\r\\n) request-header $1"+o+"$2",t.push(s)}else-1!=e[i].indexOf(" _ reject")?(s=e[i].split(" ")[0]+" url reject-200",t.push(s)):-1!=e[i].indexOf(" - reject")||-1!=e[i].indexOf(" - REJECT")?(s=e[i].replace(" - "," url ").toLowerCase(),t.push(s)):2==e[i].split(" ").length&&(/\s(reject)$/.test(e[i])||/\s(reject\-)/.test(e[i]))?(s=e[i].replace(" reject"," url reject"),t.push(s)):-1!=e[i].indexOf("script-path")&&(type=e[i].replace(/\s+/g," ").split(" ")[0],js=e[i].split("script-path")[1].split("=")[1].split(",")[0],ptn=e[i].replace(/\s+/g," ").split(" ")[1],subsi=e[i].replace(/ /g,"").replace(/\=true/g,"=1"),"http-response"==type&&-1!=subsi.indexOf("requires-body=1")?type="script-response-body ":"http-response"==type&&-1==subsi.indexOf("requires-body=1")?type="script-response-header ":"http-request"==type&&-1!=subsi.indexOf("requires-body=1")?type="script-request-body ":"http-request"==type&&-1==subsi.indexOf("requires-body=1")?type="script-request-header ":type="",""!=type&&(s=ptn+" url "+type+js,t.push(s)))}catch(t){$notify("❌️解析此条时出现错误，已忽略",e[i],t)}return t}function SGMD2QX(e){return[...URX2QX(e),...SCP2QX(e)]}function Rewrite_Filter(e,t,s,r,i){for(var n=[],o=["//","#",";"],a=[],p="",l=0;l<e.length;l++){subi=e[l].trim();var f=subi.replace(/ /g,"");if(""!=subi&&(-1!=subi.indexOf(" url ")||-1!=subi.indexOf(" url-and-header ")||/^hostname\=/.test(f))){const e=e=>0==subi.indexOf(e);if(o.some(e))continue;if(0==f.indexOf("hostname="))p=Phin0||Phout0||r||i?HostNamecheck(subi,Phin0,Phout0):subi;else if(0!=f.indexOf("hostname=")){var c=Rcheck(subi,t),u=Rcheck(subi,s);1==u||0==c?a.push(subi.replace(" url "," - ").replace(" url-and-header "," - ")):(0==u&&0!=c||2==u&&0!=c)&&n.push(subi)}}}return 0!=Pntf0&&(nowrite=a.length<=10?emojino[a.length]:a.length,no1write=n.length<=10?emojino[n.length]:n.length,Pin0&&" 0️⃣ "!=no1write?0!=s&&$notify("🤖 重写引用  ➟ ⟦"+subtag+"⟧","⛔️ 筛选参数："+pfi+pfo,"☠️ 重写 rewrite 中保留以下"+no1write+"个匹配项:\n ⨷ "+n.join("\n ⨷ "),rwrite_link):a.length>0&&0!=Pout0&&$notify("🤖 重写引用  ➟ ⟦"+subtag+"⟧","⛔️ 筛选参数："+pfi+pfo,"☠️ 重写 rewrite 中已禁用以下"+nowrite+"个匹配项:\n ⨷ "+a.join("\n ⨷ "),rwrite_link)),0==n.length&&(Pin0||Pout0||Phin0||Phout0||i||r?$notify("🤖 重写引用  ➟ ⟦"+subtag+"⟧","⛔️ 筛选参数："+pfi+pfo,"⚠️ 筛选后剩余 rewrite 规则数为 0️⃣ 条，请检查参数及原始链接",nan_link):$notify("🤖 重写引用  ➟ ⟦"+subtag+"⟧","⛔️ 解析后 rewrite 规则数为 0️⃣ 条 ","⚠️ 请检查参数及原始链接内容",nan_link)),r&&RegCheck(n=n.map(Regex).filter(Boolean),"重写引用","regex",r),i&&RegCheck(n=n.map(RegexOut).filter(Boolean),"重写引用","regout",i),""!=p&&n.push(p),n=1==Phide?n:[...a,...n]}function HostNamecheck(e,t,s){for(var r=e.replace(/ /g,"").split("=")[1].split(","),i=[],n=[],o=0;o<r.length;o++){dd=r[o];const e=e=>-1!=dd.indexOf(e);s&&""!=s&&s.some(e)?n.push(r[o]):t&&""!=t?t.some(e)?i.push(r[o]):n.push(r[o]):i.push(r[o])}if(0!=Pntf0&&(s||t)){var a=n.length<=10?emojino[n.length]:n.length,p=i.length<=10?emojino[i.length]:i.length;t&&" 0️⃣ "!=p?$notify("🤖 重写引用  ➟ ⟦"+subtag+"⟧","⛔️ 筛选参数："+pfihn+pfohn,"☠️ 主机名 hostname 中已保留以下"+p+"个匹配项:\n ⨷ "+i.join(","),rwhost_link):n.length>0&&$notify("🤖 重写引用  ➟ ⟦"+subtag+"⟧","⛔️ 筛选参数："+pfihn+pfohn,"☠️ 主机名 hostname 中已删除以下"+a+"个匹配项:\n ⨷ "+n.join(","),rwhost_link)}return 0==i.length&&$notify("🤖 重写引用  ➟ ⟦"+subtag+"⟧","⛔️ 筛选参数："+pfihn+pfohn,"⚠️ 主机名 hostname 中剩余 0️⃣ 项，请检查参数及原始链接",nan_link),Preg&&RegCheck(i=i.map(Regex).filter(Boolean),"主机名 hostname","regex",Preg),Pregout&&RegCheck(i=i.map(RegexOut).filter(Boolean),"主机名 hostname","regout",Pregout),r="hostname="+i.join(", ")}function Rcheck(e,t){if(name=e.toUpperCase(),t){var s=0;const e=e=>-1!=name.indexOf(e.toUpperCase());return t.some(e)&&(s=1),s}return 2}function Rule_Handle(e,t,s){cnt=e,Tin=s,Tout=t,ply=Ppolicy;var r=[],i=["//","#",";","[","^"];if(""!=Tout&&null!=Tout){for(var n=[],o=0;o<cnt.length;o++){cc=cnt[o].replace(/^\s*\-\s/g,"").replace(/\"|\'/g,"").trim();const e=e=>-1!=cc.indexOf(e),t=e=>0==cc.toLowerCase().indexOf(e);if(Tout.some(e)&&!i.some(t))n.push("-"+Rule_Policy(cc));else if(!i.some(t)&&cc)if(dd=Rule_Policy(cc),""!=Tin&&null!=Tin){const e=e=>-1!=dd.indexOf(e);Tin.some(e)&&r.push(dd)}else r.push(dd)}var a=n.length<=10?emojino[n.length]:n.length;if(n.length>0?0!=Pntf0&&$notify("🤖 分流引用  ➟ ⟦"+subtag+"⟧","⛔️ 禁用："+Tout,"☠️ 已禁用以下"+a+"条匹配规则:\n ⨷ "+n.join("\n ⨷ "),rule_link):$notify("🤖 分流引用  ➟ ⟦"+subtag+"⟧","⛔️ 禁用："+Tout,"⚠️ 未发现任何匹配项，请检查参数或原始链接",nan_link),""!=Tin&&null!=Tin)if(r.length>0){var p=r.length<=10?emojino[r.length]:r.length;0!=Pntf0&&$notify("🤖 分流引用  ➟ ⟦"+subtag+"⟧","✅ 保留:"+Tin,"🎯 已保留以下 "+p+"条匹配规则:\n ⨁ "+r.join("\n ⨁ "),rule_link)}else $notify("🤖 分流引用  ➟ ⟦"+subtag+"⟧","✅ 保留:"+Tin+",⛔️ 禁用："+Tout,"⚠️ 筛选后剩余规则数为 0️⃣ 条，请检查参数及原始链接",nan_link);else 0==r.length&&$notify("🤖 分流引用  ➟ ⟦"+subtag+"⟧","⛔️ 禁用："+Tout,"⚠️ 筛选后剩余规则数为 0️⃣ 条，请检查参数及原始链接",nan_link);r=1==Phide?r:[...n,...r]}else if(""!=Tin&&null!=Tin){for(n=[],o=0;o<cnt.length;o++){cc=cnt[o].replace(/^\s*\-\s/g,"").trim();const e=e=>0==cc.toLowerCase().indexOf(e);if(!i.some(e)&&cc){dd=Rule_Policy(cc);const e=e=>-1!=dd.indexOf(e);Tin.some(e)?r.push(dd):n.push("-"+dd)}}if(r.length>0){var l=r.length<=10?emojino[r.length]:r.length;0!=Pntf0&&$notify("🤖 分流引用  ➟ ⟦"+subtag+"⟧","✅ 保留:"+Tin,"🎯 已保留以下 "+l+"条匹配规则:\n ⨁ "+r.join("\n ⨁ "),rule_link)}else $notify("🤖 分流引用  ➟ ⟦"+subtag+"⟧","✅ 保留:"+Tin,"⚠️ 筛选后剩余规则数为 0️⃣ 条，请检查参数及原始链接",nan_link);r=1==Phide?r:[...n,...r]}else r=cnt.map(Rule_Policy);return r=1==Pfcr?r.filter(Boolean).map((e=>e+", force-cellular")):r.filter(Boolean),r=2==Pfcr?r.filter(Boolean).map((e=>e+", multi-interface")):r.filter(Boolean),r=3==Pfcr?r.filter(Boolean).map((e=>e+", multi-interface-balance")):r.filter(Boolean),""!=Pvia&&(r=0==Pvia?r.filter(Boolean).map((e=>e+", via-interface=%TUN%")):r.filter(Boolean).map((e=>e+", via-interface="+Pvia))),r=r.map((e=>e.replace(/:\d*\s*,/g,",").replace(/(\'|\")/g,"").replace(/(\-suffix|\-SUFFIX)\s*\,\s*\./g,"$1, ")))}function Rule_Policy(e){var t=e.replace(/^\s*\-\s/g,"").replace(/REJECT-TINYGIF/gi,"reject").replace(/REJECT-DROP/gi,"reject").trim().split("//")[0].trim().split(","),s=["//","#",";","[","/","hostname","no-ipv6","no-system","<","{","}","]","^"];const r=e=>0==t[0].trim().toLowerCase().indexOf(e);if(["host","domain","ip-cidr","geoip","user-agent","ip6-cidr","ip-asn"].some((e=>0==t[0].trim().toLowerCase().indexOf(e)))&&!s.some(r)){if(3==t.length&&-1==t.indexOf("no-resolve"))ply0="Shawn"!=Ppolicy?Ppolicy:t[2],nn=t[0]+", "+t[1]+", "+ply0;else if(4==t.length&&-1!=t.indexOf("no-resolve"))nn=t.join(",").replace(",no-resolve","");else if(2==t.length)ply0="Shawn"!=Ppolicy?Ppolicy:"Shawn",nn=""!=t[1].trim()?t[0]+", "+t[1]+", "+ply0:"";else if(3==t.length&&-1!=t[2].indexOf("no-resolve"))ply0="Shawn"!=Ppolicy?Ppolicy:"Shawn",nn=t[0]+", "+t[1]+", "+ply0;else{if(4!=t.length||-1==t[3].indexOf("no-resolve"))return s.some(r),"";ply0="Shawn"!=Ppolicy?Ppolicy:t[2],nn=t[0]+", "+t[1]+", "+ply0}return-1!=t[0].indexOf("URL-REGEX")||-1!=t[0].indexOf("PROCESS")?nn="":nn=nn.replace("IP-CIDR6","ip6-cidr"),nn}return 1!=t.length||s.some(r)||""==t[0]||-1!=t[0].indexOf("payload:")||-1!=t[0].indexOf("=")||"https:"==t[0].trim()?"":rule_list_handle(t[0])}function rule_list_handle(e){const t=e=>/^\d+$/.test(e);return-1!=(e=e.split("#")[0].trim()).trim().indexOf(" ")||""==e.trim()||["//","#",";","[","!","/"].some((t=>0==e.trim().indexOf(t)))||(-1!=e.indexOf("::")&&-1!=e.indexOf("/")?(e="ip6-cidr, "+e,e="Shawn"==Ppolicy?e+", Shawn":e+", "+Ppolicy):2==e.split("/").length?(e="ip-cidr, "+e,e="Shawn"==Ppolicy?e+", Shawn":e+", "+Ppolicy):4==e.split(".").length&&e.split(".").every(t)?(e="ip-cidr, "+e+"/32",e="Shawn"==Ppolicy?e+", Shawn":e+", "+Ppolicy):-1==e.indexOf("payload:")&&(/^('|")/.test(e)?(e=e.replace(/'|"/g,"").trim(),e=/^\.|\*\./.test(e)||-1!=e.indexOf("*")?"host-wildcard, "+e.replace(/^\.|\*\./,"*."):"host-suffix, "+e.replace(/^(\+\.)/,"")):e=/\*|\+/.test(e[0])?"host-wildcard, "+e:"host-suffix, "+(e="."==e[0]?e.replace(".",""):e),e="Shawn"==Ppolicy?e+", Shawn":e+", "+Ppolicy)),e}function Domain2Rule(e){for(var t=e.split("\n"),s=["//","#",";","["],r=[],i=0;i<t.length;i++){cc=t[i].trim();const e=e=>-1!=cc.indexOf(e);!s.some(e)&&cc&&("."==cc[0]?r.push("host-suffix, "+cc.slice(1,cc.length)):r.push("host, "+cc))}return r.join("\n")}function policy_sets(e,t){for(pcnt=t.split("+"),i=0;i<pcnt.length;i++)-1!=pcnt[i].indexOf("@")&&(e=e.map((e=>filter_set(e,pcnt[i]))));return e=e.filter(Boolean)}function filter_set(e,t){if(e)return paras=[t.split("@")[0],t.slice(t.split("@")[0].length+1)],e=e.split(","),reg=RegExp(paras[0]),3==e.length&&(reg.test(e[1])||reg.test(e[2]))&&(e[2]=paras[1]),e.join(",")}function ReplaceReg(e,t){for(var s=e,r=t.replace(/\\\@/g,"atsymbol").replace(/\\\+/g,"plussymbol").split("+"),i=0;i<r.length;i++){var n=decodeURIComponent(r[i].split("@")[0]).replace(/atsymbol/g,"@").replace(/plussymbol/g,"\\+").replace(/\，/g,","),o=decodeURIComponent(r[i].split("@")[1]).replace(/atsymbol/g,"@").replace(/plussymbol/g,"+").replace(/\，/g,",");n=new RegExp(n,"gmi"),s=s.map((e=>e.replace(n,o)))}return s}function Subs2QX(e,t,s,r,i){Pdbg&&$notify("subs","node",e);for(var n=e.split("\n"),o=["shadowsocks=","trojan=","vmess=","http=","socks5="],a=["=ss,","=vmess,","=trojan,","=http,","=https,","=custom,","=socks5","=socks5-tls"],p=["=shadowsocks","=shadowsocksr","=vless"],l=[],f=[],c=0;c<n.length;c++){var u="";if(n[c].trim().length>3&&!/\;|\/|\#/.test(n[c][0])&&-1==n[c].indexOf(" url ")){var d=n[c].split("://")[0].trim(),h=n[c].replace(/ /g,""),g=-1!=n[c].indexOf("tag=")?n[c].split(/\&*(emoji|udp|tfo|cert|rename|replace)\=/)[0].split("tag=")[1]:"";n[c]="ssr"==d?n[c].split(/#|，|，/)[0]:n[c];const e=e=>-1!=h.toLowerCase().indexOf(e),y=e=>0==h.toLowerCase().indexOf(e);try{if(Pdbg&&$notify(c,d,n[c]),"vmess"!=d||-1!=n[c].indexOf("remark=")||-1!=n[c].indexOf("remarks=")||/(obfs|alterId|type|\@)\=/.test(n[c]))if("vmess"!=d||-1==n[c].indexOf("remark=")&&-1==n[c].indexOf("remarks=")&&!/(obfs|alterId|type|\@)\=/.test(n[c]))if("socks"==d&&-1!=n[c].indexOf("remarks="))u=S5R2QX(n[c]),u=""!=g?URI_TAG(u,g):u;else if("ssocks"==d&&-1!=n[c].indexOf("remarks="))u=S5R2QX(n[c],tlsp="over-tls"),u=""!=g?URI_TAG(u,g):u;else if("ssr"==d)u=SSR2QX(n[c],t,s),u=""!=g?URI_TAG(u,g):u;else if("ss"==d)u=SS2QX(n[c],t,s),u=""!=g?URI_TAG(u,g):u;else if("ssd"==d)u=SSD2QX(n[c],t,s);else if("trojan"==d)u=TJ2QX(n[c],t,s,r,i),u=""!=g?URI_TAG(u,g):u;else if("https"!=d&&"http"!=d||-1!=n[c].indexOf(","))"vless"==d&&version<821?(Perror=1,$notify("⚠️ 你的 Quantumult X 版本暂未支持 Vless 节点","请 ⚠️不要⚠️ 跑来 解析器🤖️ 反馈",n[c])):"vless"==d?u=VL2QX(n[c],t,s,r,i):o.some(y)?u=QX_TLS(isQuanX(n[c])[0],r,i):a.some(e)?u=QX_TLS(Surge2QX(n[c])[0],r,i):p.some(e)&&(u=Loon2QX(n[c]));else if(-1!=h.indexOf("@"))u=HPS2QX(n[c],s,r,i),u=""!=g?URI_TAG(u,g):u;else{var m=Base64.decode(h.split(d+"://")[1].split("#")[0].split("?")[0]);u=HPS2QX(m=n[c].replace(h.split(d+"://")[1].split("#")[0].split("?")[0],m),s,r,i),u=""!=g?URI_TAG(u,g):u}else u=VR2QX(n[c],t,s,r,i),u=""!=g?URI_TAG(u,g):u;else u=-1==Base64.decode(n[c].split("vmess://")[1]).indexOf("over-tls=")?V2QX(n[c],t,s,r,i):VQ2QX(n[c],t,s,r,i),u=""!=g?URI_TAG(u,g):u}catch(e){f.push(`<<<\nContent: ${n[c]}\nError: ${e}`)}if(""!=Paead&&(u=AeadVmess(u,Paead)),""!=Phost&&(u=HOST_Handle(u,Phost)),""!=Pobfs&&(u=OBFS_Handle(u,Pobfs)),""!=Psession&&(u=Session_Handle(u,Psession)),""==Pcsha256&&""==Ppsha256||(u=SHA256_Handle(u,Pcsha256,Ppsha256)),""!=Palpn&&(u=ALPN_Handle(u,Palpn)),(u=TLS_Check(u))instanceof Array)for(var x in u)u[x]=0!=t?XUDP(u[x],t):u[x],u[x]=0!=s?XTFO(u[x],s):u[x],l.push(u[x]);else""!=u&&u&&(u=0!=t?XUDP(u,t):u,u=0!=s?XTFO(u,s):u,l.push(u))}}return f.length>0&&0!=Pntf0&&$notify(`⚠️ 有 ${f.length} 条数据解析失败，已忽略`,"出错内容👇",f.join("\n")),l}function AeadVmess(e,t){let s=-1==t?"aead=false":"aead=true";return/^vmess\s*\=/.test(e)&&(/aead\s*\=/.test(e)?e=e.replace(/aead\s*\=.*\,/,s+","):(cnts=e.split(","),cnts.push(s),e=cnts.join(", "))),e}function TLS_Check(e){return e=-1!=e.indexOf("tls-cert-sha256")||-1!=e.indexOf("tls-pubkey-sha256")?e.replace(/tls-verification\s*\=\s*false.*?\,/,"tls-verification=true,"):e}function QX_TLS(e,t,s){var r=1==t?"tls-verification=true, ":"tls-verification=false, ",i=1==s?"tls13=true, ":"";if(-1!=(e=e.replace(/tag\s*\=/gm,"tag=")).indexOf("tls-verification")?e=-1==t||1==t?e.replace(RegExp("tls-verification.*?,","gmi"),r):e:(-1!=e.indexOf("obfs=over-tls")||/over\-tls\s*\=\s*true/.test(e)||-1!=e.indexOf("obfs=wss"))&&(e=e.replace(new RegExp("tag.*?=","gmi"),r+"tag=")),""!=i&&(-1!=e.indexOf("tls13")?e=e.replace(RegExp("tls13.*?,","gmi"),i):(-1!=e.indexOf("obfs=over-tls")||/over\-tls\s*\=\s*true/.test(e)||-1!=e.indexOf("obfs=wss"))&&(e=e.replace(new RegExp("tag.*?=","gmi"),i+"tag="))),!/^(shadowsocks|trojan|vmess)/.test(e.trim()))if(udp="udp-relay=false, ",-1!=e.indexOf("udp-relay"))e=e.replace(RegExp("udp-relay.*?,","gmi"),udp);else e=e.replace(new RegExp("tag.*?=","gmi"),udp+"tag=");return e}function SIP2QuanX(e){for(e=JSON.parse(e),ll=e.length,nodes=[],i=0;i<ll;i++)node="shadowsocks= ",cnti=e[i],ip=cnti.server+":"+cnti.server_port,mtd="method="+cnti.method,pwd="password="+cnti.password,obfs=cnti.plugin_opts?cnti.plugin_opts.replace(";",", "):"",tag="tag="+cnti.remarks,node+=[ip,pwd,mtd,obfs,tag].filter(Boolean).join(", "),nodes.push(node);return nodes.join("\n")}function HPS2QX(e,t,s,r){var i=-1!=e.indexOf("https://")?"https":"http",n=e.replace("https://","").replace("http://","").trim(),o=[];if(""!=n){if(-1!=n.indexOf("@"))var a="http="+n.split("@")[1].split("#")[0].split("/")[0].split("?")[0],p="username="+n.split(":")[0],l="password="+n.split("@")[0].split(":")[1];else a=-1==n.split("#")[0].indexOf(":")?"http="+Base64.decode(n.split("#")[0].split("?")[0]):"http="+n.split("#")[0].split("?")[0];var f="tag="+decodeURIComponent(n.split("#")[1]),c="https"==i?"over-tls=true":"",u=-1!=e.indexOf("peer=")?"tls-host="+e.split("peer=")[1].split("#")[0].split("&")[0]:"",d=0!=s?"tls-verification=true":"tls-verification=false",h=1==t?"fast-open=true":"fast-open=false",g=1==r?"tls13=true":"tls13=false";""==c&&(d="",g=""),o.push(a,p,l,c,u,d,h,g,f)}return o.filter(Boolean).join(",")}function VQ2QX(e,t,s,r,i){var n=String(Base64.decode(e.replace("vmess://","").trim()).split("\0")[0]),o="",a="vmess="+n.split(",")[1].trim()+":"+n.split(",")[2].trim()+", method=aes-128-gcm, password="+n.split(",")[4].split('"')[1]+", ",p="tag="+n.split("=")[0];o=a+(-1!=e.indexOf("tfo=1")?"fast-open=true, ":"fast-open=false, ")+"udp-relay=false, ";var l="";if(-1==n.indexOf("obfs="))l=-1!=n.indexOf("over-tls=true")?"obfs=over-tls, ":"",l+=-1!=n.indexOf("tls-host")?"obfs-host="+n.split("tls-host=")[1].split(",")[0]+", ":"";else if(-1!=n.indexOf("obfs=ws")){l=-1!=n.indexOf("over-tls=true")?"obfs=wss, ":"obfs=ws, ",l+=-1!=n.indexOf("obfs-path=")?"obfs-uri="+n.split("obfs-path=")[1].split('"')[1]+", ":"obfs-uri=/, ",l+=-1!=n.indexOf("obfs-header=")?"obfs-host="+n.split('obfs-header="Host:')[1].split("[")[0].trim()+", ":""}else if(-1!=n.indexOf("obfs=http")){l="obfs=http, ",l+=-1!=n.indexOf("obfs-path=")?"obfs-uri="+n.split("obfs-path=")[1].split('"')[1]+", ":"obfs-uri=/, ",l+=-1!=n.indexOf("obfs-header=")?"obfs-host="+n.split('obfs-header="Host:')[1].split("[")[0].trim()+", ":""}-1==l.indexOf("obfs=over-tls")&&-1==l.indexOf("obfs=wss")||(l=l+(0!=r||-1!=e.indexOf("allowInsecure=1")?"tls-verification=false, ":"tls-verification=true, ")+(1==i?"tls13=true, ":""));return o=o+l+p}function VR2QX(e,t,s,r,i){var n=String(Base64.decode(e.replace("vmess://","").split("?remark")[0].split("&remark")[0].split("?")[0]).trim()).split("\0")[0];1==Pdbg&&$notify("Shadowrocket-Vmess-URI","..",e+"\n\n"+n),-1==n.indexOf("@")&&-1!=e.indexOf("@")&&(n=e.replace("vmess://","").split("?")[0]);var o="",a="vmess="+n.split("@")[1]+", method=aes-128-gcm, ",p=n.split("@")[0].split(":")[1]?"password="+n.split("@")[0].split(":")[1]+", ":"password="+n.split("@")[0]+", ";-1==e.indexOf("#")?tag=/remarks*=/.test(e)?"tag="+decodeURIComponent(e.split(/remarks*=/)[1].split("&")[0]):"tag="+n.split("@")[1]:tag="tag="+e.split("#")[1];var l=0;o=a+p+(-1!=e.indexOf("tfo=1")?"fast-open=true, ":"fast-open=false, ")+"udp-relay=false, ";var f=-1!=e.indexOf("obfs=")?e.split("obfs=")[1].split("&")[0].trim():"none";if("none"==f)f=-1!=e.indexOf("tls=1")?"obfs=over-tls, ":"";else if("websocket"==f||"http"==f){f="http"==f?"obfs=http, ":"obfs=ws, ",f=(f=-1!=e.indexOf("tls=1")?"obfs=wss, ":f)+"obfs-uri="+(-1!=e.indexOf("&path=")?decodeURIComponent(e.split("&path=")[1].split("&")[0]):"/")+", ";var c=-1!=e.indexOf("&obfsParam=")?decodeURIComponent(e.split("&obfsParam=")[1].split("&")[0].split("\n")[0]).split("\n")[0].trim():"";-1!=c.indexOf('"Host"')&&-1!=c.indexOf("{")&&(c=JSON.parse(c).Host),f+=c="{}"!=c&&c?"obfs-host="+c+", ":""}else"grpc"!=f&&"h2"!=f||(Perror=1,0!=Pntf0&&$notify("⚠️ Quantumult X 暂不支持该类型节点","已忽略以下 grpc|h2 vmess 节点",e),l=1);-1==f.indexOf("obfs=over-tls")&&-1==f.indexOf("obfs=wss")||(f=f+(0!=r||-1!=e.indexOf("allowInsecure=1")?"tls-verification=false, ":"tls-verification=true, ")+(1==i?"tls13=true, ":""));return caead="aead=false, ",-1!=e.indexOf("alterId=")&&(caead=0!=Number(e.split("alterId=")[1].split("&")[0])?"aead=false, ":""),o=0==l?o+f+caead+tag:""}function S5R2QX(e,t="false"){var s=Base64.decode(e.split("socks://")[1].split("#")[0].split("?")[0]);server=s+"#"+e.split("?")[1];var r=[];if(""!=server){var i="socks5="+server.split("@")[1].split("#")[0].split("/")[0],n="username="+server.split(":")[0],o="password="+server.split("@")[0].split(":")[1],a="tag="+decodeURIComponent(server.split("remarks=")[1].split("&")[0]),p="false"==t?"":"over-tls=true",l=0!=Pcert0?"tls-verification=true":"tls-verification=false";l=""==p?"":l;var f=1==Ptfo0?"fast-open=true":"fast-open=false";r.push(i,n,o,p,l,f,a)}return r.filter(Boolean).join(",")}function V2QX(e,t,s,r,i){var n=r,o=i,a=String(Base64.decode(e.replace("vmess://","")).trim()).split("\0")[0],p=[];if(""!=a){ss=JSON.parse(a),Pdbg&&$notify("Vmess-URI","",JSON.stringify(ss)),ip="vmess="+ss.add+":"+ss.port,pwd="password="+ss.id,mtd="method=aes-128-gcm";try{tag="tag="+decodeURIComponent(ss.ps)}catch(e){tag="tag="+ss.ps}udp="udp-relay=false",tfo=1==s?"fast-open=true":"fast-open=false",obfs=Fobfs(ss,n,o),caead=ss.aid&&"0"!=ss.aid?"aead=false":"aead=true",""==obfs||null==obfs?p.push(ip,mtd,pwd,tfo,udp,caead,tag):"NOT-SUPPORTTED"!=obfs&&p.push(ip,mtd,pwd,obfs,tfo,udp,caead,tag),QX=p.join(", ")}return QX}function Fobfs(e,t,s){var r=[];return tcert=0==t?"tls-verification=false":"tls-verification=true",tls13=1==s?"tls13=true":"tls13=false","ws"==e.net&&"tls"==e.tls?(obfs0="obfs=wss, "+tcert+", "+tls13+", ",uri0=e.path&&""!=e.path?"obfs-uri="+e.path:"obfs-uri=/",uri0=-1!=uri0.indexOf("uri=/")?uri0:uri0.replace("uri=","uri=/"),host0=e.host&&""!=e.host?"obfs-host="+e.host+", ":"",r.push(obfs0+host0+uri0),r.join(", ")):"ws"==e.net?(obfs0="obfs=ws",uri0=e.path&&""!=e.path?"obfs-uri="+e.path:"obfs-uri=/",uri0=-1!=uri0.indexOf("uri=/")?uri0:uri0.replace("uri=","uri=/"),host0=e.host&&""!=e.host?"obfs-host="+e.host+", ":"",r.push(obfs0,host0+uri0),r.join(", ")):"tls"!=e.tls||"tcp"!=e.net&&"none"!=e.net?"tcp"!=e.net&&"none"!=e.net||"http"!=e.type?"tcp"!=e.net&&"none"!=e.net&&null!=e.net?(Perror=1,$notify("⚠️ Quantumult X 不支持该类型节点","vmess + "+e.net,JSON.stringify(e)),"NOT-SUPPORTTED"):"tcp"!=e.net&&"none"!=e.net||null==e.type||"none"==e.type||""==e.type||"vmess"==e.type?"":"NOT-SUPPORTTED":(obfs0="obfs=http",uri0=e.path&&""!=e.path?"obfs-uri="+e.path:"obfs-uri=/",uri0=-1!=uri0.indexOf("uri=/")?uri0:uri0.replace("uri=","uri=/"),host0=e.host&&""!=e.host?"obfs-host="+e.host+", ":"",r.push(obfs0,host0+uri0),r.join(", ")):(obfs0="obfs=over-tls, "+tcert+", "+tls13,uri0=e.path&&""!=e.path?"obfs-uri="+e.path:"",uri0=-1!=uri0.indexOf("uri=/")?uri0:uri0.replace("uri=","uri=/"),host0=e.host&&""!=e.host?", obfs-host="+e.host:"",r.push(obfs0+host0),r.join(", "))}function Dot2(e){return e=e?e.replace(/\\\./g,"这是个点"):""}function ToDot(e){return e=e?e.replace(/这是个点/g,"."):""}function Regex(e){var t=RegExp(Preg,"i");if(cnt=e,t.test(cnt))return e}function RegexOut(e){var t=RegExp(Pregout,"i");if(cnt=e,!t.test(cnt))return e;RegoutList.push(cnt)}function Scheck(e,t){if(name=e.replace(/tag\s*\=/g,"tag=").split("tag=")[1].toUpperCase(),t=t?t.map(Dot2):t){for(var s=0,r=0;r<t.length;r++){const e=e=>-1!=name.indexOf(e.toUpperCase());t[r].split(".").map(ToDot).every(e)&&(s=1)}return s}return 2}function Filter(e,t,s){var r=[],i=[],n=[];e=e.filter(Boolean);for(var o=0;o<e.length;o++)0!=Scheck(e[o],t)&&1!=Scheck(e[o],s)?(r.push(e[o]),n.push(e[o].replace(/ /g,"").split("tag=")[1])):i.push(e[o].replace(/ /g,"").split("tag=")[1]);var a=i.length<=10?emojino[i.length]:i.length,p=r.length<=10?emojino[r.length]:r.length;return 1==Pntf0&&i.length>=1?t&&p>0?$notify("👥 引用⟦"+subtag+"⟧ 开始节点筛选","🕹 筛选关键字："+pfi+pfo,"☠️ 已保留以下 "+p+"个节点\n"+n.join(", "),sub_link):s&&a>0&&$notify("👥 引用⟦"+subtag+"⟧ 开始节点筛选","🕹 筛选关键字："+pfi+pfo,"☠️ 已删除以下 "+a+"个节点\n"+i.join(", "),sub_link):0!=p&&null!=p||$notify("‼️ ⟦"+subtag+"⟧筛选后节点数为 0️⃣","⚠️ 请自行检查原始链接以及筛选参数",link0,sub_link),r}function FilterScript(servers,script){$notify("🤖 启用脚本进行筛选","",script);try{const $=Tools();eval(script);const nodes=Tools().getNodeInfo(servers),IN=filter(nodes),res=servers.filter(((e,t)=>IN[t]));return 0===res.length&&$notify("‼️ ⟦"+subtag+"⟧筛选后节点数为 0️⃣","⚠️ 请自行检查原始链接以及筛选参数",link0,sub_link),res}catch(e){return $notify("❌ 脚本筛选出现错误","",e),servers}}function SSR2QX(e,t,s){var r=[],i=Base64.decode(e.split("ssr://")[1].replace(/-/g,"+").replace(/_/g,"/")).split("\0")[0],n="",o="";return 1==Pdbg&&$notify("ssr","content",i),i.split(":").length<=8?(type="shadowsocks=",ip=i.split(":")[0]+":"+i.split(":")[1],pwd="password="+Base64.decode(i.split("/?")[0].split(":")[5].replace(/-/g,"+").replace(/_/g,"/")).split("\0")[0],mtd="method="+i.split(":")[3],obfs="plain"!=i.split(":")[4]?"obfs="+i.split(":")[4]:"",ssrp="origin"!=i.split(":")[2]?"ssr-protocol="+i.split(":")[2]:"",-1!=i.indexOf("obfsparam=")&&""!=obfs&&(n=""!=i.split("obfsparam=")[1].split("&")[0]?"obfs-host="+Base64.decode(i.split("obfsparam=")[1].split("&")[0].replace(/-/g,"+").replace(/_/g,"/")).split(",")[0].split("\0")[0]:""),-1!=i.indexOf("protoparam=")&&(o=""!=i.split("protoparam=")[1].split("&")[0]?"ssr-protocol-param="+Base64.decode(i.split("protoparam=")[1].split("&")[0].replace(/-/g,"+").replace(/_/g,"/")).split(",")[0].split("\0")[0]:""),tag="tag="+Base64.decode(i.split("remarks=")[1].split("&")[0].replace(/-/g,"+").replace(/_/g,"/")).split("\0")[0],pudp=1==t?"udp-relay=true":"udp-relay=false",ptfo=1==s?"fast-open=true":"fast-open=false",r.push(type+ip,pwd,mtd,obfs,n,o,ssrp,pudp,ptfo,tag),QX=r.filter(Boolean).join(", ")):QX="",QX}function VL2QX(e,t,s,r,i){var n=[],o=e.split("vless://")[1];return type="vless=",mtd="method=none",obfs="",thost="",-1==o.indexOf("remarks=")&&-1!=o.indexOf("@")?(typeU="URI",ip=o.split("@")[1].split("encry")[0].split("?")[0],pwd=o.split("@")[0]?"password="+o.split("@")[0]:"",pcert=-1!=o.indexOf("allowInsecure=0")?"tls-verification=true":"tls-verification=false",thost=-1!=o.indexOf("sni=")?"tls-host="+o.split("sni=")[1].split(/&|#/)[0]:"",thost=-1!=o.indexOf("peer=")?"tls-host="+o.split("peer=")[1].split(/&|#/)[0]:thost,tag=-1!=o.indexOf("#")?"tag="+decodeURIComponent(o.split("#").slice(-1)[0]):"tag= [vless]"+ip):(typeU="SR-URI",tag=-1!=o.indexOf("remarks=")?"tag="+decodeURIComponent(o.split("remarks=")[1].split("&")[0]):"tag= [vless]"+ip,b64part=Base64.decode(o.split("?")[0]),ip=b64part.split("@")[1],pwd="password="+b64part.split("@")[0].split(":")[1]),puri="",pudp=1==t||-1!=o.indexOf("udp=1")?"udp-relay=true":"udp-relay=false",ptfo=1==s||-1!=o.indexOf("tfo=1")?"fast-open=true":"fast-open=false","SR-URI"==typeU?(-1!=o.indexOf("obfs=none")&&-1==o.indexOf("tls=1")?obfs="":-1!=o.indexOf("obfs=none")&&-1!=o.indexOf("tls=1")?obfs="obfs=over-tls":-1!=o.indexOf("obfs=http")?obfs="obfs=http":-1!=o.indexOf("obfs=websocket")&&(obfs=-1!=o.indexOf("tls=1")?"obfs=wss":"obfs=ws"),thost=-1==o.indexOf("obfsParam=")?thost:"obfs-host="+decodeURIComponent(o.split("obfsParam=")[1].split("&")[0].split("#")[0]),puri=-1==o.indexOf("path=")?puri:"obfs-uri="+decodeURIComponent(o.split("path=")[1].split("&")[0].split("#")[0])):-1!=o.indexOf("&type=ws")||-1!=o.indexOf("?type=ws")||-1!=o.indexOf("type=http")||-1!=o.indexOf("security=tls")?(-1!=o.indexOf("type=http")?obfs="obfs=http":-1!=o.indexOf("type=ws")?obfs=-1!=o.indexOf("security=tls")?"obfs=wss":"obfs=ws":-1!=o.indexOf("security=tls")&&(obfs="obfs=over-tls"),thost=-1==o.indexOf("&host=")?thost:"obfs-host="+decodeURIComponent(o.split("&host=")[1].split("&")[0].split("#")[0]),puri=-1==o.indexOf("&path=")?puri:"obfs-uri="+decodeURIComponent(o.split("&path=")[1].split("&")[0].split("#")[0])):(-1!=o.indexOf("security=xtls")||-1!=o.indexOf("type=")&&-1==o.indexOf("type=tcp"))&&(type="NS"),"obfs=wss"==obfs&&"obfs=over-tls"==obfs?(ptls13=1==i?"tls13=true":"tls13=false",0==r?pcert="tls-verification=false":1==r&&(pcert="tls-verification=true")):(pcert="",ptls13=""),n.push(type+ip,pwd,mtd,obfs,pcert,thost,puri,pudp,ptfo,tag),QX="NS"!=type?n.filter(Boolean).join(", "):"",QX}function TJ2QX(e,t,s,r,i){var n=[],o=e.split("trojan://")[1];return type="trojan=",-1!=o.indexOf(":443")?ip=o.split("@")[1].split(":443")[0]+":443":ip=o.split("@")[1].split("?")[0].split("\n")[0].split("#")[0].trim(),pwd=o.split("@")[0]?"password="+decodeURIComponent(o.split("@")[0]):"",obfs="over-tls=true",pcert=-1!=o.indexOf("allowInsecure=0")?"tls-verification=true":"tls-verification=false",thost=-1!=o.indexOf("sni=")?"tls-host="+o.split("sni=")[1].split(/&|#/)[0]:"",thost=-1!=o.indexOf("peer=")?"tls-host="+o.split("peer=")[1].split(/&|#/)[0]:thost,ptls13=1==i?"tls13=true":"tls13=false",puri="",0==r?pcert="tls-verification=false":1==r&&(pcert="tls-verification=true"),pudp=1==t||-1!=o.indexOf("udp=1")?"udp-relay=true":"udp-relay=false",ptfo=1==s||-1!=o.indexOf("tfo=1")?"fast-open=true":"fast-open=false",tag=-1!=o.indexOf("#")?"tag="+decodeURIComponent(o.split("#").slice(-1)[0]):"tag= [trojan]"+ip,-1!=o.indexOf("&plugin=obfs-local")?(obfs=-1!=o.indexOf("obfs=websocket")?"obfs=wss":obfs,thost=-1==o.indexOf("obfs-host=")?thost:"obfs-host="+decodeURIComponent(o.split("obfs-host=")[1].split(";")[0].split("#")[0]),puri=-1==o.indexOf("obfs-uri=")?puri:"obfs-uri="+decodeURIComponent(o.split("obfs-uri=")[1].split(";")[0].split("#")[0])):-1==o.indexOf("&type=ws")&&-1==o.indexOf("?type=ws")||(obfs=-1!=o.indexOf("security=tls")?"obfs=wss":obfs,thost=-1==o.indexOf("&host=")?thost:"obfs-host="+decodeURIComponent(o.split("&host=")[1].split("&")[0].split("#")[0]),puri=-1==o.indexOf("&path=")?puri:"obfs-uri="+decodeURIComponent(o.split("&path=")[1].split("&")[0].split("#")[0])),n.push(type+ip,pwd,obfs,pcert,thost,puri,pudp,ptfo,tag),QX=n.filter(Boolean).join(", "),QX}function joinx(e,t){return e+":"+t}function SS2QX(e,t,s){var r=[],i=e.split("ss://")[1];if(QX="",i.split(":").length<=10){type="shadowsocks=";let e=i.split("#")[0];if(-1!=e.indexOf("@")&&-1!=e.indexOf(":"))ip=i.split("@")[1].split("#")[0].split("/")[0].split("?")[0],pwdmtd=Base64.decode(i.split("@")[0].replace(/-/g,"+").replace(/_/g,"/")).split("\0")[0].split(":");else if(-1==e.indexOf("?")){var n=Base64.decode(i.split("#")[0].replace(/-/g,"+").replace(/_/g,"/").split("\0")[0]);ip=n.split("@")[1].split("#")[0].split("/")[0],pwdmtd=n.split("@")[0].split(":")}else if(-1!=e.indexOf("?")){n=Base64.decode(i.split("#")[0].split("?")[0].replace(/-/g,"+").replace(/_/g,"/").split("\0")[0]);var o=Base64.decode(i.split("#")[0].split("?")[1].split("=")[1].replace(/-/g,"+").replace(/_/g,"/").split("\0")[0]);ip=n.split("@")[1].split("#")[0].split("/")[0],pwdmtd=n.split("@")[0].split(":")}mtd="method="+pwdmtd[0],pwdmtd.splice(0,1),pwd="password="+pwdmtd.reduce(joinx),-1==e.indexOf("v2ray-plugin")&&-1==e.indexOf("plugin=v2ray")?(obfs=null!=i.split("obfs%3D")[1]?", obfs="+i.split("obfs%3D")[1].split("%3B")[0].split("#")[0]:"",obfshost=null!=i.split("obfs-host%3D")[1]?", obfs-host="+i.split("obfs-host%3D")[1].split("&")[0].split("#")[0]:""):null!=o?(o=JSON.parse(o),obfs=o.tls?", obfs=wss":", obfs=ws",obfshost=o.host?", obfs-host="+o.host+", tls-verification=false":""):-1!=e.indexOf("v2ray-plugin")?(o=decodeURIComponent(e.split("v2ray-plugin")[1]),obfs=-1!=o.indexOf("tls")?", obfs=wss":", obfs=ws",obfshost=-1!=o.indexOf("host=")?", obfs-host="+o.split("host=")[1].split(";")[0].split("#")[0].trim():"",obfshost="obfs-host="!=obfshost?obfshost:""):-1!=e.indexOf("plugin=v2ray")&&(o=decodeURIComponent(e.split("plugin=v2ray")[1]),obfs=-1!=o.indexOf("tls")?", obfs=wss":", obfs=ws",obfshost=-1!=o.indexOf("host=")?", obfs-host="+o.split("host=")[1].split(";")[0].split("#")[0].trim():"",obfshost="obfs-host="!=obfshost?obfshost:""),tag="undefined"!=decodeURIComponent(i.split("#")[1])?"tag="+decodeURIComponent(i.split("#")[1]):"tag="+ip,pudp=1==t?"udp-relay=true":"udp-relay=false",ptfo=1==s?"fast-open=true":"fast-open=false",r.push(type+ip,pwd,mtd+obfs+obfshost,pudp,ptfo,tag),QX=r.join(", "),1==Pdbg&&$notify("SS","content",i+"\n"+QX)}return QX}function SSD2QX(e,t,s){var r=0,i=[],n=JSON.parse(Base64.decode(e.split("ssd://")[1])),o="password="+n.password,a="method="+n.encryption,p="",l="",f=n.port?":"+n.port:"";for(var c in n.plugin_options&&(p=null!=n.plugin_options.split(";")[0]?", "+n.plugin_options.split(";")[0]:"",l=null!=n.plugin_options.split(";")[1]?", "+n.plugin_options.split(";")[1]:""),pudp=1==t?"udp-relay=true":"udp-relay=false",ptfo=1==s?"fast-open=true":"fast-open=false",n.servers)if(ip=n.servers[c].server,n.servers[c].plugin_options&&(p=null!=n.servers[c].plugin_options.split(";")[0]?", "+n.servers[c].plugin_options.split(";")[0]:"",l=null!=n.servers[c].plugin_options.split(";")[1]?", "+n.servers[c].plugin_options.split(";")[1]:""),n.servers[c].encryption&&(a="method="+n.servers[c].encryption),n.servers[c].password&&(o="password="+n.servers[c].password),ip.indexOf(".")>0){f=n.servers[c].port?":"+n.servers[c].port:f,tag="tag="+n.servers[c].remarks,i[r]="shadowsocks="+ip+f+", "+o+", "+a+p+l+", "+pudp+", "+ptfo+", "+tag;r=r+1}return i}function QXFix(e){var t=e.replace(/\s*tag\s*\=/g,"tag=").replace("chacha20-poly","chacha20-ietf-poly");try{var s=t.split(",tag=")[0],r="tag="+t.split(",tag=")[1].split(",")[0].trim(),n=t.split(r+",");for(i in t=n.length<=1?t:String(s+","+n[1].split("\r")[0]+","+r),cntis=t.split(",").filter(Boolean).map((e=>e.trim())),tagfix="",cntii="",cntis)-1==cntis[i].indexOf("=")&&""!=cntis[i].trim()?tagfix+=","+cntis[i]:0!=cntis[i].indexOf("tag=")?cntii+=cntis[i]+", ":cntii=cntii;return cntii=cntii+r+tagfix,cntii}catch(t){0==Perror&&$notify("❌ 解析出现错误，已忽略该条目","⚠️ 请点击通知，发送订阅链接进行反馈",e+"\n"+t,bug_link)}return""}function isQuanX(e){for(var t=e.split("\n"),s=[],r=0;r<t.length;r++){var i=t[r];if(-1!=i.indexOf("=")&&-1!=i.indexOf("tag")){var n=i.split("=")[0].trim();"http"!=n&&"shadowsocks"!=n&&"trojan"!=n&&"vmess"!=n&&"socks5"!=n&&"vless"!=n||s.push(QXFix(i))}}return s}function isQuanXRewrite(e){cnt=e,cnt0=[];for(var t=["host,","-suffix,","domain,","-keyword,","ip-cidr,","ip-cidr6,","geoip,","user-agent,","ip6-cidr,","force-http","ip-asn"],s=0;s<cnt.length;s++)if(cnt[s]){var r=cnt[s].trim();const e=e=>-1!=r.toLowerCase().indexOf(e);-1!=r.indexOf("pattern")&&-1!=r.indexOf("type")||-1!=r.indexOf("http-r")||(-1!=r.indexOf(" 302")||-1!=r.indexOf(" 307")||/\s(_|-)\s(reject|REJECT)/.test(r)||/\sreject$/.test(r)||/\sreject-/.test(r))&&-1==r.indexOf(" url ")&&-1==r.indexOf(" url-and-header ")?r=SGMD2QX(r)[0]?SGMD2QX(r)[0]:"":-1!=r.indexOf(" data=")?r=SGMD2QX("[Map Local]\n"+r)[0]?SGMD2QX("[Map Local]\n"+r)[0]:"":-1!=r.indexOf("URL-REGEX")||-1!=r.indexOf(" header")||-1!=r.replace(/ /g,"").indexOf("hostname=")?r=SGMD2QX(r)[0]?SGMD2QX(r)[0]:"":-1!=r.indexOf(" url ")&&-1==r.indexOf(" simple-response ")&&-1==r.indexOf(" url = ")?r="url"==(r=r.replace("^http","http")).split(" ")[1]?r:"":-1!=r.indexOf(" url-and-header ")||(r=""),""==r||"["==r.trim()[0]||-1!=r.indexOf("RULE-SET")||/cronexp\=|type\=cron/.test(r.replace(/ /g,""))||t.some(e)||/\;$/.test(r)||cnt0.push(r)}return cnt0}function QXSort(e,t){var s=e;return 1==t?s.sort(ToTag):-1==t?s.sort(ToTagR):"x"==t?shuffle(s):"0"==t?s:Sort_KWD(s,t)}function ToTag(e,t){var s=e.split("tag")[1].split("=")[1].trim(),r=t.split("tag")[1].split("=")[1].trim();return res=s>r?1:-1,res}function ToTagR(e,t){var s=e.split("tag")[1].split("=")[1].trim(),r=t.split("tag")[1].split("=")[1].trim();return res=s>r?-1:1,res}function shuffle(e){for(var t=e,s=t.length-1;s>=0;s--){var r=Math.floor(Math.random()*(s+1)),i=t[r];t[r]=t[s],t[s]=i}return t}function Sort_KWD(e,t){strlist=-1!=t.indexOf("<")?t.split("<"):t.split(">"),regj=strlist.map((e=>RegExp(e,"i"))),dir=-1!=t.indexOf("<")?-1:1;for(var s=new Array(strlist.length+1),r=0;r<s.length;r++)s[r]=[];for(r=0;r<e.length;r++){flag=0;for(var i=0;i<strlist.length;i++)if(regj[i].test(e[r])){s[i].push(e[r]),flag=1;break}1!=flag&&s[strlist.length].push(e[r])}return s=-1==PsortX?s.map((e=>e.sort(ToTagR))):s,s=1==PsortX?s.map((e=>e.sort(ToTag))):s,newarr=MixArr(s,dir),newarr}function MixArr(e,t){var s=[];for(i=0;i<e.length-1;i++)s=1==t?s.concat(e[i]):s.concat(e[e.length-2-i]);return s=1==t?s.concat(e[e.length-1].sort(ToTag)):e[e.length-1].sort(ToTagR).concat(s)}function DelReg(e){return delreg=RegExp(delreg,"gmi"),e=e.replace(/tag\s*\=\s*/,"tag="),cnt0=e.split("tag=")[0],cnt1=e.split("tag=")[1].split(",")[0],cnt2=1==e.split("tag=")[1].split(",").length?"":e.split(cnt1)[1],cnt=cnt0+"tag="+cnt1.replace(delreg,"")+cnt2,cnt}function Rename(e){var t=e;if(-1!=t.indexOf("tag=")){hd=t.split("tag=")[0],name=t.split("tag=")[1].split(",")[0].trim(),tail=t.split("tag=")[1].split(",").length<=1?"":t.split("tag=")[1].split(name)[1];for(var s=0;s<Prn.length;s++){if(nname=Prn[s].split("@")[1]?decodeURIComponent(Prn[s].split("@")[1]):Prn[s].split("@")[1],oname=Prn[s].split("@")[0]?decodeURIComponent(Prn[s].split("@")[0]):Prn[s].split("@")[0],oname&&nname){var r=escapeRegExp(oname);name=name.replace(new RegExp(r,"gm"),nname)}else if(oname&&""==nname){var i=emoji_del(name);name=1!=Pemoji&&2!=Pemoji||!Prname?oname+name.trim():oname+i}else if(nname&&""==oname)name=name.trim()+nname;else if(oname&&-1!=oname.indexOf("☠️"))for(hh=Dot2(oname.slice(0,oname.length-2)).split("."),j=0;j<hh.length;j++){var n=escapeRegExp(ToDot(hh[j])),o=new RegExp(n,"gm");name=name.replace(o,"")}else""==oname&&""==nname?name=name.replace(/@/g,""):name=name;nserver=hd+"tag="+name+tail}return nserver}return t}function RenameScript(servers,script){$notify("🤖 启用脚本进行重命名","",script);try{const $=Tools().rename,nodes=Tools().getNodeInfo(servers);eval(script);const newNames=rename(nodes);return servers.map(((e,t)=>e.split("tag=")[0]+"tag="+newNames[t]))}catch(e){return $notify("❌ 脚本重命名出现错误","",e),servers}}function emoji_del(e){return e.replace(/[\uD83C][\uDDE6-\uDDFF][\uD83C][\uDDE6-\uDDFF]/g,"").trim()}function get_emoji(e,t){str1=JSON.stringify({"🏳️‍🌈":["流量","套餐","剩余","重置","到期","时间","应急","过期","Bandwidth","expire","Traffic","traffic"],"🇴🇲":["阿曼"," OM "],"🇦🇩":["安道尔","安道爾","Andorra"],"🇦🇴":["安哥拉"],"🇦🇫":["阿富汗"],"🇩🇿":["阿尔及利亚","阿爾及利亞"],"🇫🇴":["法羅群島","法罗群岛"],"🇧🇲":["百慕大"],"🇦🇽":["奧蘭群島","奥兰群岛"],"🇦🇿":["阿塞拜疆","Azerbaijan"],"🇦🇹":["奥地利","奧地利","Austria","维也纳"],"🇦🇺":["AU","Australia","Sydney","澳大利亚","澳洲","墨尔本","悉尼","土澳","京澳","廣澳","滬澳","沪澳","广澳"],"🇧🇪":["BE","比利時","比利时","Belgium"],"🇧🇬":["保加利亚","保加利亞","Bulgaria"],"🇵🇰":["巴基斯坦","Pakistan","PAKISTAN"],"🇧🇭":["巴林","Bahrain"],"🇵🇾":["巴拉圭","Paraguay"],"🇧🇧":["巴巴多斯"],"🇬🇶":["赤道几内亚","赤道幾內亞"],"🇹🇱":["东帝汶","東帝汶"],"🇰🇭":["柬埔寨","Cambodia"],"🇿🇼":["津巴布韦","津巴布韋"],"🇺🇦":["烏克蘭","乌克兰","Ukraine"],"🇺🇿":["乌兹别克斯坦","烏茲別克斯坦","Uzbekistan"],"🇭🇷":["克罗地亚","HR","克羅地亞","Croatia"],"🇨🇦":["CA","Canada","CANADA","CAN","Waterloo","加拿大","蒙特利尔","温哥华","楓葉","枫叶","滑铁卢","多伦多"],"🇨🇭":["瑞士","苏黎世","Switzerland","CH "],"🇳🇬":["尼日利亚","NG","尼日利亞","拉各斯","Nigeria"],"🇨🇿":["Czechia","捷克"],"🇸🇰":["斯洛伐克","SK","Slovakia"],"🇸🇮":["斯洛文尼亚","斯洛文尼亞","Slovenia"],"🇦🇲":["亚美尼亚","亞美尼亞","Armenia"],"🇷🇸":["RS ","RS_","塞尔维亚","塞爾維亞","Seville","Sevilla"],"🇲🇩":["摩爾多瓦"," MD-","摩尔多瓦","Moldova"," MD "],"🇩🇪":["DE ","DE-","DE_","German","GERMAN","德国","德國","法兰克福","京德","滬德","廣德","沪德","广德"],"🇩🇰":["DK","DNK","丹麦","丹麥","Denmark"],"🇪🇸":["ES","西班牙","Spain"],"🇪🇺":["EU","欧盟","欧罗巴","欧洲","European"],"🇫🇮":["Finland","芬兰","芬蘭","赫尔辛基"],"🇫🇷":["FR","France","法国","法國","巴黎"],"🇷🇪":["留尼汪","留尼旺","Réunion","Reunion"],"🇨🇼":["库拉索","庫拉索","Curaçao"],"🇬🇧":["UK","GB ","England","United Kingdom","英国","伦敦","英","Britain"],"🇲🇴":["MO","Macao","Macau","MAC","澳门","澳門","CTM"],"🇰🇿":["哈萨克斯坦","哈薩克斯坦","Kazakhstan"],"🇱🇦":["老挝","老挝","Laos"],"🇭🇺":["匈牙利","Hungary"],"🇭🇳":["洪都拉斯"],"🇱🇹":["立陶宛","Lithuania"],"🇱🇰":["斯里兰卡","斯里蘭卡","Sri Lanka"],"🇧🇾":["BY","白俄罗斯","白俄羅斯","White Russia","Republic of Belarus","Belarus"],"🇷🇺":["RU ","RU-","RU_","RUS","Russia","俄罗斯","毛子","俄国","俄羅斯","伯力","莫斯科","圣彼得堡","西伯利亚","新西伯利亚","京俄","杭俄","廣俄","滬俄","广俄","沪俄"],"🇸🇬":["SG","Singapore","SINGAPORE","新加坡","狮城","獅城","沪新","京新","泉新","穗新","深新","杭新","广新","廣新","滬新"],"🇺🇸":["US","USA","America","United States","美国","美","京美","波特兰","达拉斯","俄勒冈","凤凰城","费利蒙","硅谷","矽谷","拉斯维加斯","洛杉矶","圣何塞","圣荷西","圣克拉拉","西雅图","芝加哥","沪美","哥伦布","纽约"],"🇹🇼":["TW","Taiwan","TAIWAN","台湾","台北","台中","新北","彰化","CHT","台","HINET"],"🇮🇩":["ID ","IDN ","Indonesia","印尼","印度尼西亚","雅加达"],"🇮🇪":["Ireland","IRELAND","IE ","爱尔兰","愛爾蘭","都柏林"],"🇮🇱":["Israel","以色列"],"🇮🇳":["India","IND","INDIA","印度","孟买","Mumbai","IN "],"🇮🇸":["IS","ISL","冰岛","冰島","Iceland"],"🇰🇵":["KP","朝鲜","North Korea","朝鮮"],"🇰🇷":["KR","Korea","KOR","韩国","首尔","韩","韓","春川"],"🇬🇭":["加纳","Ghana","迦納"],"🇱🇺":["卢森堡","盧森堡","LU ","Luxembourg"],"🇱🇻":["Latvia","Latvija","拉脱维亚"],"🇧🇩":["孟加拉","Bengal"],"🇲🇽️":[" MEX","MX","墨西哥","Mexico","MEXICO"],"🇲🇾":[" MY","Malaysia","MALAYSIA","马来西亚","马来","馬來","大马","大馬","馬來西亞","吉隆坡"],"🇲🇲":["缅甸","緬甸"],"🇳🇮":["尼加拉瓜"],"🇳🇱":[" NL","Netherlands","荷兰","荷蘭","尼德蘭","阿姆斯特丹"],"🇵🇭":[" PH","Philippines","菲律宾","菲律賓"],"🇷🇴":[" RO ","罗马尼亚","Rumania","羅馬尼亞"],"🇸🇦":["沙特","利雅得","Saudi Arabia","Saudi"],"🇸🇪":["SE","Sweden","瑞典"],"🇹🇭":[" TH","Thailand","泰国","泰國","曼谷"],"🇹🇷":["TR ","TR-","TR_","TUR","Turkey","土耳其","伊斯坦布尔"],"🇻🇳":["VN","越南","胡志明市","Vietnam"],"🇮🇹":["Italy"," IT ","Nachash","意大利","米兰","義大利"],"🇿🇦":["South Africa","南非","Johannesburg"],"🇦🇪":["United Arab Emirates","阿联酋","AE ","迪拜","阿聯酋","Dubai"],"🇧🇷":["BR","Brazil","巴西","圣保罗"],"🇯🇵":["JP","Japan","JAPAN","日本","东京","大阪","埼玉","京日","苏日","沪日","上日","穗日","川日","中日","泉日","杭日","深日","辽日","广日","Tokyo"],"🇦🇷":["AR ","Argentina","阿根廷","AR-"],"🇳🇴":["Norway","挪威","NO"],"🇵🇱":[" PL","POL","波兰","波蘭","Poland"],"🇨🇱":["智利","Chile","CHILE"],"🇳🇿":["新西蘭","新西兰","New Zealand"],"🇬🇷":["希腊","希臘","Greece"],"🇪🇬":["埃及","Egypt"],"🇮🇲":["马恩岛","馬恩島","Isle of Man","Mannin"],"🇵🇹":["葡萄牙","Portugal"],"🇲🇳":["蒙古","Mongolia"],"🇵🇪":["秘鲁","祕魯","Peru"],"🇨🇴":["哥伦比亚","哥倫比亞","Colombia"],"🇪🇪":["爱沙尼亚","愛沙尼亞","Estonia"],"🇱🇾":["利比亚","利比亞","Libya"],"🇲🇰":["马其顿","馬其頓","Macedonia"],"🇲🇹":["马耳他","馬其他","Malta"],"🇻🇪":["委内瑞拉","Venezuela"],"🇧🇦":["波黑共和国","波黑","Bosnia and Herzegovina"],"🇬🇪":["格魯吉亞","格鲁吉亚","Georgia"],"🇦🇱":["阿爾巴尼亞","阿尔巴尼亚","Albania"],"🇨🇾":["CY","塞浦路斯","Cyprus"],"🇨🇷":["哥斯达黎加","哥斯達尼加","Costa Rica"],"🇹🇳":["突尼斯","Tunisia"],"🇻🇦":["梵蒂冈","梵蒂岡"],"🇷🇼":["卢旺达","盧旺達"],"🇵🇦":["巴拿马","巴拿馬","Panama"],"🇮🇷":["伊朗","Iran"],"🇯🇴":["约旦","約旦","Jordan"],"🇺🇾":["乌拉圭","烏拉圭","Uruguay"],"🇰🇪":["肯尼亚","肯尼亞","Kenya"],"🇰🇬":["吉尔吉斯坦","吉尔吉斯斯坦","Kyrghyzstan"],"🇳🇵":["尼泊尔","尼泊爾","Nepal"],"🇽🇰":["科索沃","Kosovo"],"🇲🇦":["摩洛哥","Morocco"],"🇪🇨":["厄瓜多尔","厄瓜多爾","EC","Ecuador"],"🇲🇺":["毛里求斯","Mauritius"],"🇵🇷":["波多黎各","PR ","PR-","Puerto Rico"],"🇬🇹":["危地马拉","危地馬拉"," GT "],"🇭🇰":["HK","Hongkong","Hong Kong","HongKong","HONG KONG","香港","深港","沪港","呼港","HKT","HKBN","HGC","WTT","CMI","穗港","京港","港"],"🇨🇳":["CN","China","回国","中国","中國","江苏","北京","上海","广州","深圳","杭州","徐州","青岛","宁波","镇江","back"],"🇨🇺":["古巴"],"🇸🇲":["圣马力诺","聖馬利諾"],"🇰🇾":["开曼群岛","開曼群島"],"🇫🇯":["斐济","斐濟"],"🇬🇱":["格陵兰","格陵蘭"],"🇬🇮":["直布罗陀","直布羅陀"],"🇲🇪":["黑山"],"🇱🇮":["列支敦士登"],"🇬🇺":["关岛","關島"],"🇦🇶":["南极","南極"],"🇧🇹":["不丹"],"🇲🇻":["马尔代夫","馬爾代夫"],"🇮🇶":["伊拉克"],"🇸🇨":["塞舌尔","塞舌爾"],"🇶🇦":["卡塔尔","卡塔爾"," QA "],"🇸🇾":["叙利亚","敘利亞"," SY "],"🇱🇧":["黎巴嫩","LB","Lebanon"],"🇧🇳":["文莱","汶萊","BRN","Negara Brunei Darussalam"],"🇨🇻":["佛得角"],"🇸🇷":["苏里南","蘇里南"],"🇲🇨":["摩纳哥","摩納哥"],"🇯🇲":["牙买加","牙買加 "],"🌏":["亚洲","Asia"],"🇹🇬":["多哥"],"🇵🇸":["巴勒斯坦"],"🇬🇫":["法屬圭亞那","法属圭亚那"],"🇹🇹":["特立尼达和多巴哥","特立尼達和多巴哥"]}),aa=JSON.parse(str1),bb=JSON.parse(str1.replace(/🇹🇼/g," 🇨🇳"));var s=1==e?aa:bb,r=0;for(var n in s)for(i in dd=s[n],dd)if(-1!=t.indexOf(dd[i]))return r=1,nname=n+" "+t.replace(/[\uD83C][\uDDE6-\uDDFF][\uD83C][\uDDE6-\uDDFF]/g,"").trim(),[nname,n];if(0==r)return["🏴‍☠️ "+t.replace(/[\uD83C][\uDDE6-\uDDFF][\uD83C][\uDDE6-\uDDFF]/g,"").trim(),"🏴‍☠️"]}function emoji_handle(e,t){for(var s=[],r=e,i=0;i<r.length;i++)if(-1!=r[i].indexOf("tag=")){var n=r[i].split("tag=")[1].trim(),o=r[i].split("tag=")[0],a=n;if(1==t)a=get_emoji(1,a)[0];else if(2==t)a=get_emoji(2,a)[0];else-1==t&&(a=emoji_del(n));var p=o+"tag="+a.replace("  "," ").trim();s.push(p)}return s}function Surge2QX(e){for(var t=e.split("\n").map(isSurge).filter(Boolean),s=[],r="",i=0;i<t.length;i++){var n=t[i];if(-1!=n.split("=")[1].split(",")[0].indexOf("trojan")?r=Strojan2QX(n):-1!=n.split("=")[1].split(",")[0].indexOf("http")?r=Shttp2QX(n):-1!=n.split("=")[1].split(",")[0].indexOf("vmess")?r=SVmess2QX(n):-1!=n.split("=")[1].split(",")[0].indexOf("ss")?r=SSS2QX(n):-1!=n.split("=")[1].split(",")[0].indexOf("socks5")?r=SS52QX(n):-1!=n.split("=")[1].split(",")[0].indexOf("custom")&&(r=SCT2QX(n)),r=0!=Pudp0?XUDP(r,Pudp0):r,r=0!=Ptfo0?XTFO(r,Ptfo0):r,-1!=n.indexOf("test-url")){var o=", server_check_url"+n.split("test-url")[1].split(",")[0];r=r.replace(/\,(\s)*tag/,o+", tag")}s.push(r)}return s}function SCT2QX(e){var t=e,s="tag="+t.split("=")[0].trim(),r=t.split(",")[1].trim()+":"+t.split(",")[2].trim(),i="method="+t.split(",")[3].trim(),n="password="+t.split(",")[4].trim();-1!=t.indexOf("obfs")?pobfs="obfs="+t.replace(/obfs-host/,"").split("obfs")[1].split(",")[0].split("=")[1]:pobfs="";var o=-1!=t.indexOf("obfs-host")?"obfs-host"+t.split("obfs-host")[1].split(",")[0].trim():"";""!=o&&(pobfs=pobfs+", "+o);var a="true"==paraCheck(t,"tfo")?"fast-open=true":"fast-open=false",p="true"==paraCheck(t,"udp-relay")?"udp-relay=true":"udp-relay=false";return""!=pobfs?"shadowsocks= "+[r,i,n,pobfs,a,p,s].join(", "):"shadowsocks= "+[r,i,n,a,p,s].join(", ")}function SSS2QX(e){var t=e,s="tag="+t.split("=")[0].trim(),r=t.split(",")[1].trim()+":"+t.split(",")[2].trim(),i="method="+t.split("encrypt-method")[1].split(",")[0].split("=")[1],n="password="+t.split("password")[1].split(",")[0].split("=")[1];-1!=t.indexOf("obfs")?pobfs="obfs="+t.replace(/obfs-host/,"").split("obfs")[1].split(",")[0].split("=")[1]:pobfs="";var o=-1!=t.indexOf("obfs-host")?"obfs-host"+t.split("obfs-host")[1].split(",")[0].trim():"";""!=o&&(pobfs=pobfs+", "+o);var a="true"==paraCheck(t,"tfo")?"fast-open=true":"fast-open=false",p="true"==paraCheck(t,"udp-relay")?"udp-relay=true":"udp-relay=false";return""!=pobfs?"shadowsocks= "+[r,i,n,pobfs,a,p,s].join(", "):"shadowsocks= "+[r,i,n,a,p,s].join(", ")}function SVmess2QX(e){var t=e,s="tag="+t.split("=")[0].trim(),r=t.split(",")[1].trim()+":"+t.split(",")[2].trim(),i=-1!=t.indexOf("username")?"password="+t.split("username")[1].split(",")[0].split("=")[1].trim():"",n="method=aes-128-gcm",o="true"==paraCheck(t,"tls13")?"tls13=true":"tls13=false",a=-1!=t.replace(/ /g,"").indexOf("skip-cert-verify=false")?"tls-verification=true":"tls-verification=false";pvefify=1==Pcert0?"tls-verification=true":a,"true"==paraCheck(t.replace(/tls13/,""),"tls")&&"true"==paraCheck(t.replace(/ws-header/,""),"ws")?pobfs="obfs=wss, "+o+", "+a:"true"==paraCheck(t.replace(/ws-header/,""),"ws")?pobfs="obfs=ws":"false"!=paraCheck(t.replace(/tls13/,""),"tls")?pobfs="obfs=over-tls, "+o+", "+a:"false"==paraCheck(t.replace(/ws-header/,""),"ws")&&(pobfs="");var p="false"!=paraCheck(t,"ws-path")?"obfs-uri="+t.split("ws-path")[1].split(",")[0].split("=")[1].trim():"obfs-uri=/",l=-1!=t.indexOf("ws-headers")?"obfs-host="+t.split("ws-headers")[1].split(",")[0].split("=")[1].split(":")[1].trim():"";-1!=pobfs.indexOf("ws")&&(pobfs=""!=l?pobfs+", "+p+", "+l:pobfs+", "+p);var f="true"==paraCheck(t,"tfo")?"fast-open=true":"fast-open=false";return""!=pobfs?"vmess= "+[r,i,n,pobfs,f,s].join(", "):"vmess= "+[r,i,n,f,s].join(", ")}function isSurge(e){if(-1!=e.indexOf("=")&&(cnt=e.split("=")[1].split(",")[0].trim(),"http"==cnt||"ss"==cnt||"trojan"==cnt||"vmess"==cnt||"custom"==cnt||"https"==cnt||"socks5"==cnt||"socks5-tls"==cnt))return e}function paraCheck(e,t){return-1==(e=e.replace(/ /g,"")).indexOf(t+"=")?"false":e.split(t+"=")[1].split(",")[0].trim()}function Strojan2QX(e){var t=e,s="tag="+t.split("=")[0].trim(),r=t.split(",")[1].trim()+":"+t.split(",")[2].trim(),i="password="+t.split("password")[1].split(",")[0].split("=")[1].trim(),n="true"==paraCheck(t,"tfo")?"fast-open=true":"fast-open=false",o=-1!=t.replace(/ /g,"").indexOf("skip-cert-verify=false")?"tls-verification=true":"tls-verification=false",a=-1!=t.indexOf("sni")?"tls-host="+t.split("sni")[1].split(",")[0].split("=")[1]:"";return pvefify=1==Pcert0?"tls-verification=true":o,"trojan= "+[r,i,"over-tls=true",n,"true"==paraCheck(t,"tls13")?"tls13=true":"tls13=false",a,o,s].filter(Boolean).join(", ")}function Shttp2QX(e){var t=e,s="tag="+t.split("=")[0].trim(),r=t.split(",")[1].trim()+":"+t.split(",")[2].trim(),i=-1!=t.indexOf("username")?"username="+t.split("username")[1].split(",")[0].split("=")[1].trim():"",n=-1!=t.indexOf("password")?"password="+t.split("password")[1].split(",")[0].split("=")[1].trim():"",o="https"==t.split("=")[1].split(",")[0].trim()?"over-tls=true":"over-tls=false",a="true"==paraCheck(t,"tfo")?"fast-open=true":"fast-open=false";if("over-tls=true"==o){var p=-1!=t.replace(/ /g,"").indexOf("skip-cert-verify=false")?"tls-verification=true":"tls-verification=false";pvefify=1==Pcert0?"tls-verification=true":p,o=o+", "+p+", "+("true"==paraCheck(t,"tls13")?"tls13=true":"tls13=false")}return""!=i?"http= "+[r,i,n,o,a,s].join(", "):"http= "+[r,o,a,s].join(", ")}function SS52QX(e){var t=e,s="tag="+t.split("=")[0].trim(),r=t.split(",")[1].trim()+":"+t.split(",")[2].trim(),i=-1!=t.indexOf("username")?"username="+t.split("username")[1].split(",")[0].split("=")[1].trim():"",n=-1!=t.indexOf("password")?"password="+t.split("password")[1].split(",")[0].split("=")[1].trim():"",o="socks5-tls"==t.split("=")[1].split(",")[0].trim()?"over-tls=true":"over-tls=false",a="true"==paraCheck(t,"tfo")?"fast-open=true":"fast-open=false";if("over-tls=true"==o){var p=-1!=t.replace(/ /g,"").indexOf("skip-cert-verify=false")?"tls-verification=true":"tls-verification=false";pvefify=1==Pcert0?"tls-verification=true":p,o=o+", "+p+", "+("true"==paraCheck(t,"tls13")?"tls13=true":"tls13=false")}return""!=i?"socks5= "+[r,i,n,o,a,s].join(", "):"socks5= "+[r,o,a,s].join(", ")}function Loon2QX(e){var t=e.split("=")[1].split(",")[0].trim(),s="";return"Shadowsocks"==t?s=LoonSS2QX(e):"ShadowsocksR"==t?s=LoonSSR2QX(e):"VLESS"==t&&(s=LoonVL2QX(e)),s}function LoonSS2QX(e){var t="shadowsocks=",s=[e.split(",")[1].trim(),e.split(",")[2].trim()].join(":"),r="method="+e.split(",")[3].trim(),i="password="+e.split(",")[4].trim().split('"')[1],n=7==e.split(",").length?", "+["obfs="+e.split(",")[5].trim(),"obfs-host="+e.split(",")[6].trim()].join(","):"",o=", tag="+e.split("=")[0].trim();return t=t+[s,r,i].join(", ")+n+o}function LoonSSR2QX(e){var t="shadowsocks=",s=[e.split(",")[1].trim(),e.split(",")[2].trim()].join(":"),r="method="+e.split(",")[3].trim(),i="password="+e.split(",")[4].trim().split('"')[1],n="ssr-protocol="+e.split(",")[5].trim(),o="ssr-protocol-param="+e.split(",")[6].replace(/\{|\}/g,"").trim(),a="obfs="+e.split(",")[7].trim(),p="obfs-host="+e.split(",")[8].replace(/\{|\}/g,"").trim(),l=", tag="+e.split("=")[0].trim();return t=t+[s,r,i,n,o,a,p].join(", ")+l}function LoonVL2QX(e){var t=", tag="+e.split("=")[0].trim(),s="vless=",r=[(e=e.replace(" ","")).split(",")[1].trim(),e.split(",")[2].trim()].join(":"),i="password="+e.split(",")[3].trim().split('"')[1];return-1!=e.indexOf("transport=tcp")?obfs="-1"==e.indexOf("over-tls=true")?"":"obfs=over-tls":-1!=e.indexOf("transport=http")?obfs="obfs=http":-1!=e.indexOf("transport=ws")&&(obfs="-1"==e.indexOf("over-tls=true")?"obfs=ws":"obfs=wss"),vpath=-1==e.indexOf("path=")?"":"obfs-uri="+e.split("path=")[1].split(",")[0],-1!=e.indexOf("host=")?obfshost="obfs-host="+e.split("host=")[1].split(",")[0]:-1!=e.indexOf("tls-name=")&&(obfshost="obfs-host="+e.split("tls-name=")[1].split(",")[0]),s=s+[r,"method=none",i,obfs,obfshost,vpath].join(", ")+t}function YAMLFix(e){return-1!=(e=e.replace(/\[/g,"yaml@bug1").replace(/\\r/g,"").replace(/\*/g,"yaml@bug2")).indexOf("{")&&/\{\s*\"*(name|type|server)/.test(e)&&(e=(e=(e=e.replace(/(^|\n)- /g,"$1  - ").replace(/    - /g,"  - ").replace(/:(?!\s)/g,": ").replace(/\,\"/g,', "').replace(/: {/g,": {,   ").replace(/, (Host|host|path|mux)/g,",   $1")).replace(/{\s*name: (.*?), (.*?):/g,'{name: "$1", $2:')).replace(/{\s*|\s*}/g,"").replace(/,/g,"\n   ")),e=e.replace(/\n\s*\-\s*\n.*name/g,"\n  - name").replace(/\$|\`/g,"").split("proxy-providers:")[0].split("proxy-groups:")[0].replace(/\"(name|type|server|port|cipher|password|uuid|alterId|udp)(\"*)/g,"$1"),1==Pdbg&&$notify("part-fix0:","","part-fix0:\nproxies:\n"+e.split("proxies:")[1]),e=e.replace(/\n\s{2}([a-zA-Z]+.*\:)/g,"\n    $1").replace(/\n(\-.*)/g,"\n  $1"),1==Pdbg&&$notify("part-fix1:","","part-fix1:\nproxies:\n"+e.split("proxies:")[1]),e=e.replace(/name\:(.*?)\:(.*?)\n/gim,"name:$1冒号$2\n").replace(/\s{6}Host\:/g,"      Host:"),items=e.split("\n").map(yamlcheck),e=-1==(e=-1!=(e=items.join("\n")).indexOf("proxies:")&&/\n\s{4}server/.test(e)?e.replace(/\n\s{4}(headers|path)/g,"\n      $1").replace(/\n\s{6}Host/g,"\n        Host").replace(/\t/g,""):e).indexOf("proxies:")?"proxies:\n"+e:"proxies:"+e.split("proxies:")[1],1==Pdbg&&$notify("After-Fix","this is","After-fix:\n"+e),e}function yamlcheck(e){if(-1!=e.indexOf("name"))for(var t=0;t<10;t++)e=e.replace(new RegExp(patn[0][t],"gmi"),patn[4][t]);if(/(:|-)/.test(e))return e}function Clash2QX(e){const t=new YAML;1==Pdbg&&$notify(" Before YAML Parse","content",e);for(var s=JSON.stringify(t.parse(YAMLFix(e))).replace(/yaml@bug𝟙/g,"[").replace(/冒号/gim,":").replace(/yaml@bug𝟚/g,"*"),r=0;r<10;r++)s=s.replace(new RegExp(patn[4][r],"gmi"),patn[0][r]);var i=JSON.parse(s).proxies;1==Pdbg&&$notify("After YAML Parse","content",JSON.stringify(i));var n=i.length,o=[],a="";for(r=0;r<n;r++)try{a=i[r],typecc=a.type,"ss"==typecc?a=CSS2QX(a):"ssr"==typecc?a=CSSR2QX(a):"vmess"==typecc?a=CV2QX(a):"trojan"==typecc?a=CT2QX(a):"http"==typecc?a=CH2QX(a):"socks5"==typecc&&(a=CS52QX(a)),a=0!=Pudp0?XUDP(a,Pudp0):a,a=0!=Ptfo0?XTFO(a,Ptfo0):a,o.push(a)}catch(e){$notify("⚠️该节点解析错误，暂时已忽略处理","可点击通知并发送链接反馈至 bot",JSON.stringify(a),bug_link),$notify("⚠️错误内容如下","可复制错误内容到反馈 bot",JSON.stringify(a)+"\n\n"+e)}return o.join("\n")}function CSS2QX(e){return tag="tag="+e.name.replace(/\\U.+?\s{1}/gi,""),ipt=e.server+":"+e.port,pwd="password="+e.password,mtd="method="+e.cipher,udp=e.udp?"udp-relay=true":"udp-relay=false",uot=e["udp-over-tcp"]?"udp-over-tcp=true":"udp-over-tcp=false",tfo=e.tfo?"fast-open=true":"fast-open=false",obfs=e["plugin-opts"]?"obfs="+e["plugin-opts"].mode:"",ohost=e["plugin-opts"]?"obfs-host="+e["plugin-opts"].host:"",ouri="",cert="",-1!=obfs.indexOf("websocket")&&(obfs=e["plugin-opts"].tls?"obfs=wss":"obfs=ws",ohost=e["plugin-opts"].host?"obfs-host="+e["plugin-opts"].host:"",ouri=e["plugin-opts"].path?"obfs-uri="+e["plugin-opts"].path:"","obfs=wss"==obfs&&(cert=1==Pcert0?"":"tls-verification =false")),node="shadowsocks="+[ipt,pwd,mtd,udp,uot,tfo,obfs,ohost,ouri,cert,tag].filter(Boolean).join(", "),node}function CSSR2QX(e){return tag="tag="+e.name.replace(/\\U.+?\s{1}/gi,""),ipt=e.server+":"+e.port,pwd="password="+e.password,mtd="method="+e.cipher,udp=e.udp?"udp-relay=true":"udp-relay=false",tfo=e.tfo?"fast-open=true":"fast-open=false",prot="ssr-protocol="+e.protocol,ohost="",ppara="",e.protocolparam&&(e["protocol-param"]=e.protocolparam),"string"==typeof e["protocol-param"]?ppara="ssr-protocol-param="+e["protocol-param"]:"object"==typeof e["protocol-param"]&&(ppara="ssr-protocol-param="+JSON.stringify(e["protocol-param"]).replace(/{|}|\s|"/g,"")),obfs="obfs="+e.obfs,e["obfs-param"]?ohost="obfs-host="+e["obfs-param"]:e.obfsparam&&(ohost="obfs-host="+e.obfsparam),node="shadowsocks="+[ipt,pwd,mtd,udp,tfo,prot,ppara,obfs,ohost,tag].filter(Boolean).join(", "),node}function CV2QX(e){tag="tag="+e.name.replace(/\\U.+?\s{1}/gi," "),ipt=e.server+":"+e.port,pwd="password="+e.uuid,mtd="method=aes-128-gcm",udp=(e.udp,"udp-relay=false"),tfo=e.tfo?"fast-open=true":"fast-open=false",obfs="","ws"==e.network&&e.tls?obfs="obfs=wss":"ws"==e.network?obfs="obfs=ws":"http"==e.network?obfs="obfs=http":e.tls&&(obfs="obfs=over-tls");const t=getValue((()=>e["ws-opts"].headers.Host));return ohost=e["ws-headers"]?"obfs-host="+e["ws-headers"].Host:"",ohost=t?"obfs-host="+t:ohost,ohost=e.servername?"obfs-host="+e.servername:ohost,ouri=e["ws-path"]?"obfs-uri="+e["ws-path"]:"",ouri=e["ws-opts"]?"obfs-uri="+e["ws-opts"].path:ouri,cert=e["skip-cert-verify"]&&e.tls?"tls-verification=false":"",caead=e.alterId&&0!=e.alterId?"aead=false":"",1==Pcert0&&e.tls?cert="tls-verification=true":1!=Pcert0&&e.tls&&(cert="tls-verification=false"),node="vmess="+[ipt,pwd,mtd,udp,tfo,obfs,ohost,ouri,cert,caead,tag].filter(Boolean).join(", "),node}function CT2QX(e){return tag="tag="+e.name.replace(/\\U.+?\s{1}/gi," "),ipt=e.server+":"+e.port,pwd="password="+e.password,otls="over-tls=true",opath="",ohost="",cert=e["skip-cert-verify"]?"tls-verification=false":"tls-verification=true",cert=1==Pcert0?"tls-verification=true":"tls-verification=false",tls13=1==PTls13?"tls13=true":"tls13=false",udp=(e.udp,"udp-relay=false"),tfo=e.tfo?"fast-open=true":"fast-open=false","ws"==e.network&&(otls="obfs=wss",e["ws-opts"]&&(opath=e["ws-opts"].path?"obfs-uri="+e["ws-opts"].path:"",ohost=e["ws-opts"].headers?"obfs-host="+e["ws-opts"].headers.Host:"")),node="trojan="+[ipt,pwd,otls,opath,ohost,cert,tls13,udp,tfo,tag].filter(Boolean).join(", "),node}function CH2QX(e){return tag="tag="+e.name.replace(/\\U.+?\s{1}/gi," "),ipt=e.server+":"+e.port,uname=e.username?"username="+e.username:"",pwd=e.password&&"string"==typeof e.password?"password="+e.password:"",tls=e.tls?"over-tls=true":"",cert=e["skip-cert-verify"]&&e.tls?"tls-verification=false":"",1==Pcert0&&e.tls?cert="tls-verification=true":1!=Pcert0&&e.tls&&(cert="tls-verification=false"),node="http="+[ipt,uname,pwd,tls,cert,tag].filter(Boolean).join(", "),node}function CS52QX(e){return tag="tag="+e.name.replace(/\\U.+?\s{1}/gi," "),ipt=e.server+":"+e.port,uname=e.username?"username="+e.username:"",pwd=e.password&&"string"==typeof e.password?"password="+e.password:"",tls=e.tls?"over-tls=true":"",cert=e["skip-cert-verify"]&&e.tls?"tls-verification=false":"",1==Pcert0&&e.tls?cert="tls-verification=true":1!=Pcert0&&e.tls&&(cert="tls-verification=false"),node="socks5="+[ipt,uname,pwd,tls,cert,tag].filter(Boolean).join(", "),node}function XUDP(e,t){var s=1==t&&/^(shadowsocks|trojan|vmess)/.test(e.trim())?"udp-relay=true, ":"udp-relay=false, ";if(-1!=e.indexOf("udp-relay"))var r=e.replace(RegExp("udp-relay.*?,","gmi"),s);else r=e.replace(new RegExp("tag.*?=","gmi"),s+"tag=");return r}function XTFO(e,t){var s=1==t?"fast-open=true, ":"fast-open=false, ";if(-1!=e.indexOf("fast-open"))var r=e.replace(RegExp("fast-open.*?,","gmi"),s);else r=e.replace(RegExp("tag.*?=","gmi"),s+"tag=");return r}function UOT(e){return cnts=e.replace(/\s*/g,""),/^shadowsocks=/.test(cnts)&&(e=-1!=cnts.indexOf("udp-over-tcp")?e.replace(/udp-over-tcp\s*\=\s*false/g,"udp-over-tcp=true"):e+", udp-over-tcp=true"),e}function Base64Code(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=function(e){for(var t={},s=0,r=e.length;s<r;s++)t[e.charAt(s)]=s;return t}(e),s=String.fromCharCode,r=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?s(192|t>>>6)+s(128|63&t):s(224|t>>>12&15)+s(128|t>>>6&63)+s(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return s(240|t>>>18&7)+s(128|t>>>12&63)+s(128|t>>>6&63)+s(128|63&t)},i=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,n=function(t){var s=[0,2,1][t.length%3],r=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0);return[e.charAt(r>>>18),e.charAt(r>>>12&63),s>=2?"=":e.charAt(r>>>6&63),s>=1?"=":e.charAt(63&r)].join("")};this.encode=function(e){var t;return"[object Uint8Array]"===Object.prototype.toString.call(e)?e.toString("base64"):(t=function(e){return e.replace(i,r)}(String(e)),t.replace(/[\s\S]{1,3}/g,n))};var o=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,a=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return s(55296+(t>>>10))+s(56320+(1023&t));case 3:return s((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return s((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},p=function(e){var r=e.length,i=r%4,n=(r>0?t[e.charAt(0)]<<18:0)|(r>1?t[e.charAt(1)]<<12:0)|(r>2?t[e.charAt(2)]<<6:0)|(r>3?t[e.charAt(3)]:0),o=[s(n>>>16),s(n>>>8&255),s(255&n)];return o.length-=[0,0,2,1][i],o.join("")},l=function(e){return e.replace(/\S{1,4}/g,p)},f=function(e){return l(e).replace(o,a)};this.decode=function(e){return f(String(e).replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,"")).replace(/&gt;/g,">").replace(/&lt;/g,"<")}}function YAML(){var e=[],t=[],s=0,r={regLevel:new RegExp("^([\\s\\-]+)"),invalidLine:new RegExp("^\\-\\-\\-|^\\.\\.\\.|^\\s*#.*|^\\s*$"),dashesString:new RegExp('^\\s*\\"([^\\"]*)\\"\\s*$'),quotesString:new RegExp("^\\s*\\'([^\\']*)\\'\\s*$"),float:new RegExp("^[+-]?[0-9]+\\.[0-9]+(e[+-]?[0-9]+(\\.[0-9]+)?)?$"),integer:new RegExp("^[+-]?[0-9]+$"),array:new RegExp("\\[\\s*(.*)\\s*\\]"),map:new RegExp("\\{\\s*(.*)\\s*\\}"),key_value:new RegExp("([a-z0-9_-][ a-z0-9_-]*):( .+)","i"),single_key_value:new RegExp("^([a-z0-9_-][ a-z0-9_-]*):( .+?)$","i"),key:new RegExp("([a-z0-9_-][ a-z0-9_-]+):( .+)?","i"),item:new RegExp("^-\\s+"),trim:new RegExp("^\\s+|\\s+$"),comment:new RegExp("([^\\'\\\"#]+([\\'\\\"][^\\'\\\"]*[\\'\\\"])*)*(#.*)?")};function i(e){return{parent:null,length:0,level:e,lines:[],children:[],addChild:function(e){this.children.push(e),e.parent=this,++this.length}}}function n(e){var t=null;if("true"==(e=e.replace(r.trim,"")))return!0;if("false"==e)return!1;if(".NaN"==e)return Number.NaN;if("null"==e)return null;if(".inf"==e)return Number.POSITIVE_INFINITY;if("-.inf"==e)return Number.NEGATIVE_INFINITY;if(t=e.match(r.dashesString))return t[1];if(t=e.match(r.quotesString))return t[1];if(t=e.match(r.float))return parseFloat(t[0]);if(t=e.match(r.integer))return parseInt(t[0]);if(isNaN(t=Date.parse(e))){if(t=e.match(r.single_key_value))return(o={})[t[1]]=n(t[2]),o;if(t=e.match(r.array)){for(var s=0,i=" ",o=[],a="",p=!1,l=0,f=t[1].length;l<f;++l){if("'"==(i=t[1][l])||'"'==i){if(!1===p){p=i,a+=i;continue}if("'"==i&&"'"==p||'"'==i&&'"'==p){p=!1,a+=i;continue}}else if(!1!==p||"["!=i&&"{"!=i)if(!1!==p||"]"!=i&&"}"!=i){if(!1===p&&0==s&&","==i){o.push(n(a)),a="";continue}}else--s;else++s;a+=i}return a.length>0&&o.push(n(a)),o}if(t=e.match(r.map)){for(s=0,i=" ",o=[],a="",p=!1,l=0,f=t[1].length;l<f;++l){if("'"==(i=t[1][l])||'"'==i){if(!1===p){p=i,a+=i;continue}if("'"==i&&"'"==p||'"'==i&&'"'==p){p=!1,a+=i;continue}}else if(!1!==p||"["!=i&&"{"!=i)if(!1!==p||"]"!=i&&"}"!=i){if(!1===p&&0==s&&","==i){o.push(a),a="";continue}}else--s;else++s;a+=i}a.length>0&&o.push(a);var c={};for(l=0,f=o.length;l<f;++l)(t=o[l].match(r.key_value))&&(c[t[1]]=n(t[2]));return c}return e}return new Date(t)}function o(e){for(var t=e.lines,s=e.children,r=[t.join(" ")],i=0,n=s.length;i<n;++i)r.push(o(s[i]));return r.join("\n")}function a(e){for(var t=e.lines,s=e.children,r=t.join("\n"),i=0,n=s.length;i<n;++i)r+=a(s[i]);return r}function p(s){for(var i=null,l={},f=null,c=null,u=null,d=-1,h=[],g=!0,m=0,x=s.length;m<x;++m)if(-1==d||d==s[m].level){h.push(m),d=s[m].level,f=s[m].lines,c=s[m].children,u=null;for(var y=0,b=f.length;y<b;++y){var v=f[y];if(i=v.match(r.key)){var O=i[1];if("-"==O[0]&&(O=O.replace(r.item,""),g&&(g=!1,void 0===l.length&&(l=[])),null!=u&&l.push(u),u={},g=!0),void 0!==i[2]){var w=i[2].replace(r.trim,"");if("&"==w[0]){var P=p(c);null!=u?u[O]=P:l[O]=P,t[w.substr(1)]=P}else if("|"==w[0])null!=u?u[O]=a(c.shift()):l[O]=a(c.shift());else if("*"==w[0]){var k=w.substr(1),R={};if(void 0===t[k])e.push("Reference '"+k+"' not found!");else{for(var _ in t[k])R[_]=t[k][_];null!=u?u[O]=R:l[O]=R}}else">"==w[0]?null!=u?u[O]=o(c.shift()):l[O]=o(c.shift()):null!=u?u[O]=n(w):l[O]=n(w)}else null!=u?u[O]=p(c):l[O]=p(c)}else{if(v.match(/^-\s*$/)){g&&(g=!1,void 0===l.length&&(l=[])),null!=u&&l.push(u),u={},g=!0;continue}if(i=v.match(/^-\s*(.*)/)){null!=u?u.push(n(i[1])):(g&&(g=!1,void 0===l.length&&(l=[])),l.push(n(i[1])));continue}}}null!=u&&(g&&(g=!1,void 0===l.length&&(l=[])),l.push(u))}for(m=h.length-1;m>=0;--m)s.splice.call(s,h[m],1);return l}function l(e){return p(e.children)}this.parse=function(n){e=[],t=[],s=(new Date).getTime();var o=function(t){var s,n=r.regLevel,o=r.invalidLine,a=t.split("\n"),p=0,l=0,f=[],c=new i(-1),u=new i(0);c.addChild(u);var d=[],h="";f.push(u),d.push(p);for(var g=0,m=a.length;g<m;++g)if(!(h=a[g]).match(o)){if((p=(s=n.exec(h))?s[1].length:0)>l){var x=u;u=new i(p),x.addChild(u),f.push(u),d.push(p)}else if(p<l){for(var y=!1,b=d.length-1;b>=0;--b)if(d[b]==p){u=new i(p),f.push(u),d.push(p),null!=f[b].parent&&f[b].parent.addChild(u),y=!0;break}if(!y)return void e.push("Error: Invalid indentation at line "+g+": "+h)}u.lines.push(h.replace(r.trim,"")),l=p}return c}(function(e){var t,s=e.split("\n"),i=r.comment;for(var n in s)(t=s[n].match(i))&&void 0!==t[3]&&(s[n]=t[0].substr(0,t[0].length-t[3].length));return s.join("\n")}(n)),a=l(o);return s=(new Date).getTime()-s,a}}function Tools(){return{filter:(e,...t)=>{const s=[...Array(e.length).keys()].map((()=>!1));return t.reduce(((t,s)=>OR(t,e.map((e=>s.test(e))))),s)},rename:{replace:(e,t,s)=>e.map((e=>e.replace(t,s))),delete:(e,...t)=>e.map((e=>t.reduce(((e,t)=>e.replace(t,"")),e))),trim:e=>e.map((e=>e.trim().replace(/[^\S\r\n]{2,}/g," ")))},getNodeInfo:e=>({names:e.map((e=>e.split("tag=")[1])),types:e.map((e=>{const t=e.match(/^(vmess|trojan|shadowsocks|http)=/);return t?t[1]:"unknown"}))})}}function AND(...e){return e.reduce(((e,t)=>e.map(((e,s)=>t[s]&&e))))}function OR(...e){return e.reduce(((e,t)=>e.map(((e,s)=>t[s]||e))))}function NOT(e){return e.map((e=>!e))}
