// https://raw.githubusercontent.com/app2smile/rules/master/js/tieba-json.js
const e=$request.url,t=$request.method,i="贴吧 json 脚本错误";let n=JSON.parse($response.body);if(e.includes("tiebaads/commonbatch")&&"POST"===t){let t=function(e,t){return Object.fromEntries(e.substring(e.indexOf("?")+1).split("&").map((e=>e.split("="))))[t]}(e,"adcmd");t?0===n.error_code&&n.res.ad?.length&&(n.res.ad=[]):$notification.post(i,"贴吧-tiebaads/commonbatch","adCmd 参数不存在")}else if(e.includes("c/f/pb/picpage")){const e=n.recom_live_list?.length;e&&(n.recom_live_list=[])}else if(e.includes("c/s/sync")){if("floating_icon"in n?n.floating_icon&&(n.floating_icon.homepage,n.floating_icon.pb,n.floating_icon=null):$notification.post(i,"贴吧-sync","无 floating_icon 字段"),"advertisement_config"in n?n.advertisement_config?.advertisement_str&&(n.advertisement_config=null):$notification.post(i,"贴吧-sync","无 advertisement_config 字段"),"config"in n){if(n.config?.switch)for(const e of n.config.switch)["platform_csj_init","platform_ks_init","platform_gdt_init"].includes(e.name)&&(e.type="0")}else $notification.post(i,"贴吧-sync","无 config 字段");"screen_fill_data_result"in n?("1"===n.screen_fill_data_result.screen_fill_advertisement_bear_switch&&(n.screen_fill_data_result.screen_fill_advertisement_bear_switch="0"),"1"===n.screen_fill_data_result.screen_fill_advertisement_plj_cpc_switch&&(n.screen_fill_data_result.screen_fill_advertisement_plj_cpc_switch="0"),"1"===n.screen_fill_data_result.screen_fill_advertisement_plj_switch&&(n.screen_fill_data_result.screen_fill_advertisement_plj_switch="0")):$notification.post(i,"贴吧-sync","无 screen_fill_data_result 字段"),"ad_stlog_switch"in n?"1"===n.ad_stlog_switch&&(n.ad_stlog_switch="0"):$notification.post(i,"贴吧-sync","无 ad_stlog_switch 字段"),"lcs_strategy"in n?"0"===n.lcs_strategy.conn_conf&&(n.lcs_strategy.conn_conf="1"):$notification.post(i,"贴吧-sync","无 lcs_strategy 字段")}else if(e.includes("c/f/frs/page"))n.live_fuse_forum?.length&&(n.live_fuse_forum=[]),n.activityhead?.is_ad&&(n.activityhead={}),n.thread_list=l(n.thread_list),s(n.forum?.banner_list?.app);else if(e.includes("c/f/frs/threadlist"))s(n.banner_list?.app);else if(e.includes("c/f/pb/page")){if(n.recom_ala_info?.live_id&&(n.recom_ala_info=null),n.post_list?.length)for(const e of n.post_list)e.outer_item&&(e.outer_item=null);s(n.banner_list?.app);const e=n.banner_list?.pb_banner_ad?.goods_info?.length;e&&(n.banner_list.pb_banner_ad.goods_info=[])}else e.includes("c/f/excellent/personalized")?(s(n.banner_list?.app),n.thread_list=l(n.thread_list),n.live_answer&&(n.live_answer=null)):e.includes("c/f/frs/generalTabList")?s(n.app_list):$notification.post(i,"路径/请求方法匹配错误：",t+","+e);function s(e){if(e?.length){let t=0;e.forEach((e=>{e.goods_info?.length&&(t++,e.goods_info=[])}))}}function l(e){let t=e;const i=e?.length;return i&&(t=e.filter((e=>!e.ala_info)),t.length),t}n=JSON.stringify(n),$done({body:n});
