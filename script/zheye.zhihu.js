// https://gist.githubusercontent.com/blackmatrix7/f5f780d0f56b319b6ad9848fd080bb18/raw/zheye.min.js
const e="哲也同学",t="zhihu_blocked_users",r="zhihu_current_userinfo",o="zhihu_keyword_block",i="zhihu_black_answers",n="zheye_server_url",s=["会员推荐","盐选推荐"],a=function(e="MagicJS",t="INFO"){return new class{constructor(e,t){if(this._startTime=Date.now(),this.version="3.0.0",this.scriptName=e,this.env=(()=>{const e="undefined"!=typeof $loon,t="undefined"!=typeof $task,r="undefined"!=typeof module,o="undefined"!=typeof $httpClient&&!e,i="undefined"!=typeof $storm,n="undefined"!=typeof $environment&&void 0!==$environment["stash-build"],s="undefined"!=typeof importModule;return{isLoon:e,isQuanX:t,isNode:r,isSurge:o,isStorm:i,isStash:n,isSurgeLike:o||e||i||n,isScriptable:s,get name(){return e?"Loon":t?"QuantumultX":r?"NodeJS":o?"Surge":s?"Scriptable":"unknown"},get build(){return o?$environment["surge-build"]:n?$environment["stash-build"]:i?$storm.buildVersion:void 0},get language(){if(o||n)return $environment.language},get version(){return o?$environment["surge-version"]:n?$environment["stash-version"]:i?$storm.appVersion:r?process.version:void 0},get system(){return o?$environment.system:r?process.platform:void 0},get systemVersion(){if(i)return $storm.systemVersion},get deviceName(){if(i)return $storm.deviceName}}})(),this.logger=((e,t="INFO")=>{let r=t;const o=(e,t="INFO")=>{t.toUpperCase()};return{getLevel:()=>r,setLevel:e=>{r=e},sniffer:e=>{o(0,"SNIFFER")},debug:e=>{o(0,"DEBUG")},info:e=>{o(0,"INFO")},notify:e=>{o(0,"NOTIFY")},warning:e=>{o(0,"WARNING")},error:e=>{o(0,"ERROR")},retry:e=>{o(0,"RETRY")}}})(0,t),this.http=h(this.env,this.logger),this.data=p(this.env,this.logger),this.notification=g(this.scriptName,this.env,this.logger,this.http),this.utils="function"==typeof MagicUtils?MagicUtils(this.env,this.logger):void 0,this.qinglong="function"==typeof MagicQingLong?MagicQingLong(this.env,this.data,this.logger):void 0,void 0!==this.data){let e=this.data.read("magic_loglevel");const t=this.data.read("magic_bark_url");e&&this.logger.setLevel(e.toUpperCase()),t&&this.notification.setBark(t)}}get isRequest(){return"undefined"!=typeof $request&&"undefined"==typeof $response}get isResponse(){return"undefined"!=typeof $response}get isDebug(){return"DEBUG"===this.logger.level}get request(){return"undefined"!=typeof $request?$request:void 0}get response(){return"undefined"!=typeof $response?($response.hasOwnProperty("status")&&($response.statusCode=$response.status),$response.hasOwnProperty("statusCode")&&($response.status=$response.statusCode),$response):void 0}done=(e={})=>{this._endTime=Date.now();let t=(this._endTime-this._startTime)/1e3;this.logger.info(`SCRIPT COMPLETED: ${t} S.`),"undefined"!=typeof $done&&$done(e)}}(e,t)}(e,"INFO");function l(){let e={id:"default",is_vip:!1};try{let t=a.data.read(r);return"string"==typeof t&&(t=JSON.parse(t)),t&&t.hasOwnProperty("id")?t:e}catch(t){return a.logger.error(`获取用户信息出现异常：${t}`),e}}function d(e,t,r="GBK02A"){e.common_card.footline||(e.common_card.footline={elements:[]}),e.common_card.footline.elements.unshift({tag:{text:t,color:r,type:"MASK_ROUNDED_RECTANGLE"}})}async function c(){let r=null;try{const i=a.data.read("zhihu_settings_recommend_pin",!1),s=a.data.read("zhihu_settings_recommend_stream",!1),c=a.data.read("zhihu_settings_remove_article",!1),u=a.data.read("zhihu_settings_blocked_users",!1),g=a.data.read("zhihu_settings_blocked_keywords",!0),p=a.data.read("zhihu_settings_check_paid_content",!1),h=a.data.read("zhihu_settings_request_content","local"),f=l();let y=a.data.read(o,"",f.id);y=g&&y?y:[];let _=a.data.read(t,"",f.id);_=u&&_?_:{};const m=t=>{const r=JSON.stringify(t),o="slot_event_card"===t.card_type||"slot_video_event_card"===t.card_type||t.hasOwnProperty("ad")||t.brief&&t.brief.indexOf("slot_card")>=0||t.extra&&"Training"===t.extra.type,n=!0!==o&&r.search(/"(type|style)+"\s?:\s?"(drama|zvideo|Video|BIG_IMAGE)+"/i)>=0,l=n&&s,d=!0!==n&&r.search(/"(type|style)+"\s?:\s?"pin"/i)>=0&&i,p=r.search(/"(type|style)+"\s?:\s?"article"/i)>=0&&c;let h,f=!1;if(!0!==n&&g)for(let o=0;o<y.length;o++)if(r.search(y[o])>=0){if(a.isDebug){let r=t.common_card.feed_content.title.panel_text,i=t.common_card.feed_content.content.panel_text,n="";try{n=t.common_card.feed_content.title.action.intent_url}catch{}a.logger.debug(`匹配关键字：\n${y[o]}\n标题：\n${r}\n内容：\n${i}`),a.notification.debug(e,`关键字：${y[o]}`,`${r}\n${i}`,n)}f=!0;break}try{h=!0!==f&&u&&_&&t.common_card.feed_content.source_line.elements[1].text.panel_text in _}catch{h=!1}return!(o||d||p||l||f||h)};let b=JSON.parse(a.response.body.replace(/(\w+"+\s?):\s?(\d{15,})/g,'$1:"$2"')),v=b.data.filter(m);if(!0===p){let e=[];for(let t=0;t<v.length;t++)if(v[t])try{let r=v[t].common_card.feed_content.title.action.intent_url;r=r.replace(/^https:\/\/zhihu\.com\/question\/\d+\/answer\//,"https://www.zhihu.com/appview/v2/answer/"),e.push(r)}catch{e.push("")}e.length>0&&"cloud"===h?await async function(e,t){const r=a.data.read(n);if(r){a.logger.debug(`向云端请求以下链接\n${e.join("\n")}`);const o=`${r}/api/v1/answer/links`;a.logger.debug(`服务端地址\n${o}`),await a.http.post({url:o,headers:{"Content-Type":"application/json"},body:e}).then((e=>{a.logger.debug(`云端探测结果<${typeof e.body}>\n${JSON.stringify(e.body)}`);for(let r=0;r<e.body.length;r++)try{let o=e.body[r];""!==o&&d(t[r],o,"GBK02A")}catch(e){a.logger.error(e)}})).catch((e=>{a.logger.error(`云端请求出现异常\n${JSON.stringify(e)}`)}))}else a.notification.post("未设置服务端地址，无法进行付费/推广内容探测。\n请配置服务端地址，或使用本地探测。")}(e,v):e.length>0&&"local"===h&&await async function(e,t){a.logger.debug(`将在本地请求以下链接\n${e.join("\n")}`);let r=[];function o(t){return new Promise((r=>{const o=e[t];o&&""!==o&&o.startsWith("https://www.zhihu.com/appview/v2/answer")?a.http.get({url:e[t],timeout:1e3}).then((e=>{const t=e.body;(t.indexOf("查看完整内容")>=0||t.indexOf("查看全部章节")>=0)&&t.indexOf("paid")>=0?r("付费内容"):t.indexOf("ad-link-card")>=0||t.indexOf("xg.zhihu.com")>=0||t.indexOf("营销平台")>=0?r("营销推广"):t.indexOf("mcn-link-card")>=0?r("购物推广"):r("")})).catch((e=>{a.logger.error(`本地请求出现异常\n${JSON.stringify(e)}`),r("")})):r("")}))}for(let t=0;t<e.length;t++)r.push(o(t));await Promise.all(r).then((e=>{a.logger.debug(`本地探测结果<${e.length}>\n${JSON.stringify(e)}`);for(let r=0;r<e.length;r++)try{let o=e[r];""!==o&&d(t[r],o,"GBK02A")}catch(e){a.logger.error(e)}}))}(e,v)}b.data=v,r={body:JSON.stringify(b)}}catch(e){a.logger.error(`推荐列表去广告出现异常：${e}`)}return r}function u(){let e=null;try{if(a.response.body){let r=JSON.parse(a.response.body);if(r.ad_info={},!0===a.data.read("zhihu_settings_blocked_users",!1)){let e=l(),o=a.data.read(t,"",e.id);o=o||{};let i=[],n={};if(void 0!==r.root){const e=r.root.author.name;!0===(void 0!==o[e])&&(r.root.is_delete=!0,r.root.can_reply=!1,r.root.can_like=!1,r.root.author.name="黑名单用户",r.root.author.avatar_url="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_xll.jpg")}void 0!==r.data&&r.data.forEach((e=>{const t=e.author.name;let r="";e.reply_to_author&&e.reply_to_author.name&&(r=e.reply_to_author.name);const s=""!==r,l=void 0!==o[t],d=void 0!==o[r];if(!0!==l&&!0!==d||(l&&!s&&a.request.url.indexOf("root_comment")>0?a.notification.debug(`屏蔽黑名单用户“${t}”的主评论。`):!l&&s&&!d&&a.request.url.indexOf("child_comment")>0?a.notification.debug(`屏蔽黑名单用户“${t}”的子评论。`):l&&!d&&a.request.url.indexOf("child_comment")>0?a.notification.debug(`屏蔽黑名单用户“${t}”回复“${r}”的子评论。`):l&&d&&a.request.url.indexOf("child_comment")>0&&a.notification.debug(`屏蔽黑名单用户“${t}”回复黑名单用户“${r}”的子评论。`),n[e.id]=t,l&&(e.is_delete=!0,e.can_reply=!1,e.can_like=!1,e.author.exposed_medal={},e.author.name="[黑名单用户]",e.author.avatar_url="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_xll.jpg"),d&&(e.reply_to_author.name="[黑名单用户]",e.reply_to_author.exposed_medal={},e.reply_to_author.avatar_url="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_xll.jpg")),e.child_comments){let t=[];e.child_comments.forEach((e=>{const r=e.author.name,i=void 0!==e.reply_to_author?e.reply_to_author.name:"",s=void 0!==o[r],l=void 0!==o[i];(s||l)&&(!0===s&&(a.notification.debug(`屏蔽黑名单用户“${r}”的子评论。`),n[e.id]=r,e.is_delete=!0,e.can_reply=!1,e.can_like=!1,e.author.name="[黑名单用户]",e.author.exposed_medal={},e.author.avatar_url="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_xll.jpg"),!0===l&&(a.logger.debug(`修改前的子评论数据:\n${JSON.stringify(e)}`),e.reply_to_author.name="[黑名单用户]",e.reply_to_author.exposed_medal={},e.reply_to_author.avatar_url="https://picx.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff_xll.jpg",a.notification.debug(`隐藏“${r}”回复黑名单用户“${i}”的名称与头像。`),a.logger.debug(`修改后的子评论数据:\n${JSON.stringify(e)}`))),t.push(e)})),e.child_comments=t}i.push(e)})),r.data=i}const o=JSON.stringify(r);a.logger.debug(`过滤后的评论数据：\n${o}`),e={body:o}}}catch(e){a.logger.error(`去除评论广告出现异常：${e}`)}return e}function g(e,t,r,o){let i=null,n=null;function s(t=e,s="",a="",l=""){if(void 0===o||void 0===o.post)throw"Bark notification needs to import MagicHttp module.";let d={url:i,headers:{"content-type":"application/json; charset=utf-8"},body:{title:t,body:s?`${s}\n${a}`:a,device_key:n}};o.post(d).catch((e=>{r.error(`Bark notify error: ${e}`)}))}return{post:function(o=e,a="",l="",d=""){d=(e=>{try{let r={};if("string"==typeof e)t.isLoon?r={openUrl:e}:t.isQuanX?r={"open-url":e}:t.isSurge&&(r={url:e});else if("object"==typeof e)if(t.isLoon)r.openUrl=e["open-url"]?e["open-url"]:"",r.mediaUrl=e["media-url"]?e["media-url"]:"";else if(t.isQuanX)r=e["open-url"]||e["media-url"]?e:{};else if(t.isSurge){let t=e["open-url"]||e.openUrl;r=t?{url:t}:{}}return r}catch(e){r.error(`通知选项转换失败${e}`)}return e})(d),1===arguments.length&&(o=e,a="",l=arguments[0]),r.notify(`title:${o}\nsubTitle:${a}\nbody:${l}\noptions:${"object"==typeof d?JSON.stringify(d):d}`),t.isSurge?$notification.post(o,a,l,d):t.isLoon?d?$notification.post(o,a,l,d):$notification.post(o,a,l):t.isQuanX&&$notify(o,a,l,d),i&&n&&s(o,a,l)},debug:function(t=e,o="",i="",n=""){"DEBUG"===r.getLevel()&&(1===arguments.length&&(t=e,o="",i=arguments[0]),this.post(t,o,i,n))},bark:s,setBark:e=>{try{let t=e.replace(/\/+$/g,"");i=`${/^https?:\/\/([^/]*)/.exec(t)[0]}/push`,n=/\/([^\/]+)\/?$/.exec(t)[1]}catch(e){r.error(`Bark url error: ${e}.`)}}}}function p(e,t){let r={fs:void 0,data:{}};if(e.isNode){r.fs=require("fs");try{r.fs.accessSync("./magic.json",r.fs.constants.R_OK|r.fs.constants.W_OK)}catch(e){r.fs.writeFileSync("./magic.json","{}",{encoding:"utf8"})}r.data=require("./magic.json")}const o=(e,t)=>"object"!=typeof t&&e===t,i=e=>"true"===e||"false"!==e&&(void 0===e?null:e),n=(e,t,r,o)=>{if(r)try{"string"==typeof e&&(e=JSON.parse(e)),e=!0===e.magic_session?e[r]:null}catch{e=null}if("string"==typeof e&&"null"!==e)try{e=JSON.parse(e)}catch{}return!1===o&&e&&!0===e.magic_session&&(e=null),null==e&&null!=t&&(e=t),e=i(e)},s=e=>{if("string"==typeof e){let t={};try{t=JSON.parse(e);const r=typeof t;("object"!==r||t instanceof Array||"bool"===r||null===t)&&(t={})}catch{}return t}return e instanceof Array||null==e||e!=e||"boolean"==typeof e?{}:e},a=(e,t=null,o="",i=!1,s=null)=>{let a=s||r.data;return a&&void 0!==a[e]&&null!==a[e]?val=a[e]:val=o?{}:null,val=n(val,t,o,i),val},l=(r,o=null,i="",s=!1,l=null)=>{let d="";return l||e.isNode?d=a(r,o,i,s,l):(e.isSurgeLike?d=$persistentStore.read(r):e.isQuanX&&(d=$prefs.valueForKey(r)),d=n(d,o,i,s)),t.debug(`READ DATA [${r}]${i?`[${i}]`:""} <${typeof d}>\n${JSON.stringify(d)}`),d},d=(o,i,n="",a=null)=>{if(void 0===i||i!=i)return!1;e.isNode||"boolean"!=typeof i&&"number"!=typeof i||(i=String(i));let l="";if(a||e.isNode?l=((e,t,o="",i=null)=>{let n=i||r.data;if(n=s(n),o){let r=s(n[e]);r.magic_session=!0,r[o]=t,n[e]=r}else n[e]=t;return null!==i&&(i=n),n})(o,i,n,a):n?(e.isSurgeLike?l=$persistentStore.read(o)?$persistentStore.read(o):l:e.isQuanX&&(l=$prefs.valueForKey(o)?$prefs.valueForKey(o):l),l=s(l),l.magic_session=!0,l[n]=i):l=i,l&&"object"==typeof l&&(l=JSON.stringify(l,null,4)),t.debug(`WRITE DATA [${o}]${n?`[${n}]`:""} <${typeof i}>\n${JSON.stringify(i)}`),!a){if(e.isSurgeLike)return $persistentStore.write(l,o);if(e.isQuanX)return $prefs.setValueForKey(l,o);if(e.isNode)try{return r.fs.writeFileSync("./magic.json",l),!0}catch(e){return t.error(e),!1}}return!0};return{read:l,write:d,del:(o,i="",n=null)=>{let a={};if(n||e.isNode)a=((e,t,o)=>{let i=o||r.data;return i=s(i),t?(obj=s(i[e]),delete obj[t],i[e]=obj):delete i[e],o&&(o=i),i})(o,i,n),n?n=a:r.fs.writeFileSync("./magic.json",JSON.stringify(a,null,4));else if(i){e.isSurgeLike?a=$persistentStore.read(o):e.isQuanX&&(a=$prefs.valueForKey(o)),a=s(a),delete a[i];const t=JSON.stringify(a,null,4);d(o,t)}else{if(e.isStorm)return $persistentStore.remove(o);if(e.isSurgeLike)return $persistentStore.write(null,o);if(e.isQuanX)return $prefs.removeValueForKey(o)}t.debug(`DELETE KEY [${o}]${i?`[${i}]`:""}`)},update:(e,t,r,n=o,s=null)=>{t=i(t);if(!0===n(l(e,null,r,!1,s),t))return!1;{const i=d(e,t,r,s);let a=l(e,null,r,!1,s);return n===o&&"object"==typeof a?i:n(t,a)}},allSessions:(e,r=null)=>{let o={},i=l(e,null,null,!0,r);return i=s(i),!0===i.magic_session&&(o={...i},delete o.magic_session),t.debug(`READ ALL SESSIONS [${e}] <${typeof o}>\n${JSON.stringify(o,null,4)}`),o},allSessionNames:(e,r=null)=>{let o=[],i=l(e,null,null,!0,r);return i=s(i),o=!0!==i.magic_session?[]:Object.keys(i).filter((e=>"magic_session"!==e)),t.debug(`READ ALL SESSIONS [${e}] <${typeof o}>\n${JSON.stringify(o,null,4)}`),o},defaultValueComparator:o,convertToObject:s}}function h(e,t){let r;if(e.isNode){const e=require("axios");r=e.create()}class o{constructor(e=!0){this.handlers=[],this.isRequest=e}use(e,r,o){return"function"==typeof e&&t.debug(`Register fulfilled ${e.name}`),"function"==typeof r&&t.debug(`Register rejected ${r.name}`),this.handlers.push({fulfilled:e,rejected:r,synchronous:!(!o||"boolean"!=typeof o.synchronous)&&o.synchronous,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}forEach(e){this.handlers.forEach((t=>{null!==t&&e(t)}))}}function i(r){let o={...r};if(o.params&&!e.isNode){let e=Object.keys(o.params).map((e=>{const t=encodeURIComponent(e);return o.url=o.url.replace(new RegExp(`${e}=[^&]*`,"ig"),""),o.url=o.url.replace(new RegExp(`${t}=[^&]*`,"ig"),""),`${t}=${encodeURIComponent(o.params[e])}`})).join("&");o.url.indexOf("?")<0&&(o.url+="?"),/(&|\?)$/g.test(o.url)||(o.url+="&"),o.url+=e,delete o.params,t.debug(`Params to QueryString: ${o.url}`)}return o}const n=(e,t=null)=>{if(e){let r={...e,config:e.config||t,status:e.statusCode||e.status,body:e.body||e.data,headers:e.headers||e.header};if("string"==typeof r.body)try{r.body=JSON.parse(r.body)}catch{}return delete r.data,r}return e},s=(e,r=null)=>{if(e&&e.status>=400)return t.debug(`Raise exception when status code is ${e.status}`),{name:"RequestException",message:`Request failed with status code ${e.status}`,config:r||e.config,response:e}},a={request:new o,response:new o(!1)};let l=[],d=[],c=!0;function u(e){return e=i(e),t.debug(`HTTP ${e.method.toUpperCase()}:\n${JSON.stringify(e)}`),e}function g(e){try{e=e?n(e):e,t.sniffer(`HTTP ${e.config.method.toUpperCase()}:\n${JSON.stringify(e.config)}\nSTATUS CODE:\n${e.status}\nRESPONSE:\n${"object"==typeof e.body?JSON.stringify(e.body):e.body}`);const r=s(e);return r?Promise.reject(r):e}catch(r){return t.error(r),e}}const p=(o,p)=>{let h;let f;p=((r,o)=>{let n="object"==typeof o?{headers:{},...o}:{url:o,headers:{}};if(n.method||(n.method=r),n=i(n),!0===n.rewrite&&(e.isSurge?(n.headers["X-Surge-Skip-Scripting"]=!1,delete n.rewrite):e.isQuanX&&(n.hints=!1,delete n.rewrite)),e.isSurgeLike){const e=n.headers["content-type"]||n.headers["Content-Type"];"GET"!==n.method&&e&&e.indexOf("application/json")>=0&&n.body instanceof Array&&(n.body=JSON.stringify(n.body),t.debug(`Convert Array object to String: ${n.body}`))}else e.isQuanX?(n.hasOwnProperty("body")&&"string"!=typeof n.body&&(n.body=JSON.stringify(n.body)),n.method=r):e.isNode&&("POST"===r||"PUT"===r||"PATCH"===r||"DELETE"===r?n.data=n.data||n.body:"GET"===r&&(n.params=n.params||n.body),delete n.body);return n})(o.toUpperCase(),p),h=e.isNode?r:e.isSurgeLike?e=>new Promise(((t,r)=>{$httpClient[o.toLowerCase()](e,((o,i,s)=>{if(o){let t={name:o.name||o,message:o.message||o,stack:o.stack||o,config:e,response:n(i)};r(t)}else i.config=e,i.body=s,t(i)}))})):e=>new Promise(((t,r)=>{$task.fetch(e).then((r=>{r=n(r,e);const o=s(r,e);if(o)return Promise.reject(o);t(r)})).catch((t=>{let o={name:t.message||t.error,message:t.message||t.error,stack:t.error,config:e,response:t.response?n(t.response):null};r(o)}))})),(e=>{try{l=[],d=[],a.request.forEach((t=>{"function"==typeof t.runWhen&&!1===t.runWhen(e)||(c=c&&t.synchronous,l.unshift(t.fulfilled,t.rejected))})),a.response.forEach((e=>{d.push(e.fulfilled,e.rejected)}))}catch(e){t.error(`Failed to register interceptors: ${e}.`)}})(p);const y=[u,void 0],_=[g,void 0];if(c){for(t.debug("Interceptors are executed in synchronous mode"),Array.prototype.unshift.apply(l,y),l=l.concat([u,void 0]);l.length;){let e=l.shift(),r=l.shift();try{"function"==typeof e&&t.debug(`Executing request fulfilled ${e.name}`),p=e(p)}catch(e){"function"==typeof r&&t.debug(`Executing request rejected ${r.name}`),r(e);break}}try{f=!e.isNode&&p.timeout?m(p):h(p)}catch(e){return Promise.reject(e)}for(Array.prototype.unshift.apply(d,_);d.length;)f=f.then(d.shift(),d.shift());return f}{t.debug("Interceptors are executed in asynchronous mode");let r=[h,void 0];for(Array.prototype.unshift.apply(r,y),Array.prototype.unshift.apply(r,l),r=r.concat(_),r=r.concat(d),f=Promise.resolve(p);r.length;)try{let o=r.shift(),i=r.shift();!e.isNode&&p.timeout&&o===h&&(o=m),"function"==typeof o&&t.debug(`Executing request fulfilled ${o.name}`),"function"==typeof i&&t.debug(`Executing request rejected ${i.name}`),f=f.then(o,i)}catch(e){t.error(`request exception: ${e}`)}return f}function m(e){try{const t=new Promise(((t,r)=>{setTimeout((()=>{let t={message:`timeout of ${e.timeout}ms exceeded.`,config:e};r(t)}),e.timeout)}));return Promise.race([h(e),t])}catch(e){t.error(`Request Timeout exception: ${e}.`)}}};return{request:p,interceptors:a,convertHeadersToLowerCase:e=>Object.keys(e).reduce(((t,r)=>(t[r.toLowerCase()]=e[r],t)),{}),convertHeadersToCamelCase:e=>Object.keys(e).reduce(((t,r)=>(t[r.split("-").map((e=>e[0].toUpperCase()+e.slice(1))).join("-")]=e[r],t)),{}),modifyResponse:n,get:e=>p("GET",e),post:e=>p("POST",e),put:e=>p("PUT",e),patch:e=>p("PATCH",e),delete:e=>p("DELETE",e),head:e=>p("HEAD",e),options:e=>p("OPTIONS",e)}}(async()=>{let e=null;if(a.isResponse)switch(!0){case/^https:\/\/api\.zhihu\.com\/people\/self$/.test(a.request.url):e=function(){let e=null;try{let t=JSON.parse(a.response.body);if(a.data.write(i,[]),a.logger.debug(`用户登录用户信息，接口响应：${a.response.body}`),t&&t.id&&t.hasOwnProperty("vip_info")&&t.vip_info.hasOwnProperty("is_vip")){const o={id:t.id,is_vip:!!t.vip_info.is_vip&&void 0!==t.vip_info.is_vip};a.logger.debug(`当前用户 id：${t.id}，是否为 VIP：${t.vip_info.is_vip}`),a.data.write(r,o),!1!==a.data.read("zhihu_settings_fake_vip")&&!1===t.vip_info.is_vip&&(t.vip_info.is_vip=!0,t.vip_info.vip_type=2,t.vip_info.vip_icon={url:"https://picx.zhimg.com/v2-aa8a1823abfc46f14136f01d55224925.jpg?source=88ceefae",night_mode_url:"https://picx.zhimg.com/v2-aa8a1823abfc46f14136f01d55224925.jpg?source=88ceefae"},t.vip_info.vip_icon_v2={url:"https://picx.zhimg.com/v2-aa8a1823abfc46f14136f01d55224925.jpg?source=88ceefae",night_mode_url:"https://picx.zhimg.com/v2-aa8a1823abfc46f14136f01d55224925.jpg?source=88ceefae"},t.vip_info.entrance={icon:{url:"https://pic3.zhimg.com/v2-5b7012c8c22fd520f5677305e1e551bf.png",night_mode_url:"https://pic4.zhimg.com/v2-e51e3252d7a2cb016a70879defd5da0b.png"},title:"盐选会员 为你严选好内容",expires_day:"2099-12-31",sub_title:null,button_text:"首月 9 元",jump_url:"zhihu://vip/purchase",button_jump_url:"zhihu://vip/purchase",sub_title_new:null,identity:"super_svip"},t.vip_info.entrance_new={left_button:{title:"精选会员内容",description:"为您严选好内容",jump_url:"zhihu://market/home"},right_button:{title:"开通盐选会员",description:"畅享 10w+ 场优质内容等特权",jump_url:"zhihu://vip/purchase"}},t.vip_info.entrance_v2={title:"我的超级盐选会员",sub_title:"畅享 5000W+ 优质内容",jump_url:"zhihu://market/home",button_text:"查看会员",sub_title_color:"#F8E2C4",sub_title_list:["畅享 5000W+ 优质内容"],card_jump_url:"zhihu://market/home"},a.logger.debug("设置用户为本地盐选会员"),e={body:JSON.stringify(t)})}else a.logger.warning("没有获取到本次登录用户信息，如未对功能造成影响，请忽略此日志。")}catch(e){a.logger.error(`获取当前用户信息出现异常：${e}`)}return e}();break;case!0===a.data.read("zhihu_settings_app_conf",!1)&&/^https?:\/\/appcloud2\.zhihu\.com\/v\d+\/config/.test(a.request.url):e=function(){let e=null;try{if(a.response.body){let t=JSON.parse(a.response.body);t.config.homepage_feed_tab.tab_infos=t.config.homepage_feed_tab.tab_infos.filter((e=>"activity_tab"===e.tab_type&&(e.end_time=(new Date-12e4).toString().slice(0,10),!0))),t.config.zvideo_max_number=1,t.config.is_show_followguide_alert=!1,delete t.config.hp_channel_tab,t.config.zombie_conf&&(t.config.zombie_conf.zombieEnable=!1),t.config.gray_mode&&(t.config.gray_mode.enable=!1,t.config.gray_mode.start_time="4092566400",t.config.gray_mode.end_time="4092566400"),t.config.hasOwnProperty("zhcnh_thread_sync")&&(a.logger.debug(JSON.stringify(t.config.zhcnh_thread_sync)),t.config.zhcnh_thread_sync.LocalDNSSetHostWhiteList=[],t.config.zhcnh_thread_sync.isOpenLocalDNS="0",t.config.zhcnh_thread_sync.ZHBackUpIP_Switch_Open="0",t.config.zhcnh_thread_sync.dns_ip_detector_operation_lock="1",t.config.zhcnh_thread_sync.ZHHTTPSessionManager_setupZHHTTPHeaderField="1"),e={body:JSON.stringify(t)}}}catch(e){a.logger.error(`优化软件配置出现异常：${e}`)}return e}();break;case!0===a.data.read("zhihu_settings_app_conf",!1)&&/^https?:\/\/m-cloud\.zhihu\.com\/api\/cloud\/config\/all\?/.test(a.request.url):e=function(){let e=null;try{if(a.response.body){let t=JSON.parse(a.response.body);t.data&&t.data.configs&&t.data.configs.forEach((e=>{"feed_gray_theme"===e.configKey&&(e.configValue.start_time="1669824000",e.configValue.end_time="1669824001",e.status=!1)}));const r=JSON.stringify(t);a.logger.debug(r),e={body:r}}}catch(e){a.logger.error(`优化软件配置出现异常：${e}`)}return e}();break;case!0===a.data.read("zhihu_settings_app_conf",!1)&&/^https?:\/\/api\.zhihu\.com\/feed\/render\/tab\/config/.test(a.request.url):e=function(){let e=null;try{if(a.response.body){let t=JSON.parse(a.response.body);if(t.more_sections){let e=a.data.read("zheye_remove_feed_tabs","").split(";");t.selected_sections=t.selected_sections.filter((t=>!e.includes(t.section_name))),t.selected_sections.forEach((e=>{e.show_type="adjustable"}))}a.logger.debug(JSON.stringify(t)),e={body:JSON.stringify(t)}}}catch(e){a.logger.error(`优化软件配置出现异常：${e}`)}return e}();break;case/^https?:\/\/api\.zhihu\.com\/user-credit\/basis/.test(a.request.url):e=function(){a.notification.debug("开始修改用户盐值");let e=null;try{if(a.response.body){const t=parseInt(a.data.read("zhihu_credit_score",780));a.logger.debug(`准备修改用户盐值为${t}`);let r=JSON.parse(a.response.body);r.credit_basis.total_score<t&&(r.credit_basis.total_score=t,a.logger.debug(`已修改用户盐值为:${t}`)),e={body:JSON.stringify(r)}}}catch(e){a.logger.error(`修改用户盐值出现异常：${e}`)}return e}();break;case/^https:\/\/api\.zhihu\.com\/topstory\/recommend/.test(a.request.url):e=await c();break;case/^https?:\/\/api\.zhihu\.com\/(v4\/)?questions\/\d+/.test(a.request.url):e=function(){let e=null;try{const r=l();let o=a.data.read(t,"",r.id);o=o||{};let n=JSON.parse(a.response.body);const s=a.data.read("zhihu_settings_blocked_users",!1);a.logger.debug(`当前黑名单列表：${JSON.stringify(o)}`);let d=a.data.read(i,[]);if(delete n.ad_info,n.data){let e=[];for(let t of n.data){let r="";const i=t.target.id.toString();try{"target"in t&&(r=t.target.author.name)}catch(e){a.logger.error(`获取回答列表用户名出现异常：${e}`)}const n=void 0!==o[r],l=s&&n;"target"in t&&(t.target.visible_only_to_author=!1,t.target.is_visible=!0,t.target.is_copyable=!0),l?!0===l&&!1===d.includes(i)&&(d.push(i),a.notification.debug(`记录黑名单用户${r}的回答 Id:${i}`)):e.push(t)}n.data=e}a.data.write(i,d);const c=JSON.stringify(n);a.logger.debug(`修改后的回答列表数据：${c}`),e={body:c}}catch(e){a.logger.error(`回答列表去广告出现异常：${e}`)}return e}();break;case/^https?:\/\/api\.zhihu\.com\/next-data\?/.test(a.request.url):e=function(){let e=null;try{if(a.response.body){let r=JSON.parse(a.response.body),o=l(),i=a.data.read(t,{},o.id);a.logger.debug(`脚本黑名单用户：\n${JSON.stringify(i)}`);let n=[];r.data.data.forEach((e=>{if(!0==("ad"===e.resource_type||!0===e.extra.recommend_start||1===e.next_guide.change_type||"推荐的相关内容"===e.next_guide.title))return;e.ad_info={data:""};const t=void 0!==i[e.data.author.name];a.logger.debug(`用户${e.data.author.name}是否在黑名单中：${t}`),!1!==a.data.read("zhihu_settings_blocked_users",!1)&&!1!==t||n.push(e)})),r.data.data=n,e={body:JSON.stringify(r)}}}catch(e){a.logger.error(`屏蔽回答信息流黑名单用户及广告：${e}`)}return e}();break;case/^https?:\/\/api\.zhihu\.com\/next-bff\?/.test(a.request.url):e=function(){let e=null;try{if(a.response.body){let r=JSON.parse(a.response.body),o=l(),i=a.data.read(t,{},o.id);a.logger.debug(`脚本黑名单用户：\n${JSON.stringify(i)}`);let n=[];r.data.forEach((e=>{if(!0==("normal"!==e.origin_data.resource_type))return;e.origin_data.ad_info={data:""};const t=e.origin_data.data.author.name,r=void 0!==i[t];a.logger.debug(`用户${t}是否在黑名单中：${r}`),!1!==a.data.read("zhihu_settings_blocked_users",!1)&&!1!==r||n.push(e)})),r.data=n,e={body:JSON.stringify(r)}}}catch(e){a.logger.error(`屏蔽回答信息流黑名单用户及广告：${e}`)}return e}();break;case/^https?:\/\/api\.zhihu\.com\/next-render\?/.test(a.request.url):e=function(){let e=null;try{if(a.response.body){let r=JSON.parse(a.response.body),o=l(),i=a.data.read(t,{},o.id);a.logger.debug(`脚本黑名单用户：\n${JSON.stringify(i)}`);let n=[];r.data.forEach((e=>{if(!0===(e.ad_info&&""!==e.ad_info.data||e.biz_type_list&&1!==e.biz_type_list.length||e.biz_type_list&&"answer"!==e.biz_type_list[0]||"ad"===e.type))return;const t=e.author.fullname,r=void 0!==i[t];a.logger.debug(`用户${t}是否在黑名单中：${r}`),!1!==a.data.read("zhihu_settings_blocked_users",!1)&&!1!==r||n.push(e)})),r.data=n,e={body:JSON.stringify(r)}}}catch(e){a.logger.error(`屏蔽回答信息流黑名单用户及广告：${e}`)}return e}();break;case!1!==a.data.read("zhihu_settings_sys_msg",!0)&&/^https?:\/\/api\.zhihu\.com\/notifications\/v3\/message/.test(a.request.url):e=function(){let e=null;try{let t=JSON.parse(a.response.body),r=[];for(let e of t.data)if("官方帐号消息"===e.detail_title){let t=e.unread_count;e.content.text=t>0?"未读消息"+t+"条":"全部消息已读",e.is_read=!0,e.unread_count=0,r.push(e)}else"活动助手"!==e.detail_title&&r.push(e);t.data=r,e={body:JSON.stringify(t)}}catch(e){a.logger.error(`屏蔽官方营销消息出现异常：${e}`)}return e}();break;case/^https?:\/\/api\.zhihu\.com\/comment_v5\/(answers|pins|comments？|articles)\/\d+\/(root|child)_comment/.test(a.request.url):e=u();break;case/^https?:\/\/www\.zhihu\.com\/api\/v\d\/articles\/\d+\/recommendation\?/.test(a.request.url):e=function(){let e=null;try{if(a.response.body){let t=JSON.parse(a.response.body);t.ad_info={};const r=JSON.stringify(t);a.logger.debug(`过滤后的文章数据：\n${r}`),e={body:r}}}catch(e){a.logger.error(`去除文章广告出现异常：${e}`)}return e}();break;case/^https?:\/\/www\.zhihu\.com\/api\/v4\/comment_v5\/answers\/\d+\/abstract_comment\?/.test(a.request.url):e=u();break;case!0===a.data.read("zhihu_settings_answer_tip",!0)&&/^https?:\/\/www\.zhihu\.com\/appview\/v2\/answer\/.*(entry=(?!(preload-topstory|preload-search|preload-subscription)))?/.test(a.request.url):e=function(){let e=null;try{let t=a.response.body,r="";if((t.indexOf("查看完整内容")>=0||t.indexOf("查看全部章节")>=0)&&t.indexOf("paid")>=0?r='<a style="height: 42px;padding: 0 12px;border-radius: 6px;background-color: rgb(247 104 104 / 8%);display: block;text-decoration: none;" href="#"><div style="color: #f36;display: flex;-webkit-box-align: center;align-items: center;height: 100%;"><svg style="width: 1.2em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024"><path d="M821.333333 138.666667c64.8 0 117.333333 52.533333 117.333334 117.333333v149.333333a32 32 0 0 1-32 32 74.666667 74.666667 0 0 0 0 149.333334 32 32 0 0 1 32 32v149.333333c0 64.8-52.533333 117.333333-117.333334 117.333333H202.666667c-64.8 0-117.333333-52.533333-117.333334-117.333333V618.666667a32 32 0 0 1 32-32 74.666667 74.666667 0 0 0 0-149.333334 32 32 0 0 1-32-32V256c0-64.8 52.533333-117.333333 117.333334-117.333333h618.666666zM428.576 329.994667a32 32 0 0 0-43.733333-2.581334l-1.514667 1.344a32 32 0 0 0-2.581333 43.733334L452.565333 458.666667H405.333333l-1.877333 0.053333A32 32 0 0 0 373.333333 490.666667l0.053334 1.877333A32 32 0 0 0 405.333333 522.666667h80v42.666666H405.333333l-1.877333 0.053334A32 32 0 0 0 373.333333 597.333333l0.053334 1.877334A32 32 0 0 0 405.333333 629.333333h80v42.666667l0.053334 1.877333A32 32 0 0 0 517.333333 704l1.877334-0.053333A32 32 0 0 0 549.333333 672v-42.666667H618.666667l1.877333-0.053333A32 32 0 0 0 650.666667 597.333333l-0.053334-1.877333A32 32 0 0 0 618.666667 565.333333h-69.333334v-42.666666H618.666667l1.877333-0.053334A32 32 0 0 0 650.666667 490.666667l-0.053334-1.877334A32 32 0 0 0 618.666667 458.666667h-47.253334l71.84-86.186667 1.248-1.589333a32 32 0 0 0-50.421333-39.381334L512 430.016l-82.08-98.506667z"></path></svg><div style="flex: 1 1;white-space: nowrap;text-overflow: ellipsis;padding-left:4px"><span style="font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;-webkit-tap-highlight-color: rgba(26,26,26,0);font-size: 14px;line-height: 20px;color: #f36;white-space: nowrap;font-weight: 600;">本文为付费内容</span></div><div></div></div></a>':t.indexOf("ad-link-card")>=0||t.indexOf("xg.zhihu.com")>=0||t.indexOf("营销平台")>=0?r='<a style="height: 42px;padding: 0 12px;border-radius: 6px;background-color: rgb(8 188 212 / 8%);display: block;text-decoration: none;" href="#"><div style="color: #00bcd4;display: flex;-webkit-box-align: center;align-items: center;height: 100%;"><svg style="width: 1.2em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024"><path d="M128 765.952q0 26.624 18.432 45.056t45.056 18.432l191.488 0 0 128-254.976 0q-26.624 0-49.664-10.24t-40.448-27.648-27.648-40.448-10.24-49.664l0-637.952q0-25.6 10.24-49.152t27.648-40.448 40.448-27.136 49.664-10.24l701.44 0q26.624 0 49.664 10.24t40.448 27.136 27.648 40.448 10.24 49.152l0 251.904-128 1.024 0-61.44q0-26.624-18.432-45.056t-45.056-18.432l-574.464 0q-26.624 0-45.056 18.432t-18.432 45.056l0 382.976zM990.208 705.536q21.504 18.432 22.016 34.304t-20.992 33.28q-21.504 18.432-51.2 41.472t-60.928 48.128-61.952 49.152-55.296 43.52q-26.624 20.48-43.52 15.36t-16.896-31.744q1.024-16.384 0-40.448t-1.024-41.472q0-19.456-10.752-24.064t-31.232-4.608q-21.504 0-39.936-0.512t-35.84-0.512-36.352-0.512-41.472-0.512q-9.216 0-19.968-2.048t-19.456-7.168-14.336-15.36-5.632-27.648l0-80.896q0-31.744 15.36-42.496t48.128-10.752q30.72 1.024 61.44 1.024t71.68 1.024q29.696 0 46.08-5.12t16.384-25.6q-1.024-14.336 0.512-35.328t1.536-37.376q0-26.624 14.336-33.28t36.864 10.752q22.528 18.432 52.736 43.008t61.952 50.688 62.976 51.2 54.784 44.544z"></path></svg><div style="flex: 1 1;white-space: nowrap;text-overflow: ellipsis;padding-left:4px"><span style="font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;-webkit-tap-highlight-color: rgba(26,26,26,0);font-size: 14px;line-height: 20px;color: #00bcd4;white-space: nowrap;font-weight: 600;">本文含有营销推广</span></div><div></div></div></a>':t.indexOf("mcn-link-card")>=0?r='<a style="height: 42px;padding: 0 12px;border-radius: 6px;background-color: rgb(8 188 212 / 8%);display: block;text-decoration: none;" href="#"><div style="color: #00bcd4;display: flex;-webkit-box-align: center;align-items: center;height: 100%;"><svg style="width: 1.2em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024"><path d="M346.112 806.912q19.456 0 36.864 7.168t30.208 19.968 20.48 30.208 7.68 36.864-7.68 36.864-20.48 30.208-30.208 20.48-36.864 7.68q-20.48 0-37.888-7.68t-30.208-20.48-20.48-30.208-7.68-36.864 7.68-36.864 20.48-30.208 30.208-19.968 37.888-7.168zM772.096 808.96q19.456 0 37.376 7.168t30.72 19.968 20.48 30.208 7.68 36.864-7.68 36.864-20.48 30.208-30.72 20.48-37.376 7.68-36.864-7.68-30.208-20.48-20.48-30.208-7.68-36.864 7.68-36.864 20.48-30.208 30.208-19.968 36.864-7.168zM944.128 227.328q28.672 0 44.544 7.68t22.528 18.944 6.144 24.064-3.584 22.016-13.312 37.888-22.016 62.976-23.552 68.096-18.944 53.248q-13.312 40.96-33.28 56.832t-49.664 15.872l-35.84 0-65.536 0-86.016 0-96.256 0-253.952 0 14.336 92.16 517.12 0q49.152 0 49.152 41.984 0 20.48-9.728 35.328t-38.4 14.848l-49.152 0-94.208 0-118.784 0-119.808 0-99.328 0-55.296 0q-20.48 0-34.304-9.216t-23.04-24.064-14.848-32.256-8.704-32.768q-1.024-6.144-5.632-29.696t-11.264-58.88-14.848-78.848-16.384-87.552q-19.456-103.424-44.032-230.4l-76.8 0q-15.36 0-25.6-7.68t-16.896-18.432-9.216-23.04-2.56-22.528q0-20.48 13.824-33.792t37.376-13.312l21.504 0 21.504 0 25.6 0 34.816 0q20.48 0 32.768 6.144t19.456 15.36 10.24 19.456 5.12 17.408q2.048 8.192 4.096 23.04t4.096 30.208q3.072 18.432 6.144 38.912l700.416 0zM867.328 194.56l-374.784 0 135.168-135.168q23.552-23.552 51.712-24.064t51.712 23.04z"></path></svg><div style="flex: 1 1;white-space: nowrap;text-overflow: ellipsis;padding-left:4px"><span style="font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;-webkit-tap-highlight-color: rgba(26,26,26,0);font-size: 14px;line-height: 20px;color: #00bcd4;white-space: nowrap;font-weight: 600;">本文含有购物推广</span></div><div></div></div></a>':7===Math.floor(200*Math.random())&&(r='<a style="height: 42px;padding: 0 12px;border-radius: 6px;background-color: rgb(74 162 56 / 8%);display: block;text-decoration: none;" href="#"><div style="color: #619201;display: flex;-webkit-box-align: center;align-items: center;height: 100%;"><svg class="icon" style="width: 1.2em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024"><path d="M512 85.333333c71.477333 0 159.68 57.546667 229.258667 147.018667C817.845333 330.826667 864 455.978667 864 586.666667c0 211.808-148.501333 352-352 352S160 798.474667 160 586.666667c0-130.688 46.144-255.84 122.741333-354.314667C352.32 142.88 440.522667 85.333333 512 85.333333z m0 64c-48.213333 0-120.096 46.912-178.741333 122.314667C265.109333 359.253333 224 470.762667 224 586.666667c0 175.616 119.050667 288 288 288s288-112.384 288-288c0-115.904-41.109333-227.402667-109.258667-315.018667C632.096 196.234667 560.213333 149.333333 512 149.333333z m-74.666667 522.666667a53.333333 53.333333 0 1 1 0 106.666667 53.333333 53.333333 0 0 1 0-106.666667z m-96-128a42.666667 42.666667 0 1 1 0 85.333333 42.666667 42.666667 0 0 1 0-85.333333z"></path></svg><div style="flex: 1 1;white-space: nowrap;text-overflow: ellipsis;padding-left:4px"><span style="font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;-webkit-tap-highlight-color: rgba(26,26,26,0);font-size: 14px;line-height: 20px;color: #619201;white-space: nowrap;font-weight: 600;">本文为免费内容</span></div><div></div></div></a>'),""!==r){const o=t.match(/(richText[^<]*>)(.)/)[1],i=t.lastIndexOf(o)+o.length;e={body:t.slice(0,i)+r+t.slice(i)}}}catch(e){a.logger.error(`付费内容提醒出现异常：${e}`)}return e}();break;case!1!==a.data.read("zhihu_settings_blocked_users",!1)&&/^https?:\/\/api\.zhihu\.com\/next\?/.test(a.request.url):e=function(){let e=null;try{if(a.response.body){let t=JSON.parse(a.response.body);const r=a.data.read(i,[]);if(r.length>0){let e=[];t.data.forEach((t=>{!1===r.includes(t.id.toString())?(t.ad_info={data:""},e.push(t)):a.notification.debug(`屏蔽翻页过程中出现的黑名单用户回答 Id:${t.id}`)}));for(let t=0;t<e.length;t++)e[t].extra&&e[t].extra.question_index&&(e[t].extra.question_index=t+1),e[t].strategy_info&&(e[t].strategy_info.global_index=t+1,e[t].strategy_info.strategy_index=t+1);t.data=e}e={body:JSON.stringify(t)}}}catch(e){a.logger.error(`屏蔽下翻黑名单用户的回答出现异常：${e}`)}return e}();break;case!0===a.data.read("zhihu_settings_blocked_users",!0)&&/^https?:\/\/api\.zhihu\.com\/people\/((?!self).)*$/.test(a.request.url):e=function(){let e=null;try{let r=JSON.parse(a.response.body);if(delete r.mcn_user_info,e={body:JSON.stringify(r)},r.name&&r.id&&!0===r.is_blocking){const e=l();let o=a.data.read(t,"",e.id);o="object"==typeof o&&o?o:{},o[r.name]||(a.logger.debug(`当前需要加入黑名单的用户 Id：${r.id}，用户名：${r.name}`),o[r.name]=r.id,a.data.write(t,o,e.id),a.logger.debug(`${r.name}写入脚本黑名单成功，当前脚本黑名单数据：${JSON.stringify(o)}`),a.notification.post(`已自动将用户“${r.name}”写入脚本黑名单。`))}}catch(e){a.logger.error(`去除 MCN 信息出现异常：${e}`)}return e}();break;case/^https?:\/\/api\.zhihu\.com\/moments_v3\?/.test(a.request.url):e=function(){let e=null;try{let r=JSON.parse(a.response.body.replace(/(\w+"+\s?):\s?(\d{15,})/g,'$1:"$2"'));const o=l();let i,n=a.data.read(t,"",o.id);n=n||{};const s=a.data.read("zhihu_settings_moments_stream",!1),d=a.data.read("zhihu_settings_moments_recommend",!1),c=a.data.read("zhihu_settings_moments_activity",!1),u=a.data.read("zhihu_settings_blocked_users",!1);i=r.data.filter((e=>{const t=u&&e.target&&e.target.origin_pin&&e.target.origin_pin.author&&void 0!==n[e.target.origin_pin.author.name],r=s&&"zvideo"===e.target_type,o=d&&"recommend_user_card_list"===e.type,i=c&&"message_activity_card"===e.type;return!(t||r||o||i)})),r.data=i,e={body:JSON.stringify(r)}}catch(e){a.logger.error(`关注列表去广告出现异常：${e}`)}return e}();break;case!0===a.data.read("zhihu_settings_hot_list",!0)&&/^https?:\/\/api\.zhihu\.com\/topstory\/hot-lists(\?|\/)/.test(a.request.url):e=function(){let e=null;try{if(a.response.body){let t=JSON.parse(a.response.body);"data"in t&&(t.data=t.data.filter((e=>"hot_list_feed"===e.type||"hot_list_feed_video"===e.type))),e={body:JSON.stringify(t)}}}catch(e){a.logger.error(`去除热榜广告出现异常：${e}`)}return e}();break;case!0===a.data.read("zhihu_settings_preset_words",!0)&&/^https?:\/\/api\.zhihu\.com\/search\/preset_words\?/.test(a.request.url):e=function(){let e=null;try{if(a.response.body){a.logger.debug(`预置关键字返回：${a.response.body}`);let t=JSON.parse(a.response.body);t.hasOwnProperty("preset_words")&&t.preset_words.words&&(t.preset_words.words=t.preset_words.words.filter((e=>"ad"!==e.type)),e={body:JSON.stringify(t)})}}catch(e){a.logger.error(`去除预置关键字广告出现异常：${e}`)}return e}();break;case!1!==a.data.read("zhihu_settings_blocked_users",!1)&&/^https?:\/\/api\.zhihu\.com\/settings\/blocked_users/.test(a.request.url):!function(){const e=l();let r={},o=a.data.read(t,"",e.id);if(o="object"==typeof o&&o?o:{},s.forEach((e=>{o[e]="00000000000000000000000000000000",r[e]="00000000000000000000000000000000"})),a.logger.debug(`当前用户 id：${e.id}，脚本黑名单：${JSON.stringify(o)}`),"GET"===a.request.method)try{a.request.url.indexOf("offset")<0&&(o=r,a.logger.debug("脚本黑名单已清空，请滑动至黑名单末尾保证重新获取完成。"),a.notification.post("开始同步黑名单数据，请滑动至黑名单末尾，直至弹出“同步成功”的通知。"));let i=JSON.parse(a.response.body);i.data?(a.logger.debug(`本次滑动获取的黑名单信息：${JSON.stringify(i.data)}`),i.data.forEach((e=>{"[已重置]"!==e.name&&(o[e.name]=e.id)})),a.data.write(t,o,e.id),!0===i.paging.is_end&&(a.notification.post(`同步黑名单数据成功！当前黑名单共${Object.keys(o).length-s.length}人。\n脚本内置黑名单${s.length}人。`),a.logger.debug(`脚本黑名单内容：${JSON.stringify(o)}。`))):a.logger.warning(`获取黑名单失败，接口响应不合法：${a.response.body}`)}catch(e){a.data.del(t),a.logger.error(`获取黑名单失败，异常信息：${e}`),a.notification.post("获取黑名单失败，执行异常，已清空黑名单。")}else if("POST"===a.request.method)try{let r=JSON.parse(a.response.body);r.hasOwnProperty("name")&&r.hasOwnProperty("id")?(a.logger.debug(`当前需要加入黑名单的用户 Id：${r.id}，用户名：${r.name}`),r.id?(o[r.name]=r.id,a.data.write(t,o,e.id),a.logger.debug(`${r.name}写入脚本黑名单成功，当前脚本黑名单数据：${JSON.stringify(o)}`),a.notification.post(`已将用户“${r.name}”写入脚本黑名单。`)):(a.logger.error(`${r.name}写入脚本黑名单失败，没有获取到用户 Id。`),a.notification.post(`将用户“${r.name}”写入脚本黑名单失败！`))):(a.logger.warning(`写入黑名单失败，接口响应不合法：${a.response.body}`),a.notification.post("写入脚本黑名单失败，接口返回不合法。"))}catch(e){a.logger.error(`写入黑名单失败，异常信息：${e}`),a.notification.post("写入脚本黑名单失败，执行异常，请查阅日志。")}else if("DELETE"===a.request.method)try{if(JSON.parse(a.response.body).success){let r=a.request.url.match(/^https?:\/\/api\.zhihu\.com\/settings\/blocked_users\/([0-9a-zA-Z]*)/)[1];if(r){a.logger.debug(`当前需要移出黑名单的用户 Id：${r}`);for(let i in o)if(o[i]===r){delete o[i],a.data.write(t,o,e.id),a.logger.debug(`${i}移出脚本黑名单成功，当前脚本黑名单数据：${JSON.stringify(o)}`),a.notification.post(`已将用户“${i}”移出脚本黑名单！`);break}}else a.logger.error("将用户移出脚本黑名单失败！\n建议从设置中刷新黑名单数据。"),a.notification.post("将用户移出脚本黑名单失败，没有获取到用户 Id。\n建议从设置中刷新黑名单数据。")}else a.logger.warning(`移出黑名单失败，接口响应不合法：${a.response.body}`),a.notification.post("移出脚本黑名单失败，接口返回不合法。")}catch(e){a.logger.error(`移出黑名单失败，异常信息：${e}`),a.notification.post("移出脚本黑名单失败，执行异常，请查阅日志。")}}();break;default:a.logger.debug("没有匹配到任何请求，请确认配置正确。")}else a.isRequest?!1!==a.data.read("zhihu_settings_blocked_keywords",!1)&&!0===/^https?:\/\/api\.zhihu\.com\/feed-root\/block/.test(a.request.url)&&(e=function(){let e=null;try{const t=l();if("GET"===a.request.method){let r=a.data.read(o,null,t.id);r||(r=[]);let i={"Cache-Control":"no-cache, no-store, must-revalidate, private, max-age=0",Connection:"keep-alive","Content-Type":"application/json;charset=utf-8",Pragma:"no-cache","Referrer-Policy":"no-referrer-when-downgrade",Server:"CLOUD ELB 1.0.0",Vary:"Accept-Encoding","X-Cache-Lookup":"Cache Miss","x-cdn-provider":"tencent"},n=JSON.stringify({success:!0,is_vip:!0,kw_min_length:2,kw_max_length:100,kw_max_count:1e3,data:r});e=a.env.isQuanX?{body:n,headers:i,status:"HTTP/1.1 200 OK"}:{response:{body:n,headers:i,status:200}},a.logger.debug(`获取本地脚本屏蔽关键词：\n${r.join("、")}`)}else if("POST"===a.request.method){if(a.request.body){let r={"Cache-Control":"no-cache, no-store, must-revalidate, private, max-age=0",Connection:"keep-alive","Content-Type":"application/json;charset=utf-8",Pragma:"no-cache","Referrer-Policy":"no-referrer-when-downgrade",Server:"CLOUD ELB 1.0.0",Vary:"Accept-Encoding","X-Cache-Lookup":"Cache Miss","x-cdn-provider":"tencent"},i=decodeURIComponent(a.request.body).match(/keyword=(.*)/)[1],n=a.data.read(o,null,t.id);n||(n=[]);let s=!1;for(let e=0;e<n.length;e++)if(i===n[e]){s=!0;break}if(!1===s){n.push(i),a.data.write(o,n,t.id);let s=JSON.stringify({success:!0});e=a.env.isQuanX?{body:s,headers:r,status:"HTTP/1.1 200 OK"}:{response:{body:s,headers:r,status:200}},a.logger.debug(`添加本地脚本屏蔽关键词“${i}”`)}else{let t=JSON.stringify({error:{message:"关键词已存在",code:100002}});e=a.env.isQuanX?{body:t,headers:r,status:"HTTP/1.1 400 Bad Request"}:{response:{body:t,headers:r,status:400}}}}}else if("DELETE"===a.request.method){let r=decodeURIComponent(a.request.url).match(/keyword=(.*)/)[1],i=a.data.read(o,null,t.id);i||(i=[]),i=i.filter((e=>e!==r)),a.data.write(o,i,t.id);let n={"Cache-Control":"no-cache, no-store, must-revalidate, private, max-age=0",Connection:"keep-alive","Content-Type":"application/json;charset=utf-8",Pragma:"no-cache","Referrer-Policy":"no-referrer-when-downgrade",Server:"CLOUD ELB 1.0.0",Vary:"Accept-Encoding","X-Cache-Lookup":"Cache Miss","x-cdn-provider":"tencent"},s=JSON.stringify({success:!0});e=a.env.isQuanX?{body:s,headers:n,status:"HTTP/1.1 200 OK"}:{response:{body:s,headers:n,status:200}},a.logger.debug(`删除本地脚本屏蔽关键词：“${r}”`)}}catch(e){a.logger.debug(`关键词屏蔽操作出现异常：${e}`)}return e}()):(a.data.del(r),a.data.del(t),a.data.del(o),a.notification.post("哲也同学数据清理完毕"));e?a.done(e):a.done()})();
